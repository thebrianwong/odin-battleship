(()=>{"use strict";const e=(()=>{const e=e=>{const o=["A","B","C","D","E","F","G","H","I","J"],i=["1","2","3","4","5","6","7","8","9","10"];for(let d=-1;d<10;d++)for(let n=-1;n<10;n++)if(-1===d)if(-1===n){const t=document.createElement("div");t.classList.add("gameboard-label"),t.style.visibility="hidden",e.appendChild(t)}else{const t=document.createElement("div");t.classList.add("column-label"),t.textContent=o[n],e.appendChild(t)}else if(-1===n){const t=document.createElement("div");t.classList.add("row-label"),t.textContent=i[d],e.appendChild(t)}else if(Array.from(e.classList).includes("player-board")){const o=document.createElement("div");o.setAttribute("data-row",d),o.setAttribute("data-column",n),o.classList.add("gameboard-cell"),o.addEventListener("dragover",(e=>{s(e)})),o.addEventListener("drop",(e=>{r(e),5===a.getPlayers()[0].getGameboard().getPlacedShips().length&&t("enable")})),e.appendChild(o)}else if(Array.from(e.classList).includes("opponent-board")){const t=document.createElement("button");t.setAttribute("data-row",d),t.setAttribute("data-column",n),t.classList.add("gameboard-cell"),t.disabled=!0,t.addEventListener("click",(e=>{if(!a.isMidAttack()){console.log(t);const e=Number(t.dataset.row),s=Number(t.dataset.column);a.getPlayers()[0].sendAttack([e,s])}})),e.appendChild(t)}},t=e=>{const t=document.querySelector(".opponent-board"),a=Array.from(t.querySelectorAll(".gameboard-cell"));"enable"===e?a.forEach((e=>{e.disabled=!1})):"disable"===e&&a.forEach((e=>{e.disabled=!0}))},s=()=>{event.preventDefault()},r=e=>{e.preventDefault();const t=e.target;if(Array.from(t.classList).includes("contains-ship-image"))return;const s=e.dataTransfer.getData("image"),o=JSON.parse(s);if(!((e,t)=>{const s=[Number(e.dataset.row),Number(e.dataset.column)],r=Number(t.shipLength);return t.horizontal?a.getPlayers()[0].checkIfValidEmptyCoordinates(s,r,"right")?(console.log("fits"),!0):(console.log("nope"),!1):t.vertical?a.getPlayers()[0].checkIfValidEmptyCoordinates(s,r,"down")?(console.log("fits"),!0):(console.log("nope"),!1):void 0})(t,o))return;const i=((e,t)=>{const a=t.shipLength,s=Number(e.dataset.row),r=Number(e.dataset.column),o=[[s,r]];e.classList.add("contains-ship-image"),e.classList.add("ship-image"),e.classList.add(`ship-image-${a}`),e.classList.add(`ship-image-${a}-1`),t.horizontal?e.classList.add("horizontal"):t.vertical&&e.classList.add("vertical");for(let e=1;e<a;e++){let i;t.horizontal?(i=document.querySelector(`.player-board [data-row='${s}'][data-column='${r+e}']`),i.classList.add("horizontal"),o.push([s,r+e])):t.vertical&&(i=document.querySelector(`.player-board [data-row='${s+e}'][data-column='${r}']`),i.classList.add("vertical"),o.push([s+e,r])),i.classList.add("contains-ship-image"),i.classList.add("ship-image"),i.classList.add(`ship-image-${a}`),i.classList.add(`ship-image-${a}-${e+1}`)}return o})(t,o);a.getPlayers()[0].addShipToGameboard(Number(o.shipLength),i),(e=>{const t=e.elementID,a=document.querySelector(`#${t}`),s=a.parentNode.querySelector("button");a.setAttribute("draggable",!1),a.classList.add("disabled-image"),s.disabled=!0})(o),t.removeEventListener("drop",r)};return{initializeBoardDOM:()=>{const t=document.querySelector(".player-board"),a=document.querySelector(".opponent-board");e(t),e(a)},insertDraggedImage:r,rotateShipImage:e=>{const t=Array.from(e.classList);t.includes("horizontal")?(e.classList.remove("horizontal"),e.classList.add("vertical")):t.includes("vertical")&&(e.classList.remove("vertical"),e.classList.add("horizontal"))},rotateDraggedImage:e=>{const t=e.target.cloneNode(),a=document.createElement("div");a.classList.add("temp-rotate"),((e,t)=>{const a=Array.from(t.classList);a.includes("horizontal")?e.classList.add("temp-rotate-horizontal"):a.includes("vertical")&&(e.classList.add("temp-rotate-vertical"),"5"===t.dataset.shipLength?e.classList.add("temp-rotate-vertical-5"):"4"===t.dataset.shipLength?e.classList.add("temp-rotate-vertical-4"):"3"===t.dataset.shipLength?e.classList.add("temp-rotate-vertical-3"):"2"===t.dataset.shipLength&&e.classList.add("temp-rotate-vertical-2"))})(a,t),a.appendChild(t),document.body.appendChild(a),e.dataTransfer.setDragImage(a,0,0),setTimeout((()=>{document.body.removeChild(a)}),0)},getDraggedImage:e=>{const t={image:e.target.src,shipLength:e.target.dataset.shipLength,horizontal:!1,vertical:!1,elementID:e.target.getAttribute("id")};Array.from(e.target.classList).includes("horizontal")?t.horizontal=!0:Array.from(e.target.classList).includes("vertical")&&(t.vertical=!0),console.log(t);const a=JSON.stringify(t);e.dataTransfer.setData("image",a)},dragOver:s,addAttackResultDOM:(e,t,a)=>{const s=a[0],r=a[1];console.log(e);const o=document.querySelector(`.${e}-board`).querySelector(`[data-row='${s}'][data-column='${r}']`),i=document.createElement("img");i.classList.add("attack-results"),o.appendChild(i),"hit"===t?i.setAttribute("src","../dist/red_X.png"):i.setAttribute("src","../dist/white_O.png"),o.disabled=!0},toggleAbilityToAttack:t}})(),t=t=>{const s="human"!==t&&("computer"===t||void 0),r=(()=>{const e=(()=>{const e=[];for(let t=0;t<10;t++){e.push([]);for(let a=0;a<10;a++)e[t].push(void 0)}return e})(),t=[],a=[],s=[],r=[],o=[];let i=!1;const d=t=>e[t[0]][t[1]];return{getCoordinates:d,getPlacedShips:()=>t,getReceivedMissedShots:()=>a,getReceivedHitShots:()=>s,getSentMissedShots:()=>r,getSentHitShots:()=>o,isAllShipsSunk:()=>i,placeShip:(a,s)=>{for(const t of s)e[t[0]][t[1]]=a;t.push(a)},receiveAttack:e=>{const r=d(e);return void 0!==r?(r.hit(),t.every((e=>e.isSunk()))&&(i=!0),s.push(e),"hit"):(a.push(e),"miss")},addSentMissedShot:e=>{r.push(e)},addSentHitShot:e=>{o.push(e)}}})();let o;const i=()=>s,d=(e,t)=>{const a=(e=>{const t=e;let a=0,s=!1;return{getShipLength:()=>t,getShipHits:()=>a,isSunk:()=>s,hit:()=>{if(s)return"That ship has already been sunk!";a+=1,a===t&&(s=!0)}}})(e);r.placeShip(a,t)},n=t=>{if(h(t)||!a.isInProgress()||a.isMidAttack())return;const s=o.getGameboard(),d=o.receiveAttack(t);if("hit"===d){if(r.addSentHitShot(t),i()?i()&&e.addAttackResultDOM("player",d,t):e.addAttackResultDOM("opponent",d,t),s.isAllShipsSunk())return void a.endGame(o)}else"miss"===d&&(r.addSentMissedShot(t),i()?i()&&e.addAttackResultDOM("player",d,t):e.addAttackResultDOM("opponent",d,t));o.isComputer()&&(a.toggleMidAttack(!0),setTimeout((()=>{a.toggleMidAttack(!1),o.sendComputerAttack()}),1e3))},l=e=>{let t=[];do{t=[];const a=c(),s=u(a,e);t.push(a),t=t.concat(s)}while(t.length<e);return t},c=()=>{const e=[void 0,void 0];do{e[0]=g(),e[1]=g()}while(void 0!==r.getCoordinates(e));return e},u=(e,t)=>{const a=[];if(p(e,t,"up")){const s=[];for(let a=1;a<t;a++)s.push([e[0]-a,e[1]]);a.push(s)}if(p(e,t,"right")){const s=[];for(let a=1;a<t;a++)s.push([e[0],e[1]+a]);a.push(s)}if(p(e,t,"down")){const s=[];for(let a=1;a<t;a++)s.push([e[0]+a,e[1]]);a.push(s)}if(p(e,t,"left")){const s=[];for(let a=1;a<t;a++)s.push([e[0],e[1]-a]);a.push(s)}return 0===a.length?a:a[Math.floor(Math.random()*a.length)]},g=()=>Math.floor(10*Math.random()),h=e=>{let t=!1;const a=o.getGameboard().getReceivedMissedShots(),s=o.getGameboard().getReceivedHitShots();return t=a.some((t=>t[0]===e[0]&&t[1]===e[1])),t||(t=s.some((t=>t[0]===e[0]&&t[1]===e[1]))),t},p=(e,t,a)=>{switch(a){case"up":if(e[0]-(t-1)<0)return!1;for(let a=1;a<t;a++)if(void 0!==r.getCoordinates([e[0]-a,e[1]]))return!1;return!0;case"right":if(e[1]+(t-1)>9)return!1;for(let a=1;a<t;a++)if(void 0!==r.getCoordinates([e[0],e[1]+a]))return!1;return!0;case"down":if(e[0]+(t-1)>9)return!1;for(let a=1;a<t;a++)if(void 0!==r.getCoordinates([e[0]+a,e[1]]))return!1;return!0;case"left":if(e[1]-(t-1)<0)return!1;for(let a=1;a<t;a++)if(void 0!==r.getCoordinates([e[0],e[1]-a]))return!1;return!0}};return{isComputer:i,getGameboard:()=>r,getOpposingPlayer:()=>o,setOpposingPlayer:e=>{o=e},addShipToGameboard:d,sendAttack:n,initializeComputerGameboard:()=>{if(!s)return;const e=[5,4,3,3,2];for(const t of e){const e=l(t);d(t,e)}},sendComputerAttack:()=>{if(!s||!a.isInProgress())return;const e=(()=>{const e=[void 0,void 0];do{e[0]=g(),e[1]=g()}while(h(e));return e})();n(e)},receiveAttack:e=>r.receiveAttack(e),checkIfValidEmptyCoordinates:p}},a=(()=>{const a=[];let s,r=!0,o=!1;return{getPlayers:()=>a,isInProgress:()=>r,getWinner:()=>s,isMidAttack:()=>o,toggleMidAttack:e=>{o=!!e},createGame:()=>{const e=t("human");a.push(e);const s=t("computer");a.push(s),e.setOpposingPlayer(s),s.setOpposingPlayer(e),s.initializeComputerGameboard()},endGame:t=>{r=!1,(e=>{const t=e.getOpposingPlayer();s=t})(t),e.toggleAbilityToAttack("disable")},resetGame:()=>{a.length=0,r=!0,s=void 0}}})(),s=()=>{document.querySelectorAll(".ship-placement").forEach((t=>{const a=t.querySelector("img"),s=t.querySelector("button");console.log(a,s),s.addEventListener("click",(()=>{e.rotateShipImage(a)}))}))},r=()=>{Array.from(document.querySelectorAll(".ship-piece")).forEach((t=>{t.addEventListener("dragstart",(t=>{e.getDraggedImage(t),e.rotateDraggedImage(t)}))}))};a.createGame(),e.initializeBoardDOM(),s(),r()})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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LEVBQU8sWUFDOUJzRSxFQUFRM0csS0FBS3NDLEdBQ2I0RSxFQUFZWixrQkFBa0JoRSxHQUM5QkEsRUFBZWdFLGtCQUFrQlksR0FDakM1RSxFQUFla0UsNkJBQTZCLEVBbUI1QzNCLFFBakJlc0MsSUFDZk4sR0FBYSxFQWxCRyxDQUFDTSxJQUNqQixNQUFNQyxFQUFlRCxFQUFZZCxvQkFDakNPLEVBQVNRLENBQVksRUFpQnJCQyxDQUFVRixHQUNWekwsRUFBY2dDLHNCQUFzQixVQUFVLEVBZTlDNEosVUFiZ0IsS0FDaEJYLEVBQVFsSixPQUFTLEVBQ2pCb0osR0FBYSxFQUNiRCxPQUFTbkUsQ0FBUyxFQVlyQixFQTdDZ0IsR0NIWDhFLEVBQzZCLEtBQ0RyTCxTQUFTd0MsaUJBQWlCLG1CQUNsQ0MsU0FBUzZJLElBQzdCLE1BQU0xRyxFQUFRMEcsRUFBZ0JoSixjQUFjLE9BQ3RDaUosRUFBU0QsRUFBZ0JoSixjQUFjLFVBQzdDWCxRQUFRQyxJQUFJZ0QsRUFBTzJHLEdBQ25CQSxFQUFPeEssaUJBQWlCLFNBQVMsS0FDL0J2QixFQUFjbUYsZ0JBQWdCQyxFQUFNLEdBQ3BDLEdBQ0YsRUFWQXlHLEVBWXlCLEtBQ1IzSyxNQUFNQyxLQUFLWCxTQUFTd0MsaUJBQWlCLGdCQUM3Q0MsU0FBUzZFLElBQ2xCQSxFQUFLdkcsaUJBQWlCLGFBQWNDLElBQ2xDeEIsRUFBY2lHLGdCQUFnQnpFLEdBQzlCeEIsRUFBY3VGLG1CQUFtQi9ELEVBQU0sR0FDdkMsR0FDRixFQ2pCTkcsRUFBUzRKLGFBRVR2TCxFQUFjZ0YscUJBRWQ2RyxJQUVBQSxHIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vb2Rpbi1iYXR0bGVzaGlwLy4vc3JjL3NoaXAuanMiLCJ3ZWJwYWNrOi8vb2Rpbi1iYXR0bGVzaGlwLy4vc3JjL0RPTV9jb250cm9sbGVyLmpzIiwid2VicGFjazovL29kaW4tYmF0dGxlc2hpcC8uL3NyYy9wbGF5ZXIuanMiLCJ3ZWJwYWNrOi8vb2Rpbi1iYXR0bGVzaGlwLy4vc3JjL2dhbWVib2FyZC5qcyIsIndlYnBhY2s6Ly9vZGluLWJhdHRsZXNoaXAvLi9zcmMvZ2FtZWxvb3AuanMiLCJ3ZWJwYWNrOi8vb2Rpbi1iYXR0bGVzaGlwLy4vc3JjL2V2ZW50X2xpc3RlbmVyX2NvbnRyb2xsZXIuanMiLCJ3ZWJwYWNrOi8vb2Rpbi1iYXR0bGVzaGlwLy4vc3JjL2luZGV4LmpzIl0sInNvdXJjZXNDb250ZW50IjpbImNvbnN0IFNoaXAgPSAoZ2l2ZW5MZW5ndGgpID0+IHtcbiAgY29uc3QgbGVuZ3RoID0gZ2l2ZW5MZW5ndGg7XG4gIGxldCBoaXRzID0gMDtcbiAgbGV0IHN1bmsgPSBmYWxzZTtcbiAgY29uc3QgZ2V0U2hpcExlbmd0aCA9ICgpID0+IGxlbmd0aDtcbiAgY29uc3QgZ2V0U2hpcEhpdHMgPSAoKSA9PiBoaXRzO1xuICBjb25zdCBpc1N1bmsgPSAoKSA9PiBzdW5rO1xuICBjb25zdCBjaGVja0lmU3VuayA9ICgpID0+IHtcbiAgICBpZiAoaGl0cyA9PT0gbGVuZ3RoKSB7XG4gICAgICBzdW5rID0gdHJ1ZTtcbiAgICB9XG4gIH07XG4gIGNvbnN0IGhpdCA9ICgpID0+IHtcbiAgICBpZiAoIXN1bmspIHtcbiAgICAgIGhpdHMgKz0gMTtcbiAgICAgIGNoZWNrSWZTdW5rKCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVybiBcIlRoYXQgc2hpcCBoYXMgYWxyZWFkeSBiZWVuIHN1bmshXCI7XG4gICAgfVxuICB9O1xuICByZXR1cm4ge1xuICAgIGdldFNoaXBMZW5ndGgsXG4gICAgZ2V0U2hpcEhpdHMsXG4gICAgaXNTdW5rLFxuICAgIGhpdCxcbiAgfTtcbn07XG5cbmV4cG9ydCB7IFNoaXAgfTtcbiIsImltcG9ydCB7IEdhbWVMb29wIH0gZnJvbSBcIi4vZ2FtZWxvb3BcIjtcblxuY29uc3QgRE9NQ29udHJvbGxlciA9ICgoKSA9PiB7XG4gIGNvbnN0IGNyZWF0ZUJvYXJkQ2VsbHMgPSAoZ2FtZWJvYXJkRE9NKSA9PiB7XG4gICAgY29uc3QgQk9BUkRBWEVTTEVOR1RIID0gMTA7XG4gICAgY29uc3QgY29sdW1uTGFiZWxzID0gW1wiQVwiLCBcIkJcIiwgXCJDXCIsIFwiRFwiLCBcIkVcIiwgXCJGXCIsIFwiR1wiLCBcIkhcIiwgXCJJXCIsIFwiSlwiXTtcbiAgICBjb25zdCByb3dMYWJlbHMgPSBbXCIxXCIsIFwiMlwiLCBcIjNcIiwgXCI0XCIsIFwiNVwiLCBcIjZcIiwgXCI3XCIsIFwiOFwiLCBcIjlcIiwgXCIxMFwiXTtcbiAgICBmb3IgKGxldCBpID0gLTE7IGkgPCBCT0FSREFYRVNMRU5HVEg7IGkrKykge1xuICAgICAgZm9yIChsZXQgaiA9IC0xOyBqIDwgQk9BUkRBWEVTTEVOR1RIOyBqKyspIHtcbiAgICAgICAgaWYgKGkgPT09IC0xKSB7XG4gICAgICAgICAgaWYgKGogPT09IC0xKSB7XG4gICAgICAgICAgICBjb25zdCBpbnZpc2libGVQbGFjZWhvbGRlckVsZW1lbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuICAgICAgICAgICAgaW52aXNpYmxlUGxhY2Vob2xkZXJFbGVtZW50LmNsYXNzTGlzdC5hZGQoXCJnYW1lYm9hcmQtbGFiZWxcIik7XG4gICAgICAgICAgICBpbnZpc2libGVQbGFjZWhvbGRlckVsZW1lbnQuc3R5bGUudmlzaWJpbGl0eSA9IFwiaGlkZGVuXCI7XG4gICAgICAgICAgICBnYW1lYm9hcmRET00uYXBwZW5kQ2hpbGQoaW52aXNpYmxlUGxhY2Vob2xkZXJFbGVtZW50KTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgY29uc3QgY29sdW1uTGFiZWxFbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcbiAgICAgICAgICAgIGNvbHVtbkxhYmVsRWxlbWVudC5jbGFzc0xpc3QuYWRkKFwiY29sdW1uLWxhYmVsXCIpO1xuICAgICAgICAgICAgY29sdW1uTGFiZWxFbGVtZW50LnRleHRDb250ZW50ID0gY29sdW1uTGFiZWxzW2pdO1xuICAgICAgICAgICAgZ2FtZWJvYXJkRE9NLmFwcGVuZENoaWxkKGNvbHVtbkxhYmVsRWxlbWVudCk7XG4gICAgICAgICAgfVxuICAgICAgICB9IGVsc2UgaWYgKGogPT09IC0xKSB7XG4gICAgICAgICAgY29uc3Qgcm93TGFiZWxFbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcbiAgICAgICAgICByb3dMYWJlbEVsZW1lbnQuY2xhc3NMaXN0LmFkZChcInJvdy1sYWJlbFwiKTtcbiAgICAgICAgICByb3dMYWJlbEVsZW1lbnQudGV4dENvbnRlbnQgPSByb3dMYWJlbHNbaV07XG4gICAgICAgICAgZ2FtZWJvYXJkRE9NLmFwcGVuZENoaWxkKHJvd0xhYmVsRWxlbWVudCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgLy8gY29uc3QgY2VsbEVsZW1lbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuICAgICAgICAgIC8vIGNlbGxFbGVtZW50LnNldEF0dHJpYnV0ZShcImRhdGEtcm93XCIsIGkpO1xuICAgICAgICAgIC8vIGNlbGxFbGVtZW50LnNldEF0dHJpYnV0ZShcImRhdGEtY29sdW1uXCIsIGopO1xuICAgICAgICAgIC8vIGNlbGxFbGVtZW50LmNsYXNzTGlzdC5hZGQoXCJnYW1lYm9hcmQtY2VsbFwiKTtcbiAgICAgICAgICAvLyBjZWxsRWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwiZHJhZ292ZXJcIiwgKGV2ZW50KSA9PiB7XG4gICAgICAgICAgLy8gICBkcmFnT3ZlcihldmVudCk7XG4gICAgICAgICAgLy8gfSk7XG4gICAgICAgICAgLy8gY2VsbEVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcImRyb3BcIiwgKGV2ZW50KSA9PiB7XG4gICAgICAgICAgLy8gICBpbnNlcnREcmFnZ2VkSW1hZ2UoZXZlbnQpO1xuICAgICAgICAgIC8vIH0pO1xuICAgICAgICAgIGlmIChBcnJheS5mcm9tKGdhbWVib2FyZERPTS5jbGFzc0xpc3QpLmluY2x1ZGVzKFwicGxheWVyLWJvYXJkXCIpKSB7XG4gICAgICAgICAgICBjb25zdCBjZWxsRWxlbWVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG4gICAgICAgICAgICBjZWxsRWxlbWVudC5zZXRBdHRyaWJ1dGUoXCJkYXRhLXJvd1wiLCBpKTtcbiAgICAgICAgICAgIGNlbGxFbGVtZW50LnNldEF0dHJpYnV0ZShcImRhdGEtY29sdW1uXCIsIGopO1xuICAgICAgICAgICAgY2VsbEVsZW1lbnQuY2xhc3NMaXN0LmFkZChcImdhbWVib2FyZC1jZWxsXCIpO1xuICAgICAgICAgICAgY2VsbEVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcImRyYWdvdmVyXCIsIChldmVudCkgPT4ge1xuICAgICAgICAgICAgICBkcmFnT3ZlcihldmVudCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIGNlbGxFbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJkcm9wXCIsIChldmVudCkgPT4ge1xuICAgICAgICAgICAgICBpbnNlcnREcmFnZ2VkSW1hZ2UoZXZlbnQpO1xuICAgICAgICAgICAgICBpZiAoXG4gICAgICAgICAgICAgICAgR2FtZUxvb3AuZ2V0UGxheWVycygpWzBdLmdldEdhbWVib2FyZCgpLmdldFBsYWNlZFNoaXBzKClcbiAgICAgICAgICAgICAgICAgIC5sZW5ndGggPT09IDVcbiAgICAgICAgICAgICAgKSB7XG4gICAgICAgICAgICAgICAgdG9nZ2xlQWJpbGl0eVRvQXR0YWNrKFwiZW5hYmxlXCIpO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIGdhbWVib2FyZERPTS5hcHBlbmRDaGlsZChjZWxsRWxlbWVudCk7XG4gICAgICAgICAgfSBlbHNlIGlmIChcbiAgICAgICAgICAgIEFycmF5LmZyb20oZ2FtZWJvYXJkRE9NLmNsYXNzTGlzdCkuaW5jbHVkZXMoXCJvcHBvbmVudC1ib2FyZFwiKVxuICAgICAgICAgICkge1xuICAgICAgICAgICAgY29uc3QgY2VsbEVsZW1lbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiYnV0dG9uXCIpO1xuICAgICAgICAgICAgY2VsbEVsZW1lbnQuc2V0QXR0cmlidXRlKFwiZGF0YS1yb3dcIiwgaSk7XG4gICAgICAgICAgICBjZWxsRWxlbWVudC5zZXRBdHRyaWJ1dGUoXCJkYXRhLWNvbHVtblwiLCBqKTtcbiAgICAgICAgICAgIGNlbGxFbGVtZW50LmNsYXNzTGlzdC5hZGQoXCJnYW1lYm9hcmQtY2VsbFwiKTtcbiAgICAgICAgICAgIGNlbGxFbGVtZW50LmRpc2FibGVkID0gdHJ1ZTtcbiAgICAgICAgICAgIGNlbGxFbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoZXZlbnQpID0+IHtcbiAgICAgICAgICAgICAgaWYgKCFHYW1lTG9vcC5pc01pZEF0dGFjaygpKSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coY2VsbEVsZW1lbnQpO1xuICAgICAgICAgICAgICAgIGNvbnN0IGNlbGxSb3cgPSBOdW1iZXIoY2VsbEVsZW1lbnQuZGF0YXNldC5yb3cpO1xuICAgICAgICAgICAgICAgIGNvbnN0IGNlbGxDb2x1bW4gPSBOdW1iZXIoY2VsbEVsZW1lbnQuZGF0YXNldC5jb2x1bW4pO1xuICAgICAgICAgICAgICAgIEdhbWVMb29wLmdldFBsYXllcnMoKVswXS5zZW5kQXR0YWNrKFtjZWxsUm93LCBjZWxsQ29sdW1uXSk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgZ2FtZWJvYXJkRE9NLmFwcGVuZENoaWxkKGNlbGxFbGVtZW50KTtcbiAgICAgICAgICB9XG4gICAgICAgICAgLy8gc29tZSBjbGljayBldmVudCBsaXN0ZW5lciB3aGVyZSBhdHRhY2sgaXMgbWFkZSBPUiBwcmlvciB0byB0aGF0LCBwbGFjaW5nIHNoaXAgb24gdGhhdCBjZWxsXG4gICAgICAgICAgLy8gZ2FtZWJvYXJkRE9NLmFwcGVuZENoaWxkKGNlbGxFbGVtZW50KTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfTtcbiAgY29uc3QgdG9nZ2xlQWJpbGl0eVRvQXR0YWNrID0gKGFjdGlvbikgPT4ge1xuICAgIGNvbnN0IGNvbXB1dGVyR2FtZWJvYXJkRWxlbWVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIub3Bwb25lbnQtYm9hcmRcIik7XG4gICAgY29uc3QgY2VsbEVsZW1lbnRzID0gQXJyYXkuZnJvbShcbiAgICAgIGNvbXB1dGVyR2FtZWJvYXJkRWxlbWVudC5xdWVyeVNlbGVjdG9yQWxsKFwiLmdhbWVib2FyZC1jZWxsXCIpXG4gICAgKTtcbiAgICBpZiAoYWN0aW9uID09PSBcImVuYWJsZVwiKSB7XG4gICAgICBjZWxsRWxlbWVudHMuZm9yRWFjaCgoY2VsbEVsZW1lbnQpID0+IHtcbiAgICAgICAgY2VsbEVsZW1lbnQuZGlzYWJsZWQgPSBmYWxzZTtcbiAgICAgIH0pO1xuICAgIH0gZWxzZSBpZiAoYWN0aW9uID09PSBcImRpc2FibGVcIikge1xuICAgICAgY2VsbEVsZW1lbnRzLmZvckVhY2goKGNlbGxFbGVtZW50KSA9PiB7XG4gICAgICAgIGNlbGxFbGVtZW50LmRpc2FibGVkID0gdHJ1ZTtcbiAgICAgIH0pO1xuICAgIH1cbiAgfTtcbiAgY29uc3QgZ2V0RHJhZ2dlZEltYWdlID0gKGV2ZW50KSA9PiB7XG4gICAgY29uc3QgZGF0YU9iamVjdCA9IHtcbiAgICAgIGltYWdlOiBldmVudC50YXJnZXQuc3JjLFxuICAgICAgc2hpcExlbmd0aDogZXZlbnQudGFyZ2V0LmRhdGFzZXQuc2hpcExlbmd0aCxcbiAgICAgIGhvcml6b250YWw6IGZhbHNlLFxuICAgICAgdmVydGljYWw6IGZhbHNlLFxuICAgICAgZWxlbWVudElEOiBldmVudC50YXJnZXQuZ2V0QXR0cmlidXRlKFwiaWRcIiksXG4gICAgfTtcbiAgICBpZiAoQXJyYXkuZnJvbShldmVudC50YXJnZXQuY2xhc3NMaXN0KS5pbmNsdWRlcyhcImhvcml6b250YWxcIikpIHtcbiAgICAgIGRhdGFPYmplY3QuaG9yaXpvbnRhbCA9IHRydWU7XG4gICAgfSBlbHNlIGlmIChBcnJheS5mcm9tKGV2ZW50LnRhcmdldC5jbGFzc0xpc3QpLmluY2x1ZGVzKFwidmVydGljYWxcIikpIHtcbiAgICAgIGRhdGFPYmplY3QudmVydGljYWwgPSB0cnVlO1xuICAgIH1cbiAgICBjb25zb2xlLmxvZyhkYXRhT2JqZWN0KTtcbiAgICBjb25zdCBkYXRhU3RyaW5nID0gSlNPTi5zdHJpbmdpZnkoZGF0YU9iamVjdCk7XG4gICAgZXZlbnQuZGF0YVRyYW5zZmVyLnNldERhdGEoXCJpbWFnZVwiLCBkYXRhU3RyaW5nKTtcbiAgfTtcbiAgY29uc3QgZHJhZ092ZXIgPSAoKSA9PiB7XG4gICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgfTtcbiAgY29uc3QgaW5pdGlhbGl6ZUJvYXJkRE9NID0gKCkgPT4ge1xuICAgIGNvbnN0IGh1bWFuUGxheWVyR2FtZWJvYXJkRE9NID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wbGF5ZXItYm9hcmRcIik7XG4gICAgY29uc3Qgb3Bwb25lbnRHYW1lYm9hcmRET00gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLm9wcG9uZW50LWJvYXJkXCIpO1xuICAgIGNyZWF0ZUJvYXJkQ2VsbHMoaHVtYW5QbGF5ZXJHYW1lYm9hcmRET00pO1xuICAgIGNyZWF0ZUJvYXJkQ2VsbHMob3Bwb25lbnRHYW1lYm9hcmRET00pO1xuICB9O1xuICBjb25zdCBpc1ZhbGlkR2FtZWJvYXJkQ2VsbCA9ICh0YXJnZXRDZWxsLCBkYXRhT2JqZWN0KSA9PiB7XG4gICAgY29uc3QgY2VsbENvb3JkaW5hdGVzID0gW1xuICAgICAgTnVtYmVyKHRhcmdldENlbGwuZGF0YXNldC5yb3cpLFxuICAgICAgTnVtYmVyKHRhcmdldENlbGwuZGF0YXNldC5jb2x1bW4pLFxuICAgIF07XG4gICAgY29uc3QgbGVuZ3RoID0gTnVtYmVyKGRhdGFPYmplY3Quc2hpcExlbmd0aCk7XG4gICAgaWYgKGRhdGFPYmplY3QuaG9yaXpvbnRhbCkge1xuICAgICAgaWYgKFxuICAgICAgICBHYW1lTG9vcC5nZXRQbGF5ZXJzKClbMF0uY2hlY2tJZlZhbGlkRW1wdHlDb29yZGluYXRlcyhcbiAgICAgICAgICBjZWxsQ29vcmRpbmF0ZXMsXG4gICAgICAgICAgbGVuZ3RoLFxuICAgICAgICAgIFwicmlnaHRcIlxuICAgICAgICApXG4gICAgICApIHtcbiAgICAgICAgY29uc29sZS5sb2coXCJmaXRzXCIpO1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgIH1cbiAgICAgIGNvbnNvbGUubG9nKFwibm9wZVwiKTtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgaWYgKGRhdGFPYmplY3QudmVydGljYWwpIHtcbiAgICAgIGlmIChcbiAgICAgICAgR2FtZUxvb3AuZ2V0UGxheWVycygpWzBdLmNoZWNrSWZWYWxpZEVtcHR5Q29vcmRpbmF0ZXMoXG4gICAgICAgICAgY2VsbENvb3JkaW5hdGVzLFxuICAgICAgICAgIGxlbmd0aCxcbiAgICAgICAgICBcImRvd25cIlxuICAgICAgICApXG4gICAgICApIHtcbiAgICAgICAgY29uc29sZS5sb2coXCJmaXRzXCIpO1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgIH1cbiAgICAgIGNvbnNvbGUubG9nKFwibm9wZVwiKTtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gIH07XG4gIGNvbnN0IGFkZFNoaXBUb0RPTSA9ICh0YXJnZXRDZWxsLCBkYXRhT2JqZWN0KSA9PiB7XG4gICAgY29uc3QgbGVuZ3RoID0gZGF0YU9iamVjdC5zaGlwTGVuZ3RoO1xuICAgIGNvbnN0IHRhcmdldENlbGxSb3cgPSBOdW1iZXIodGFyZ2V0Q2VsbC5kYXRhc2V0LnJvdyk7XG4gICAgY29uc3QgdGFyZ2V0Q2VsbENvbHVtbiA9IE51bWJlcih0YXJnZXRDZWxsLmRhdGFzZXQuY29sdW1uKTtcbiAgICBjb25zdCBjb29yZGluYXRlc0FycmF5ID0gW1t0YXJnZXRDZWxsUm93LCB0YXJnZXRDZWxsQ29sdW1uXV07XG4gICAgdGFyZ2V0Q2VsbC5jbGFzc0xpc3QuYWRkKFwiY29udGFpbnMtc2hpcC1pbWFnZVwiKTtcbiAgICB0YXJnZXRDZWxsLmNsYXNzTGlzdC5hZGQoXCJzaGlwLWltYWdlXCIpO1xuICAgIHRhcmdldENlbGwuY2xhc3NMaXN0LmFkZChgc2hpcC1pbWFnZS0ke2xlbmd0aH1gKTtcbiAgICB0YXJnZXRDZWxsLmNsYXNzTGlzdC5hZGQoYHNoaXAtaW1hZ2UtJHtsZW5ndGh9LTFgKTtcbiAgICBpZiAoZGF0YU9iamVjdC5ob3Jpem9udGFsKSB7XG4gICAgICB0YXJnZXRDZWxsLmNsYXNzTGlzdC5hZGQoXCJob3Jpem9udGFsXCIpO1xuICAgIH0gZWxzZSBpZiAoZGF0YU9iamVjdC52ZXJ0aWNhbCkge1xuICAgICAgdGFyZ2V0Q2VsbC5jbGFzc0xpc3QuYWRkKFwidmVydGljYWxcIik7XG4gICAgfVxuICAgIGZvciAobGV0IGkgPSAxOyBpIDwgbGVuZ3RoOyBpKyspIHtcbiAgICAgIGxldCByZW1haW5pbmdDZWxsO1xuICAgICAgaWYgKGRhdGFPYmplY3QuaG9yaXpvbnRhbCkge1xuICAgICAgICByZW1haW5pbmdDZWxsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcbiAgICAgICAgICBgLnBsYXllci1ib2FyZCBbZGF0YS1yb3c9JyR7dGFyZ2V0Q2VsbFJvd30nXVtkYXRhLWNvbHVtbj0nJHtcbiAgICAgICAgICAgIHRhcmdldENlbGxDb2x1bW4gKyBpXG4gICAgICAgICAgfSddYFxuICAgICAgICApO1xuICAgICAgICByZW1haW5pbmdDZWxsLmNsYXNzTGlzdC5hZGQoXCJob3Jpem9udGFsXCIpO1xuICAgICAgICBjb29yZGluYXRlc0FycmF5LnB1c2goW3RhcmdldENlbGxSb3csIHRhcmdldENlbGxDb2x1bW4gKyBpXSk7XG4gICAgICB9IGVsc2UgaWYgKGRhdGFPYmplY3QudmVydGljYWwpIHtcbiAgICAgICAgcmVtYWluaW5nQ2VsbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXG4gICAgICAgICAgYC5wbGF5ZXItYm9hcmQgW2RhdGEtcm93PScke1xuICAgICAgICAgICAgdGFyZ2V0Q2VsbFJvdyArIGlcbiAgICAgICAgICB9J11bZGF0YS1jb2x1bW49JyR7dGFyZ2V0Q2VsbENvbHVtbn0nXWBcbiAgICAgICAgKTtcbiAgICAgICAgcmVtYWluaW5nQ2VsbC5jbGFzc0xpc3QuYWRkKFwidmVydGljYWxcIik7XG4gICAgICAgIGNvb3JkaW5hdGVzQXJyYXkucHVzaChbdGFyZ2V0Q2VsbFJvdyArIGksIHRhcmdldENlbGxDb2x1bW5dKTtcbiAgICAgIH1cbiAgICAgIHJlbWFpbmluZ0NlbGwuY2xhc3NMaXN0LmFkZChcImNvbnRhaW5zLXNoaXAtaW1hZ2VcIik7XG4gICAgICByZW1haW5pbmdDZWxsLmNsYXNzTGlzdC5hZGQoXCJzaGlwLWltYWdlXCIpO1xuICAgICAgcmVtYWluaW5nQ2VsbC5jbGFzc0xpc3QuYWRkKGBzaGlwLWltYWdlLSR7bGVuZ3RofWApO1xuICAgICAgcmVtYWluaW5nQ2VsbC5jbGFzc0xpc3QuYWRkKGBzaGlwLWltYWdlLSR7bGVuZ3RofS0ke2kgKyAxfWApO1xuICAgIH1cbiAgICByZXR1cm4gY29vcmRpbmF0ZXNBcnJheTtcbiAgfTtcbiAgY29uc3QgZGlzYWJsZUltYWdlQnV0dG9uSW50ZXJhY3Rpb25zID0gKGRhdGFPYmplY3QpID0+IHtcbiAgICBjb25zdCBJRCA9IGRhdGFPYmplY3QuZWxlbWVudElEO1xuICAgIGNvbnN0IGltYWdlRWxlbWVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYCMke0lEfWApO1xuICAgIGNvbnN0IGJ1dHRvbkVsZW1lbnQgPSBpbWFnZUVsZW1lbnQucGFyZW50Tm9kZS5xdWVyeVNlbGVjdG9yKFwiYnV0dG9uXCIpO1xuICAgIGltYWdlRWxlbWVudC5zZXRBdHRyaWJ1dGUoXCJkcmFnZ2FibGVcIiwgZmFsc2UpO1xuICAgIGltYWdlRWxlbWVudC5jbGFzc0xpc3QuYWRkKFwiZGlzYWJsZWQtaW1hZ2VcIik7XG4gICAgYnV0dG9uRWxlbWVudC5kaXNhYmxlZCA9IHRydWU7XG4gIH07XG4gIGNvbnN0IGluc2VydERyYWdnZWRJbWFnZSA9IChldmVudCkgPT4ge1xuICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgY29uc3QgdGFyZ2V0Q2VsbCA9IGV2ZW50LnRhcmdldDtcbiAgICBpZiAoQXJyYXkuZnJvbSh0YXJnZXRDZWxsLmNsYXNzTGlzdCkuaW5jbHVkZXMoXCJjb250YWlucy1zaGlwLWltYWdlXCIpKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGNvbnN0IGRhdGFTdHJpbmcgPSBldmVudC5kYXRhVHJhbnNmZXIuZ2V0RGF0YShcImltYWdlXCIpO1xuICAgIGNvbnN0IGRhdGFPYmplY3QgPSBKU09OLnBhcnNlKGRhdGFTdHJpbmcpO1xuICAgIGlmICghaXNWYWxpZEdhbWVib2FyZENlbGwodGFyZ2V0Q2VsbCwgZGF0YU9iamVjdCkpIHtcbiAgICAgIC8vIHByb2JhYmx5IG1ha2Ugc29tZSBET00gZXJyb3IgbWVzc2FnZSBhcHBlYXJcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgY29uc3Qgc2hpcENvb3JkaW5hdGVzID0gYWRkU2hpcFRvRE9NKHRhcmdldENlbGwsIGRhdGFPYmplY3QpO1xuICAgIEdhbWVMb29wLmdldFBsYXllcnMoKVswXS5hZGRTaGlwVG9HYW1lYm9hcmQoXG4gICAgICBOdW1iZXIoZGF0YU9iamVjdC5zaGlwTGVuZ3RoKSxcbiAgICAgIHNoaXBDb29yZGluYXRlc1xuICAgICk7XG4gICAgZGlzYWJsZUltYWdlQnV0dG9uSW50ZXJhY3Rpb25zKGRhdGFPYmplY3QpO1xuICAgIHRhcmdldENlbGwucmVtb3ZlRXZlbnRMaXN0ZW5lcihcImRyb3BcIiwgaW5zZXJ0RHJhZ2dlZEltYWdlKTtcbiAgfTtcbiAgY29uc3Qgcm90YXRlU2hpcEltYWdlID0gKGltYWdlKSA9PiB7XG4gICAgY29uc3QgaW1hZ2VDbGFzc2VzID0gQXJyYXkuZnJvbShpbWFnZS5jbGFzc0xpc3QpO1xuICAgIGlmIChpbWFnZUNsYXNzZXMuaW5jbHVkZXMoXCJob3Jpem9udGFsXCIpKSB7XG4gICAgICBpbWFnZS5jbGFzc0xpc3QucmVtb3ZlKFwiaG9yaXpvbnRhbFwiKTtcbiAgICAgIGltYWdlLmNsYXNzTGlzdC5hZGQoXCJ2ZXJ0aWNhbFwiKTtcbiAgICB9IGVsc2UgaWYgKGltYWdlQ2xhc3Nlcy5pbmNsdWRlcyhcInZlcnRpY2FsXCIpKSB7XG4gICAgICBpbWFnZS5jbGFzc0xpc3QucmVtb3ZlKFwidmVydGljYWxcIik7XG4gICAgICBpbWFnZS5jbGFzc0xpc3QuYWRkKFwiaG9yaXpvbnRhbFwiKTtcbiAgICB9XG4gIH07XG4gIGNvbnN0IHJvdGF0ZVBlckxlbmd0aCA9ICh0ZW1wRGl2LCBjbG9uZWRJbWFnZUVsZW1lbnQpID0+IHtcbiAgICBjb25zdCBjbG9uZWRJbWFnZUVsZW1lbnRDbGFzc2VzID0gQXJyYXkuZnJvbShjbG9uZWRJbWFnZUVsZW1lbnQuY2xhc3NMaXN0KTtcbiAgICBpZiAoY2xvbmVkSW1hZ2VFbGVtZW50Q2xhc3Nlcy5pbmNsdWRlcyhcImhvcml6b250YWxcIikpIHtcbiAgICAgIHRlbXBEaXYuY2xhc3NMaXN0LmFkZChcInRlbXAtcm90YXRlLWhvcml6b250YWxcIik7XG4gICAgfSBlbHNlIGlmIChjbG9uZWRJbWFnZUVsZW1lbnRDbGFzc2VzLmluY2x1ZGVzKFwidmVydGljYWxcIikpIHtcbiAgICAgIHRlbXBEaXYuY2xhc3NMaXN0LmFkZChcInRlbXAtcm90YXRlLXZlcnRpY2FsXCIpO1xuICAgICAgaWYgKGNsb25lZEltYWdlRWxlbWVudC5kYXRhc2V0LnNoaXBMZW5ndGggPT09IFwiNVwiKSB7XG4gICAgICAgIHRlbXBEaXYuY2xhc3NMaXN0LmFkZChcInRlbXAtcm90YXRlLXZlcnRpY2FsLTVcIik7XG4gICAgICB9IGVsc2UgaWYgKGNsb25lZEltYWdlRWxlbWVudC5kYXRhc2V0LnNoaXBMZW5ndGggPT09IFwiNFwiKSB7XG4gICAgICAgIHRlbXBEaXYuY2xhc3NMaXN0LmFkZChcInRlbXAtcm90YXRlLXZlcnRpY2FsLTRcIik7XG4gICAgICB9IGVsc2UgaWYgKGNsb25lZEltYWdlRWxlbWVudC5kYXRhc2V0LnNoaXBMZW5ndGggPT09IFwiM1wiKSB7XG4gICAgICAgIHRlbXBEaXYuY2xhc3NMaXN0LmFkZChcInRlbXAtcm90YXRlLXZlcnRpY2FsLTNcIik7XG4gICAgICB9IGVsc2UgaWYgKGNsb25lZEltYWdlRWxlbWVudC5kYXRhc2V0LnNoaXBMZW5ndGggPT09IFwiMlwiKSB7XG4gICAgICAgIHRlbXBEaXYuY2xhc3NMaXN0LmFkZChcInRlbXAtcm90YXRlLXZlcnRpY2FsLTJcIik7XG4gICAgICB9XG4gICAgfVxuICB9O1xuICBjb25zdCByb3RhdGVEcmFnZ2VkSW1hZ2UgPSAoZXZlbnQpID0+IHtcbiAgICBjb25zdCBpbWFnZUVsZW1lbnQgPSBldmVudC50YXJnZXQ7XG4gICAgY29uc3QgY2xvbmVkSW1hZ2VFbGVtZW50ID0gaW1hZ2VFbGVtZW50LmNsb25lTm9kZSgpO1xuICAgIGNvbnN0IHRlbXBEaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuICAgIHRlbXBEaXYuY2xhc3NMaXN0LmFkZChcInRlbXAtcm90YXRlXCIpO1xuICAgIHJvdGF0ZVBlckxlbmd0aCh0ZW1wRGl2LCBjbG9uZWRJbWFnZUVsZW1lbnQpO1xuICAgIHRlbXBEaXYuYXBwZW5kQ2hpbGQoY2xvbmVkSW1hZ2VFbGVtZW50KTtcbiAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKHRlbXBEaXYpO1xuICAgIGV2ZW50LmRhdGFUcmFuc2Zlci5zZXREcmFnSW1hZ2UodGVtcERpdiwgMCwgMCk7XG4gICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICBkb2N1bWVudC5ib2R5LnJlbW92ZUNoaWxkKHRlbXBEaXYpO1xuICAgIH0sIDApO1xuICB9O1xuICBjb25zdCBhZGRBdHRhY2tSZXN1bHRET00gPSAocGxheWVyVHlwZSwgYXR0YWNrUmVzdWx0cywgY29vcmRpbmF0ZXMpID0+IHtcbiAgICBjb25zdCBjZWxsUm93ID0gY29vcmRpbmF0ZXNbMF07XG4gICAgY29uc3QgY2VsbENvbHVtbiA9IGNvb3JkaW5hdGVzWzFdO1xuICAgIGNvbnNvbGUubG9nKHBsYXllclR5cGUpO1xuICAgIGNvbnN0IGdhbWVib2FyZERPTSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYC4ke3BsYXllclR5cGV9LWJvYXJkYCk7XG4gICAgY29uc3QgdGFyZ2V0Q2VsbCA9IGdhbWVib2FyZERPTS5xdWVyeVNlbGVjdG9yKFxuICAgICAgYFtkYXRhLXJvdz0nJHtjZWxsUm93fSddW2RhdGEtY29sdW1uPScke2NlbGxDb2x1bW59J11gXG4gICAgKTtcbiAgICBjb25zdCBhdHRhY2tSZXN1bHRzRWxlbWVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJpbWdcIik7XG4gICAgYXR0YWNrUmVzdWx0c0VsZW1lbnQuY2xhc3NMaXN0LmFkZChcImF0dGFjay1yZXN1bHRzXCIpO1xuICAgIHRhcmdldENlbGwuYXBwZW5kQ2hpbGQoYXR0YWNrUmVzdWx0c0VsZW1lbnQpO1xuICAgIGlmIChhdHRhY2tSZXN1bHRzID09PSBcImhpdFwiKSB7XG4gICAgICBhdHRhY2tSZXN1bHRzRWxlbWVudC5zZXRBdHRyaWJ1dGUoXCJzcmNcIiwgXCIuLi9kaXN0L3JlZF9YLnBuZ1wiKTtcbiAgICB9IGVsc2Uge1xuICAgICAgYXR0YWNrUmVzdWx0c0VsZW1lbnQuc2V0QXR0cmlidXRlKFwic3JjXCIsIFwiLi4vZGlzdC93aGl0ZV9PLnBuZ1wiKTtcbiAgICB9XG4gICAgdGFyZ2V0Q2VsbC5kaXNhYmxlZCA9IHRydWU7XG4gIH07XG4gIHJldHVybiB7XG4gICAgaW5pdGlhbGl6ZUJvYXJkRE9NLFxuICAgIGluc2VydERyYWdnZWRJbWFnZSxcbiAgICByb3RhdGVTaGlwSW1hZ2UsXG4gICAgcm90YXRlRHJhZ2dlZEltYWdlLFxuICAgIGdldERyYWdnZWRJbWFnZSxcbiAgICBkcmFnT3ZlcixcbiAgICBhZGRBdHRhY2tSZXN1bHRET00sXG4gICAgdG9nZ2xlQWJpbGl0eVRvQXR0YWNrLFxuICB9O1xufSkoKTtcblxuZXhwb3J0IHsgRE9NQ29udHJvbGxlciB9O1xuIiwiaW1wb3J0IHsgU2hpcCB9IGZyb20gXCIuL3NoaXBcIjtcbmltcG9ydCB7IEdhbWVib2FyZCB9IGZyb20gXCIuL2dhbWVib2FyZFwiO1xuaW1wb3J0IHsgR2FtZUxvb3AgfSBmcm9tIFwiLi9nYW1lbG9vcFwiO1xuaW1wb3J0IHsgRE9NQ29udHJvbGxlciB9IGZyb20gXCIuL0RPTV9jb250cm9sbGVyXCI7XG5cbmNvbnN0IFBsYXllciA9IChwbGF5ZXJUeXBlKSA9PiB7XG4gIGNvbnN0IGRldGVybWluZVBsYXllclR5cGUgPSAoKSA9PiB7XG4gICAgaWYgKHBsYXllclR5cGUgPT09IFwiaHVtYW5cIikge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICBpZiAocGxheWVyVHlwZSA9PT0gXCJjb21wdXRlclwiKSB7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gIH07XG4gIGNvbnN0IGNvbXB1dGVyUGxheWVyID0gZGV0ZXJtaW5lUGxheWVyVHlwZSgpO1xuICBjb25zdCBwbGF5ZXJHYW1lYm9hcmQgPSBHYW1lYm9hcmQoKTtcbiAgbGV0IG9wcG9zaW5nUGxheWVyO1xuICBjb25zdCBpc0NvbXB1dGVyID0gKCkgPT4gY29tcHV0ZXJQbGF5ZXI7XG4gIGNvbnN0IGdldEdhbWVib2FyZCA9ICgpID0+IHBsYXllckdhbWVib2FyZDtcbiAgY29uc3QgZ2V0T3Bwb3NpbmdQbGF5ZXIgPSAoKSA9PiBvcHBvc2luZ1BsYXllcjtcbiAgY29uc3Qgc2V0T3Bwb3NpbmdQbGF5ZXIgPSAocGxheWVyKSA9PiB7XG4gICAgb3Bwb3NpbmdQbGF5ZXIgPSBwbGF5ZXI7XG4gIH07XG4gIGNvbnN0IGFkZFNoaXBUb0dhbWVib2FyZCA9IChzaGlwTGVuZ3RoLCBjb29yZGluYXRlcykgPT4ge1xuICAgIGNvbnN0IHNoaXAgPSBTaGlwKHNoaXBMZW5ndGgpO1xuICAgIHBsYXllckdhbWVib2FyZC5wbGFjZVNoaXAoc2hpcCwgY29vcmRpbmF0ZXMpO1xuICB9O1xuICBjb25zdCBzZW5kQXR0YWNrID0gKGNvb3JkaW5hdGVzKSA9PiB7XG4gICAgaWYgKFxuICAgICAgY2hlY2tJZlByZXZpb3VzbHlBdHRhY2tlZChjb29yZGluYXRlcykgfHxcbiAgICAgICFHYW1lTG9vcC5pc0luUHJvZ3Jlc3MoKSB8fFxuICAgICAgR2FtZUxvb3AuaXNNaWRBdHRhY2soKVxuICAgICkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBjb25zdCBvcHBvc2luZ1BsYXllckdhbWVib2FyZCA9IG9wcG9zaW5nUGxheWVyLmdldEdhbWVib2FyZCgpO1xuICAgIGNvbnN0IGF0dGFja1Jlc3VsdHMgPSBvcHBvc2luZ1BsYXllci5yZWNlaXZlQXR0YWNrKGNvb3JkaW5hdGVzKTtcbiAgICBpZiAoYXR0YWNrUmVzdWx0cyA9PT0gXCJoaXRcIikge1xuICAgICAgcGxheWVyR2FtZWJvYXJkLmFkZFNlbnRIaXRTaG90KGNvb3JkaW5hdGVzKTtcbiAgICAgIGlmICghaXNDb21wdXRlcigpKSB7XG4gICAgICAgIERPTUNvbnRyb2xsZXIuYWRkQXR0YWNrUmVzdWx0RE9NKFxuICAgICAgICAgIFwib3Bwb25lbnRcIixcbiAgICAgICAgICBhdHRhY2tSZXN1bHRzLFxuICAgICAgICAgIGNvb3JkaW5hdGVzXG4gICAgICAgICk7XG4gICAgICB9IGVsc2UgaWYgKGlzQ29tcHV0ZXIoKSkge1xuICAgICAgICBET01Db250cm9sbGVyLmFkZEF0dGFja1Jlc3VsdERPTShcInBsYXllclwiLCBhdHRhY2tSZXN1bHRzLCBjb29yZGluYXRlcyk7XG4gICAgICB9XG4gICAgICBpZiAob3Bwb3NpbmdQbGF5ZXJHYW1lYm9hcmQuaXNBbGxTaGlwc1N1bmsoKSkge1xuICAgICAgICBHYW1lTG9vcC5lbmRHYW1lKG9wcG9zaW5nUGxheWVyKTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgIH0gZWxzZSBpZiAoYXR0YWNrUmVzdWx0cyA9PT0gXCJtaXNzXCIpIHtcbiAgICAgIHBsYXllckdhbWVib2FyZC5hZGRTZW50TWlzc2VkU2hvdChjb29yZGluYXRlcyk7XG4gICAgICBpZiAoIWlzQ29tcHV0ZXIoKSkge1xuICAgICAgICBET01Db250cm9sbGVyLmFkZEF0dGFja1Jlc3VsdERPTShcbiAgICAgICAgICBcIm9wcG9uZW50XCIsXG4gICAgICAgICAgYXR0YWNrUmVzdWx0cyxcbiAgICAgICAgICBjb29yZGluYXRlc1xuICAgICAgICApO1xuICAgICAgfSBlbHNlIGlmIChpc0NvbXB1dGVyKCkpIHtcbiAgICAgICAgRE9NQ29udHJvbGxlci5hZGRBdHRhY2tSZXN1bHRET00oXCJwbGF5ZXJcIiwgYXR0YWNrUmVzdWx0cywgY29vcmRpbmF0ZXMpO1xuICAgICAgfVxuICAgIH1cbiAgICBpZiAob3Bwb3NpbmdQbGF5ZXIuaXNDb21wdXRlcigpKSB7XG4gICAgICBHYW1lTG9vcC50b2dnbGVNaWRBdHRhY2sodHJ1ZSk7XG4gICAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgR2FtZUxvb3AudG9nZ2xlTWlkQXR0YWNrKGZhbHNlKTtcbiAgICAgICAgb3Bwb3NpbmdQbGF5ZXIuc2VuZENvbXB1dGVyQXR0YWNrKCk7XG4gICAgICB9LCAxMDAwKTtcbiAgICB9XG4gIH07XG4gIGNvbnN0IGluaXRpYWxpemVDb21wdXRlckdhbWVib2FyZCA9ICgpID0+IHtcbiAgICBpZiAoIWNvbXB1dGVyUGxheWVyKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGNvbnN0IGxlbmd0aHNPZlNoaXBzID0gWzUsIDQsIDMsIDMsIDJdO1xuICAgIGZvciAoY29uc3Qgc2hpcExlbmd0aCBvZiBsZW5ndGhzT2ZTaGlwcykge1xuICAgICAgY29uc3Qgc2hpcENvb3JkaW5hdGVzID0gZ2VuZXJhdGVDb21wdXRlclNoaXBDb29yZGluYXRlcyhzaGlwTGVuZ3RoKTtcbiAgICAgIGFkZFNoaXBUb0dhbWVib2FyZChzaGlwTGVuZ3RoLCBzaGlwQ29vcmRpbmF0ZXMpO1xuICAgIH1cbiAgfTtcbiAgY29uc3Qgc2VuZENvbXB1dGVyQXR0YWNrID0gKCkgPT4ge1xuICAgIGlmICghY29tcHV0ZXJQbGF5ZXIgfHwgIUdhbWVMb29wLmlzSW5Qcm9ncmVzcygpKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGNvbnN0IGF0dGFja0Nvb3JkaW5hdGVzID0gZ2VuZXJhdGVBdHRhY2tDb29yZGluYXRlcygpO1xuICAgIHNlbmRBdHRhY2soYXR0YWNrQ29vcmRpbmF0ZXMpO1xuICB9O1xuICBjb25zdCByZWNlaXZlQXR0YWNrID0gKGNvb3JkaW5hdGVzKSA9PiB7XG4gICAgY29uc3QgYXR0YWNrUmVzdWx0cyA9IHBsYXllckdhbWVib2FyZC5yZWNlaXZlQXR0YWNrKGNvb3JkaW5hdGVzKTtcbiAgICByZXR1cm4gYXR0YWNrUmVzdWx0cztcbiAgfTtcbiAgY29uc3QgZ2VuZXJhdGVDb21wdXRlclNoaXBDb29yZGluYXRlcyA9IChzaGlwTGVuZ3RoKSA9PiB7XG4gICAgbGV0IGxpc3RPZkNvb3JkaW5hdGVzID0gW107XG4gICAgZG8ge1xuICAgICAgbGlzdE9mQ29vcmRpbmF0ZXMgPSBbXTtcbiAgICAgIGNvbnN0IHN0YXJ0aW5nQ29vcmRpbmF0ZXMgPSBnZW5lcmF0ZVN0YXJ0aW5nQ29vcmRpbmF0ZXMoKTtcbiAgICAgIGNvbnN0IG5vblN0YXJ0aW5nQ29vcmRpbmF0ZXMgPSBnZW5lcmF0ZU5vblN0YXJ0aW5nQ29vcmRpbmF0ZXMoXG4gICAgICAgIHN0YXJ0aW5nQ29vcmRpbmF0ZXMsXG4gICAgICAgIHNoaXBMZW5ndGhcbiAgICAgICk7XG4gICAgICBsaXN0T2ZDb29yZGluYXRlcy5wdXNoKHN0YXJ0aW5nQ29vcmRpbmF0ZXMpO1xuICAgICAgbGlzdE9mQ29vcmRpbmF0ZXMgPSBsaXN0T2ZDb29yZGluYXRlcy5jb25jYXQobm9uU3RhcnRpbmdDb29yZGluYXRlcyk7XG4gICAgfSB3aGlsZSAobGlzdE9mQ29vcmRpbmF0ZXMubGVuZ3RoIDwgc2hpcExlbmd0aCk7XG4gICAgcmV0dXJuIGxpc3RPZkNvb3JkaW5hdGVzO1xuICB9O1xuICBjb25zdCBnZW5lcmF0ZVN0YXJ0aW5nQ29vcmRpbmF0ZXMgPSAoKSA9PiB7XG4gICAgY29uc3Qgc3RhcnRpbmdDb29yZGluYXRlcyA9IFt1bmRlZmluZWQsIHVuZGVmaW5lZF07XG4gICAgZG8ge1xuICAgICAgc3RhcnRpbmdDb29yZGluYXRlc1swXSA9IGdlbmVyYXRlUmFuZG9tQ29vcmRpbmF0ZSgpO1xuICAgICAgc3RhcnRpbmdDb29yZGluYXRlc1sxXSA9IGdlbmVyYXRlUmFuZG9tQ29vcmRpbmF0ZSgpO1xuICAgIH0gd2hpbGUgKHBsYXllckdhbWVib2FyZC5nZXRDb29yZGluYXRlcyhzdGFydGluZ0Nvb3JkaW5hdGVzKSAhPT0gdW5kZWZpbmVkKTtcbiAgICByZXR1cm4gc3RhcnRpbmdDb29yZGluYXRlcztcbiAgfTtcbiAgY29uc3QgZ2VuZXJhdGVOb25TdGFydGluZ0Nvb3JkaW5hdGVzID0gKHN0YXJ0aW5nQ29vcmRpbmF0ZXMsIHNoaXBMZW5ndGgpID0+IHtcbiAgICBjb25zdCBwb3NzaWJsZUNvb3JkaW5hdGVzID0gW107XG4gICAgaWYgKGNoZWNrSWZWYWxpZEVtcHR5Q29vcmRpbmF0ZXMoc3RhcnRpbmdDb29yZGluYXRlcywgc2hpcExlbmd0aCwgXCJ1cFwiKSkge1xuICAgICAgY29uc3QgdXBDb29yZGluYXRlcyA9IFtdO1xuICAgICAgZm9yIChsZXQgaSA9IDE7IGkgPCBzaGlwTGVuZ3RoOyBpKyspIHtcbiAgICAgICAgdXBDb29yZGluYXRlcy5wdXNoKFtcbiAgICAgICAgICBzdGFydGluZ0Nvb3JkaW5hdGVzWzBdIC0gaSxcbiAgICAgICAgICBzdGFydGluZ0Nvb3JkaW5hdGVzWzFdLFxuICAgICAgICBdKTtcbiAgICAgIH1cbiAgICAgIHBvc3NpYmxlQ29vcmRpbmF0ZXMucHVzaCh1cENvb3JkaW5hdGVzKTtcbiAgICB9XG4gICAgaWYgKFxuICAgICAgY2hlY2tJZlZhbGlkRW1wdHlDb29yZGluYXRlcyhzdGFydGluZ0Nvb3JkaW5hdGVzLCBzaGlwTGVuZ3RoLCBcInJpZ2h0XCIpXG4gICAgKSB7XG4gICAgICBjb25zdCByaWdodENvb3JkaW5hdGVzID0gW107XG4gICAgICBmb3IgKGxldCBpID0gMTsgaSA8IHNoaXBMZW5ndGg7IGkrKykge1xuICAgICAgICByaWdodENvb3JkaW5hdGVzLnB1c2goW1xuICAgICAgICAgIHN0YXJ0aW5nQ29vcmRpbmF0ZXNbMF0sXG4gICAgICAgICAgc3RhcnRpbmdDb29yZGluYXRlc1sxXSArIGksXG4gICAgICAgIF0pO1xuICAgICAgfVxuICAgICAgcG9zc2libGVDb29yZGluYXRlcy5wdXNoKHJpZ2h0Q29vcmRpbmF0ZXMpO1xuICAgIH1cbiAgICBpZiAoY2hlY2tJZlZhbGlkRW1wdHlDb29yZGluYXRlcyhzdGFydGluZ0Nvb3JkaW5hdGVzLCBzaGlwTGVuZ3RoLCBcImRvd25cIikpIHtcbiAgICAgIGNvbnN0IGRvd25Db29yZGluYXRlcyA9IFtdO1xuICAgICAgZm9yIChsZXQgaSA9IDE7IGkgPCBzaGlwTGVuZ3RoOyBpKyspIHtcbiAgICAgICAgZG93bkNvb3JkaW5hdGVzLnB1c2goW1xuICAgICAgICAgIHN0YXJ0aW5nQ29vcmRpbmF0ZXNbMF0gKyBpLFxuICAgICAgICAgIHN0YXJ0aW5nQ29vcmRpbmF0ZXNbMV0sXG4gICAgICAgIF0pO1xuICAgICAgfVxuICAgICAgcG9zc2libGVDb29yZGluYXRlcy5wdXNoKGRvd25Db29yZGluYXRlcyk7XG4gICAgfVxuICAgIGlmIChjaGVja0lmVmFsaWRFbXB0eUNvb3JkaW5hdGVzKHN0YXJ0aW5nQ29vcmRpbmF0ZXMsIHNoaXBMZW5ndGgsIFwibGVmdFwiKSkge1xuICAgICAgY29uc3QgbGVmdENvb3JkaW5hdGVzID0gW107XG4gICAgICBmb3IgKGxldCBpID0gMTsgaSA8IHNoaXBMZW5ndGg7IGkrKykge1xuICAgICAgICBsZWZ0Q29vcmRpbmF0ZXMucHVzaChbXG4gICAgICAgICAgc3RhcnRpbmdDb29yZGluYXRlc1swXSxcbiAgICAgICAgICBzdGFydGluZ0Nvb3JkaW5hdGVzWzFdIC0gaSxcbiAgICAgICAgXSk7XG4gICAgICB9XG4gICAgICBwb3NzaWJsZUNvb3JkaW5hdGVzLnB1c2gobGVmdENvb3JkaW5hdGVzKTtcbiAgICB9XG4gICAgaWYgKHBvc3NpYmxlQ29vcmRpbmF0ZXMubGVuZ3RoID09PSAwKSB7XG4gICAgICByZXR1cm4gcG9zc2libGVDb29yZGluYXRlcztcbiAgICB9XG4gICAgY29uc3QgcmFuZG9tSW5kZXggPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiBwb3NzaWJsZUNvb3JkaW5hdGVzLmxlbmd0aCk7XG4gICAgcmV0dXJuIHBvc3NpYmxlQ29vcmRpbmF0ZXNbcmFuZG9tSW5kZXhdO1xuICB9O1xuICBjb25zdCBnZW5lcmF0ZVJhbmRvbUNvb3JkaW5hdGUgPSAoKSA9PiB7XG4gICAgY29uc3QgQk9BUkRBWEVTTEVOR1RIID0gMTA7XG4gICAgcmV0dXJuIE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIEJPQVJEQVhFU0xFTkdUSCk7XG4gIH07XG4gIGNvbnN0IGNoZWNrSWZQcmV2aW91c2x5QXR0YWNrZWQgPSAoYXR0YWNrQ29vcmRpbmF0ZXMpID0+IHtcbiAgICBsZXQgcHJldmlvdXNseUF0dGFja2VkID0gZmFsc2U7XG4gICAgY29uc3QgcmVjZWl2ZWRNaXNzZWRTaG90cyA9IG9wcG9zaW5nUGxheWVyXG4gICAgICAuZ2V0R2FtZWJvYXJkKClcbiAgICAgIC5nZXRSZWNlaXZlZE1pc3NlZFNob3RzKCk7XG4gICAgY29uc3QgcmVjZWl2ZWRIaXRTaG90cyA9IG9wcG9zaW5nUGxheWVyXG4gICAgICAuZ2V0R2FtZWJvYXJkKClcbiAgICAgIC5nZXRSZWNlaXZlZEhpdFNob3RzKCk7XG4gICAgcHJldmlvdXNseUF0dGFja2VkID0gcmVjZWl2ZWRNaXNzZWRTaG90cy5zb21lKFxuICAgICAgKHNob3QpID0+XG4gICAgICAgIHNob3RbMF0gPT09IGF0dGFja0Nvb3JkaW5hdGVzWzBdICYmIHNob3RbMV0gPT09IGF0dGFja0Nvb3JkaW5hdGVzWzFdXG4gICAgKTtcbiAgICBpZiAoIXByZXZpb3VzbHlBdHRhY2tlZCkge1xuICAgICAgcHJldmlvdXNseUF0dGFja2VkID0gcmVjZWl2ZWRIaXRTaG90cy5zb21lKFxuICAgICAgICAoc2hvdCkgPT5cbiAgICAgICAgICBzaG90WzBdID09PSBhdHRhY2tDb29yZGluYXRlc1swXSAmJiBzaG90WzFdID09PSBhdHRhY2tDb29yZGluYXRlc1sxXVxuICAgICAgKTtcbiAgICB9XG4gICAgcmV0dXJuIHByZXZpb3VzbHlBdHRhY2tlZDtcbiAgfTtcbiAgY29uc3QgZ2VuZXJhdGVBdHRhY2tDb29yZGluYXRlcyA9ICgpID0+IHtcbiAgICBjb25zdCBhdHRhY2tDb29yZGluYXRlcyA9IFt1bmRlZmluZWQsIHVuZGVmaW5lZF07XG4gICAgZG8ge1xuICAgICAgYXR0YWNrQ29vcmRpbmF0ZXNbMF0gPSBnZW5lcmF0ZVJhbmRvbUNvb3JkaW5hdGUoKTtcbiAgICAgIGF0dGFja0Nvb3JkaW5hdGVzWzFdID0gZ2VuZXJhdGVSYW5kb21Db29yZGluYXRlKCk7XG4gICAgfSB3aGlsZSAoY2hlY2tJZlByZXZpb3VzbHlBdHRhY2tlZChhdHRhY2tDb29yZGluYXRlcykpO1xuICAgIHJldHVybiBhdHRhY2tDb29yZGluYXRlcztcbiAgfTtcbiAgY29uc3QgY2hlY2tJZlZhbGlkRW1wdHlDb29yZGluYXRlcyA9IChcbiAgICBzdGFydGluZ0Nvb3JkaW5hdGVzLFxuICAgIHNoaXBMZW5ndGgsXG4gICAgZGlyZWN0aW9uXG4gICkgPT4ge1xuICAgIHN3aXRjaCAoZGlyZWN0aW9uKSB7XG4gICAgICBjYXNlIFwidXBcIjpcbiAgICAgICAgaWYgKHN0YXJ0aW5nQ29vcmRpbmF0ZXNbMF0gLSAoc2hpcExlbmd0aCAtIDEpIDwgMCkge1xuICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgICBmb3IgKGxldCBpID0gMTsgaSA8IHNoaXBMZW5ndGg7IGkrKykge1xuICAgICAgICAgIGlmIChcbiAgICAgICAgICAgIHBsYXllckdhbWVib2FyZC5nZXRDb29yZGluYXRlcyhbXG4gICAgICAgICAgICAgIHN0YXJ0aW5nQ29vcmRpbmF0ZXNbMF0gLSBpLFxuICAgICAgICAgICAgICBzdGFydGluZ0Nvb3JkaW5hdGVzWzFdLFxuICAgICAgICAgICAgXSkgIT09IHVuZGVmaW5lZFxuICAgICAgICAgICkge1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdHJ1ZTtcblxuICAgICAgY2FzZSBcInJpZ2h0XCI6XG4gICAgICAgIGlmIChzdGFydGluZ0Nvb3JkaW5hdGVzWzFdICsgKHNoaXBMZW5ndGggLSAxKSA+IDkpIHtcbiAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgZm9yIChsZXQgaSA9IDE7IGkgPCBzaGlwTGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICBpZiAoXG4gICAgICAgICAgICBwbGF5ZXJHYW1lYm9hcmQuZ2V0Q29vcmRpbmF0ZXMoW1xuICAgICAgICAgICAgICBzdGFydGluZ0Nvb3JkaW5hdGVzWzBdLFxuICAgICAgICAgICAgICBzdGFydGluZ0Nvb3JkaW5hdGVzWzFdICsgaSxcbiAgICAgICAgICAgIF0pICE9PSB1bmRlZmluZWRcbiAgICAgICAgICApIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRydWU7XG5cbiAgICAgIGNhc2UgXCJkb3duXCI6XG4gICAgICAgIGlmIChzdGFydGluZ0Nvb3JkaW5hdGVzWzBdICsgKHNoaXBMZW5ndGggLSAxKSA+IDkpIHtcbiAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgZm9yIChsZXQgaSA9IDE7IGkgPCBzaGlwTGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICBpZiAoXG4gICAgICAgICAgICBwbGF5ZXJHYW1lYm9hcmQuZ2V0Q29vcmRpbmF0ZXMoW1xuICAgICAgICAgICAgICBzdGFydGluZ0Nvb3JkaW5hdGVzWzBdICsgaSxcbiAgICAgICAgICAgICAgc3RhcnRpbmdDb29yZGluYXRlc1sxXSxcbiAgICAgICAgICAgIF0pICE9PSB1bmRlZmluZWRcbiAgICAgICAgICApIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRydWU7XG5cbiAgICAgIGNhc2UgXCJsZWZ0XCI6XG4gICAgICAgIGlmIChzdGFydGluZ0Nvb3JkaW5hdGVzWzFdIC0gKHNoaXBMZW5ndGggLSAxKSA8IDApIHtcbiAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgZm9yIChsZXQgaSA9IDE7IGkgPCBzaGlwTGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICBpZiAoXG4gICAgICAgICAgICBwbGF5ZXJHYW1lYm9hcmQuZ2V0Q29vcmRpbmF0ZXMoW1xuICAgICAgICAgICAgICBzdGFydGluZ0Nvb3JkaW5hdGVzWzBdLFxuICAgICAgICAgICAgICBzdGFydGluZ0Nvb3JkaW5hdGVzWzFdIC0gaSxcbiAgICAgICAgICAgIF0pICE9PSB1bmRlZmluZWRcbiAgICAgICAgICApIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRydWU7XG5cbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIGJyZWFrO1xuICAgIH1cbiAgfTtcbiAgcmV0dXJuIHtcbiAgICBpc0NvbXB1dGVyLFxuICAgIGdldEdhbWVib2FyZCxcbiAgICBnZXRPcHBvc2luZ1BsYXllcixcbiAgICBzZXRPcHBvc2luZ1BsYXllcixcbiAgICBhZGRTaGlwVG9HYW1lYm9hcmQsXG4gICAgc2VuZEF0dGFjayxcbiAgICBpbml0aWFsaXplQ29tcHV0ZXJHYW1lYm9hcmQsXG4gICAgc2VuZENvbXB1dGVyQXR0YWNrLFxuICAgIHJlY2VpdmVBdHRhY2ssXG4gICAgY2hlY2tJZlZhbGlkRW1wdHlDb29yZGluYXRlcyxcbiAgfTtcbn07XG5cbmV4cG9ydCB7IFBsYXllciB9O1xuIiwiY29uc3QgR2FtZWJvYXJkID0gKCkgPT4ge1xuICBjb25zdCBjcmVhdGVCb2FyZCA9ICgpID0+IHtcbiAgICBjb25zdCBib2FyZCA9IFtdO1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgMTA7IGkrKykge1xuICAgICAgYm9hcmQucHVzaChbXSk7XG4gICAgICBmb3IgKGxldCBqID0gMDsgaiA8IDEwOyBqKyspIHtcbiAgICAgICAgYm9hcmRbaV0ucHVzaCh1bmRlZmluZWQpO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gYm9hcmQ7XG4gIH07XG4gIGNvbnN0IGJvYXJkID0gY3JlYXRlQm9hcmQoKTtcbiAgY29uc3QgcGxhY2VkU2hpcHMgPSBbXTtcbiAgY29uc3QgcmVjZWl2ZWRNaXNzZWRTaG90cyA9IFtdO1xuICBjb25zdCByZWNlaXZlZEhpdFNob3RzID0gW107XG4gIGNvbnN0IHNlbnRNaXNzZWRTaG90cyA9IFtdO1xuICBjb25zdCBzZW50SGl0U2hvdHMgPSBbXTtcbiAgbGV0IGFsbFNoaXBzU3VuayA9IGZhbHNlO1xuICBjb25zdCBnZXRDb29yZGluYXRlcyA9IChjb29yZGluYXRlcykgPT4gYm9hcmRbY29vcmRpbmF0ZXNbMF1dW2Nvb3JkaW5hdGVzWzFdXTtcbiAgY29uc3QgZ2V0UGxhY2VkU2hpcHMgPSAoKSA9PiBwbGFjZWRTaGlwcztcbiAgY29uc3QgZ2V0UmVjZWl2ZWRNaXNzZWRTaG90cyA9ICgpID0+IHJlY2VpdmVkTWlzc2VkU2hvdHM7XG4gIGNvbnN0IGdldFJlY2VpdmVkSGl0U2hvdHMgPSAoKSA9PiByZWNlaXZlZEhpdFNob3RzO1xuICBjb25zdCBnZXRTZW50TWlzc2VkU2hvdHMgPSAoKSA9PiBzZW50TWlzc2VkU2hvdHM7XG4gIGNvbnN0IGdldFNlbnRIaXRTaG90cyA9ICgpID0+IHNlbnRIaXRTaG90cztcbiAgY29uc3QgaXNBbGxTaGlwc1N1bmsgPSAoKSA9PiBhbGxTaGlwc1N1bms7XG4gIGNvbnN0IHBsYWNlU2hpcCA9IChzaGlwLCBjb29yZGluYXRlc0xpc3QpID0+IHtcbiAgICBmb3IgKGNvbnN0IGNvb3JkaW5hdGVzIG9mIGNvb3JkaW5hdGVzTGlzdCkge1xuICAgICAgYm9hcmRbY29vcmRpbmF0ZXNbMF1dW2Nvb3JkaW5hdGVzWzFdXSA9IHNoaXA7XG4gICAgfVxuICAgIHBsYWNlZFNoaXBzLnB1c2goc2hpcCk7XG4gIH07XG4gIGNvbnN0IGNoZWNrQWxsU2hpcHNTdW5rID0gKCkgPT4ge1xuICAgIGlmIChwbGFjZWRTaGlwcy5ldmVyeSgoc2hpcCkgPT4gc2hpcC5pc1N1bmsoKSkpIHtcbiAgICAgIGFsbFNoaXBzU3VuayA9IHRydWU7XG4gICAgfVxuICB9O1xuICBjb25zdCByZWNlaXZlQXR0YWNrID0gKGNvb3JkaW5hdGVzKSA9PiB7XG4gICAgY29uc3QgZW50aXR5QXRDb29yZGluYXRlcyA9IGdldENvb3JkaW5hdGVzKGNvb3JkaW5hdGVzKTtcbiAgICBpZiAoZW50aXR5QXRDb29yZGluYXRlcyAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICBlbnRpdHlBdENvb3JkaW5hdGVzLmhpdCgpO1xuICAgICAgY2hlY2tBbGxTaGlwc1N1bmsoKTtcbiAgICAgIHJlY2VpdmVkSGl0U2hvdHMucHVzaChjb29yZGluYXRlcyk7XG4gICAgICByZXR1cm4gXCJoaXRcIjtcbiAgICB9XG4gICAgcmVjZWl2ZWRNaXNzZWRTaG90cy5wdXNoKGNvb3JkaW5hdGVzKTtcbiAgICByZXR1cm4gXCJtaXNzXCI7XG4gIH07XG4gIGNvbnN0IGFkZFNlbnRNaXNzZWRTaG90ID0gKGNvb3JkaW5hdGVzKSA9PiB7XG4gICAgc2VudE1pc3NlZFNob3RzLnB1c2goY29vcmRpbmF0ZXMpO1xuICB9O1xuICBjb25zdCBhZGRTZW50SGl0U2hvdCA9IChjb29yZGluYXRlcykgPT4ge1xuICAgIHNlbnRIaXRTaG90cy5wdXNoKGNvb3JkaW5hdGVzKTtcbiAgfTtcbiAgcmV0dXJuIHtcbiAgICBnZXRDb29yZGluYXRlcyxcbiAgICBnZXRQbGFjZWRTaGlwcyxcbiAgICBnZXRSZWNlaXZlZE1pc3NlZFNob3RzLFxuICAgIGdldFJlY2VpdmVkSGl0U2hvdHMsXG4gICAgZ2V0U2VudE1pc3NlZFNob3RzLFxuICAgIGdldFNlbnRIaXRTaG90cyxcbiAgICBpc0FsbFNoaXBzU3VuayxcbiAgICBwbGFjZVNoaXAsXG4gICAgcmVjZWl2ZUF0dGFjayxcbiAgICBhZGRTZW50TWlzc2VkU2hvdCxcbiAgICBhZGRTZW50SGl0U2hvdCxcbiAgfTtcbn07XG5cbmV4cG9ydCB7IEdhbWVib2FyZCB9O1xuIiwiaW1wb3J0IHsgU2hpcCB9IGZyb20gXCIuL3NoaXBcIjtcbmltcG9ydCB7IEdhbWVib2FyZCB9IGZyb20gXCIuL2dhbWVib2FyZFwiO1xuaW1wb3J0IHsgUGxheWVyIH0gZnJvbSBcIi4vcGxheWVyXCI7XG5pbXBvcnQgeyBET01Db250cm9sbGVyIH0gZnJvbSBcIi4vRE9NX2NvbnRyb2xsZXJcIjtcblxuY29uc3QgR2FtZUxvb3AgPSAoKCkgPT4ge1xuICBjb25zdCBwbGF5ZXJzID0gW107XG4gIGxldCBpblByb2dyZXNzID0gdHJ1ZTtcbiAgbGV0IHdpbm5lcjtcbiAgbGV0IG1pZEF0dGFjayA9IGZhbHNlO1xuICBjb25zdCBnZXRQbGF5ZXJzID0gKCkgPT4gcGxheWVycztcbiAgY29uc3QgaXNJblByb2dyZXNzID0gKCkgPT4gaW5Qcm9ncmVzcztcbiAgY29uc3QgZ2V0V2lubmVyID0gKCkgPT4gd2lubmVyO1xuICBjb25zdCBzZXRXaW5uZXIgPSAobG9zZXJQbGF5ZXIpID0+IHtcbiAgICBjb25zdCB3aW5uZXJQbGF5ZXIgPSBsb3NlclBsYXllci5nZXRPcHBvc2luZ1BsYXllcigpO1xuICAgIHdpbm5lciA9IHdpbm5lclBsYXllcjtcbiAgfTtcbiAgY29uc3QgaXNNaWRBdHRhY2sgPSAoKSA9PiBtaWRBdHRhY2s7XG4gIGNvbnN0IHRvZ2dsZU1pZEF0dGFjayA9IChzdGF0ZSkgPT4ge1xuICAgIHN0YXRlID8gKG1pZEF0dGFjayA9IHRydWUpIDogKG1pZEF0dGFjayA9IGZhbHNlKTtcbiAgfTtcbiAgY29uc3QgY3JlYXRlR2FtZSA9ICgpID0+IHtcbiAgICBjb25zdCBodW1hblBsYXllciA9IFBsYXllcihcImh1bWFuXCIpO1xuICAgIHBsYXllcnMucHVzaChodW1hblBsYXllcik7XG4gICAgY29uc3QgY29tcHV0ZXJQbGF5ZXIgPSBQbGF5ZXIoXCJjb21wdXRlclwiKTtcbiAgICBwbGF5ZXJzLnB1c2goY29tcHV0ZXJQbGF5ZXIpO1xuICAgIGh1bWFuUGxheWVyLnNldE9wcG9zaW5nUGxheWVyKGNvbXB1dGVyUGxheWVyKTtcbiAgICBjb21wdXRlclBsYXllci5zZXRPcHBvc2luZ1BsYXllcihodW1hblBsYXllcik7XG4gICAgY29tcHV0ZXJQbGF5ZXIuaW5pdGlhbGl6ZUNvbXB1dGVyR2FtZWJvYXJkKCk7XG4gIH07XG4gIGNvbnN0IGVuZEdhbWUgPSAobG9zZXJQbGF5ZXIpID0+IHtcbiAgICBpblByb2dyZXNzID0gZmFsc2U7XG4gICAgc2V0V2lubmVyKGxvc2VyUGxheWVyKTtcbiAgICBET01Db250cm9sbGVyLnRvZ2dsZUFiaWxpdHlUb0F0dGFjayhcImRpc2FibGVcIik7XG4gIH07XG4gIGNvbnN0IHJlc2V0R2FtZSA9ICgpID0+IHtcbiAgICBwbGF5ZXJzLmxlbmd0aCA9IDA7XG4gICAgaW5Qcm9ncmVzcyA9IHRydWU7XG4gICAgd2lubmVyID0gdW5kZWZpbmVkO1xuICB9O1xuICByZXR1cm4ge1xuICAgIGdldFBsYXllcnMsXG4gICAgaXNJblByb2dyZXNzLFxuICAgIGdldFdpbm5lcixcbiAgICBpc01pZEF0dGFjayxcbiAgICB0b2dnbGVNaWRBdHRhY2ssXG4gICAgY3JlYXRlR2FtZSxcbiAgICBlbmRHYW1lLFxuICAgIHJlc2V0R2FtZSxcbiAgfTtcbn0pKCk7XG5cbmV4cG9ydCB7IEdhbWVMb29wIH07XG4iLCJpbXBvcnQgeyBET01Db250cm9sbGVyIH0gZnJvbSBcIi4vRE9NX2NvbnRyb2xsZXJcIjtcblxuY29uc3QgRXZlbnRMaXN0ZW5lckNvbnRyb2xsZXIgPSAoKCkgPT4ge1xuICBjb25zdCByb3RhdGVTaGlwSW1hZ2VMaXN0ZW5lcnMgPSAoKSA9PiB7XG4gICAgY29uc3Qgc2hpcFBsYWNlbWVudEVsZW1lbnRzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChcIi5zaGlwLXBsYWNlbWVudFwiKTtcbiAgICBzaGlwUGxhY2VtZW50RWxlbWVudHMuZm9yRWFjaCgoZ3JvdXBPZkVsZW1lbnRzKSA9PiB7XG4gICAgICBjb25zdCBpbWFnZSA9IGdyb3VwT2ZFbGVtZW50cy5xdWVyeVNlbGVjdG9yKFwiaW1nXCIpO1xuICAgICAgY29uc3QgYnV0dG9uID0gZ3JvdXBPZkVsZW1lbnRzLnF1ZXJ5U2VsZWN0b3IoXCJidXR0b25cIik7XG4gICAgICBjb25zb2xlLmxvZyhpbWFnZSwgYnV0dG9uKTtcbiAgICAgIGJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xuICAgICAgICBET01Db250cm9sbGVyLnJvdGF0ZVNoaXBJbWFnZShpbWFnZSk7XG4gICAgICB9KTtcbiAgICB9KTtcbiAgfTtcbiAgY29uc3QgYWRkU2hpcFBsYWNlbWVudERyYWcgPSAoKSA9PiB7XG4gICAgY29uc3Qgc2hpcEltYWdlcyA9IEFycmF5LmZyb20oZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChcIi5zaGlwLXBpZWNlXCIpKTtcbiAgICBzaGlwSW1hZ2VzLmZvckVhY2goKHNoaXApID0+IHtcbiAgICAgIHNoaXAuYWRkRXZlbnRMaXN0ZW5lcihcImRyYWdzdGFydFwiLCAoZXZlbnQpID0+IHtcbiAgICAgICAgRE9NQ29udHJvbGxlci5nZXREcmFnZ2VkSW1hZ2UoZXZlbnQpO1xuICAgICAgICBET01Db250cm9sbGVyLnJvdGF0ZURyYWdnZWRJbWFnZShldmVudCk7XG4gICAgICB9KTtcbiAgICB9KTtcbiAgfTtcbiAgcmV0dXJuIHtcbiAgICByb3RhdGVTaGlwSW1hZ2VMaXN0ZW5lcnMsXG4gICAgYWRkU2hpcFBsYWNlbWVudERyYWcsXG4gIH07XG59KSgpO1xuXG5leHBvcnQgeyBFdmVudExpc3RlbmVyQ29udHJvbGxlciB9O1xuIiwiaW1wb3J0IHsgR2FtZUxvb3AgfSBmcm9tIFwiLi9nYW1lbG9vcFwiO1xuaW1wb3J0IHsgRE9NQ29udHJvbGxlciB9IGZyb20gXCIuL0RPTV9jb250cm9sbGVyXCI7XG5pbXBvcnQgeyBFdmVudExpc3RlbmVyQ29udHJvbGxlciB9IGZyb20gXCIuL2V2ZW50X2xpc3RlbmVyX2NvbnRyb2xsZXJcIjtcblxuR2FtZUxvb3AuY3JlYXRlR2FtZSgpO1xuXG5ET01Db250cm9sbGVyLmluaXRpYWxpemVCb2FyZERPTSgpO1xuXG5FdmVudExpc3RlbmVyQ29udHJvbGxlci5yb3RhdGVTaGlwSW1hZ2VMaXN0ZW5lcnMoKTtcblxuRXZlbnRMaXN0ZW5lckNvbnRyb2xsZXIuYWRkU2hpcFBsYWNlbWVudERyYWcoKTtcbiJdLCJuYW1lcyI6WyJET01Db250cm9sbGVyIiwiY3JlYXRlQm9hcmRDZWxscyIsImdhbWVib2FyZERPTSIsImNvbHVtbkxhYmVscyIsInJvd0xhYmVscyIsImkiLCJqIiwiaW52aXNpYmxlUGxhY2Vob2xkZXJFbGVtZW50IiwiZG9jdW1lbnQiLCJjcmVhdGVFbGVtZW50IiwiY2xhc3NMaXN0IiwiYWRkIiwic3R5bGUiLCJ2aXNpYmlsaXR5IiwiYXBwZW5kQ2hpbGQiLCJjb2x1bW5MYWJlbEVsZW1lbnQiLCJ0ZXh0Q29udGVudCIsInJvd0xhYmVsRWxlbWVudCIsIkFycmF5IiwiZnJvbSIsImluY2x1ZGVzIiwiY2VsbEVsZW1lbnQiLCJzZXRBdHRyaWJ1dGUiLCJhZGRFdmVudExpc3RlbmVyIiwiZXZlbnQiLCJkcmFnT3ZlciIsImluc2VydERyYWdnZWRJbWFnZSIsIkdhbWVMb29wIiwiZ2V0UGxheWVycyIsImdldEdhbWVib2FyZCIsImdldFBsYWNlZFNoaXBzIiwibGVuZ3RoIiwidG9nZ2xlQWJpbGl0eVRvQXR0YWNrIiwiZGlzYWJsZWQiLCJpc01pZEF0dGFjayIsImNvbnNvbGUiLCJsb2ciLCJjZWxsUm93IiwiTnVtYmVyIiwiZGF0YXNldCIsInJvdyIsImNlbGxDb2x1bW4iLCJjb2x1bW4iLCJzZW5kQXR0YWNrIiwiYWN0aW9uIiwiY29tcHV0ZXJHYW1lYm9hcmRFbGVtZW50IiwicXVlcnlTZWxlY3RvciIsImNlbGxFbGVtZW50cyIsInF1ZXJ5U2VsZWN0b3JBbGwiLCJmb3JFYWNoIiwicHJldmVudERlZmF1bHQiLCJ0YXJnZXRDZWxsIiwidGFyZ2V0IiwiZGF0YVN0cmluZyIsImRhdGFUcmFuc2ZlciIsImdldERhdGEiLCJkYXRhT2JqZWN0IiwiSlNPTiIsInBhcnNlIiwiY2VsbENvb3JkaW5hdGVzIiwic2hpcExlbmd0aCIsImhvcml6b250YWwiLCJjaGVja0lmVmFsaWRFbXB0eUNvb3JkaW5hdGVzIiwidmVydGljYWwiLCJpc1ZhbGlkR2FtZWJvYXJkQ2VsbCIsInNoaXBDb29yZGluYXRlcyIsInRhcmdldENlbGxSb3ciLCJ0YXJnZXRDZWxsQ29sdW1uIiwiY29vcmRpbmF0ZXNBcnJheSIsInJlbWFpbmluZ0NlbGwiLCJwdXNoIiwiYWRkU2hpcFRvRE9NIiwiYWRkU2hpcFRvR2FtZWJvYXJkIiwiSUQiLCJlbGVtZW50SUQiLCJpbWFnZUVsZW1lbnQiLCJidXR0b25FbGVtZW50IiwicGFyZW50Tm9kZSIsImRpc2FibGVJbWFnZUJ1dHRvbkludGVyYWN0aW9ucyIsInJlbW92ZUV2ZW50TGlzdGVuZXIiLCJpbml0aWFsaXplQm9hcmRET00iLCJodW1hblBsYXllckdhbWVib2FyZERPTSIsIm9wcG9uZW50R2FtZWJvYXJkRE9NIiwicm90YXRlU2hpcEltYWdlIiwiaW1hZ2UiLCJpbWFnZUNsYXNzZXMiLCJyZW1vdmUiLCJyb3RhdGVEcmFnZ2VkSW1hZ2UiLCJjbG9uZWRJbWFnZUVsZW1lbnQiLCJjbG9uZU5vZGUiLCJ0ZW1wRGl2IiwiY2xvbmVkSW1hZ2VFbGVtZW50Q2xhc3NlcyIsInJvdGF0ZVBlckxlbmd0aCIsImJvZHkiLCJzZXREcmFnSW1hZ2UiLCJzZXRUaW1lb3V0IiwicmVtb3ZlQ2hpbGQiLCJnZXREcmFnZ2VkSW1hZ2UiLCJzcmMiLCJnZXRBdHRyaWJ1dGUiLCJzdHJpbmdpZnkiLCJzZXREYXRhIiwiYWRkQXR0YWNrUmVzdWx0RE9NIiwicGxheWVyVHlwZSIsImF0dGFja1Jlc3VsdHMiLCJjb29yZGluYXRlcyIsImF0dGFja1Jlc3VsdHNFbGVtZW50IiwiUGxheWVyIiwiY29tcHV0ZXJQbGF5ZXIiLCJwbGF5ZXJHYW1lYm9hcmQiLCJib2FyZCIsInVuZGVmaW5lZCIsImNyZWF0ZUJvYXJkIiwicGxhY2VkU2hpcHMiLCJyZWNlaXZlZE1pc3NlZFNob3RzIiwicmVjZWl2ZWRIaXRTaG90cyIsInNlbnRNaXNzZWRTaG90cyIsInNlbnRIaXRTaG90cyIsImFsbFNoaXBzU3VuayIsImdldENvb3JkaW5hdGVzIiwiZ2V0UmVjZWl2ZWRNaXNzZWRTaG90cyIsImdldFJlY2VpdmVkSGl0U2hvdHMiLCJnZXRTZW50TWlzc2VkU2hvdHMiLCJnZXRTZW50SGl0U2hvdHMiLCJpc0FsbFNoaXBzU3VuayIsInBsYWNlU2hpcCIsInNoaXAiLCJjb29yZGluYXRlc0xpc3QiLCJyZWNlaXZlQXR0YWNrIiwiZW50aXR5QXRDb29yZGluYXRlcyIsImhpdCIsImV2ZXJ5IiwiaXNTdW5rIiwiYWRkU2VudE1pc3NlZFNob3QiLCJhZGRTZW50SGl0U2hvdCIsIkdhbWVib2FyZCIsIm9wcG9zaW5nUGxheWVyIiwiaXNDb21wdXRlciIsImdpdmVuTGVuZ3RoIiwiaGl0cyIsInN1bmsiLCJnZXRTaGlwTGVuZ3RoIiwiZ2V0U2hpcEhpdHMiLCJTaGlwIiwiY2hlY2tJZlByZXZpb3VzbHlBdHRhY2tlZCIsImlzSW5Qcm9ncmVzcyIsIm9wcG9zaW5nUGxheWVyR2FtZWJvYXJkIiwiZW5kR2FtZSIsInRvZ2dsZU1pZEF0dGFjayIsInNlbmRDb21wdXRlckF0dGFjayIsImdlbmVyYXRlQ29tcHV0ZXJTaGlwQ29vcmRpbmF0ZXMiLCJsaXN0T2ZDb29yZGluYXRlcyIsInN0YXJ0aW5nQ29vcmRpbmF0ZXMiLCJnZW5lcmF0ZVN0YXJ0aW5nQ29vcmRpbmF0ZXMiLCJub25TdGFydGluZ0Nvb3JkaW5hdGVzIiwiZ2VuZXJhdGVOb25TdGFydGluZ0Nvb3JkaW5hdGVzIiwiY29uY2F0IiwiZ2VuZXJhdGVSYW5kb21Db29yZGluYXRlIiwicG9zc2libGVDb29yZGluYXRlcyIsInVwQ29vcmRpbmF0ZXMiLCJyaWdodENvb3JkaW5hdGVzIiwiZG93bkNvb3JkaW5hdGVzIiwibGVmdENvb3JkaW5hdGVzIiwiTWF0aCIsImZsb29yIiwicmFuZG9tIiwiYXR0YWNrQ29vcmRpbmF0ZXMiLCJwcmV2aW91c2x5QXR0YWNrZWQiLCJzb21lIiwic2hvdCIsImRpcmVjdGlvbiIsImdldE9wcG9zaW5nUGxheWVyIiwic2V0T3Bwb3NpbmdQbGF5ZXIiLCJwbGF5ZXIiLCJpbml0aWFsaXplQ29tcHV0ZXJHYW1lYm9hcmQiLCJsZW5ndGhzT2ZTaGlwcyIsImdlbmVyYXRlQXR0YWNrQ29vcmRpbmF0ZXMiLCJwbGF5ZXJzIiwid2lubmVyIiwiaW5Qcm9ncmVzcyIsIm1pZEF0dGFjayIsImdldFdpbm5lciIsInN0YXRlIiwiY3JlYXRlR2FtZSIsImh1bWFuUGxheWVyIiwibG9zZXJQbGF5ZXIiLCJ3aW5uZXJQbGF5ZXIiLCJzZXRXaW5uZXIiLCJyZXNldEdhbWUiLCJFdmVudExpc3RlbmVyQ29udHJvbGxlciIsImdyb3VwT2ZFbGVtZW50cyIsImJ1dHRvbiJdLCJzb3VyY2VSb290IjoiIn0=