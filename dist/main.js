(()=>{"use strict";const e=e=>{const a="human"!==e&&("computer"===e||void 0),s=(()=>{const e=(()=>{const e=[];for(let t=0;t<10;t++){e.push([]);for(let a=0;a<10;a++)e[t].push(void 0)}return e})(),t=[],a=[],s=[],r=[],o=[];let i=!1;const n=t=>e[t[0]][t[1]];return{getCoordinates:n,getPlacedShips:()=>t,getReceivedMissedShots:()=>a,getReceivedHitShots:()=>s,getSentMissedShots:()=>r,getSentHitShots:()=>o,isAllShipsSunk:()=>i,placeShip:(a,s)=>{for(const t of s)e[t[0]][t[1]]=a;t.push(a)},receiveAttack:e=>{const r=n(e);return void 0!==r?(r.hit(),t.every((e=>e.isSunk()))&&(i=!0),s.push(e),"hit"):(a.push(e),"miss")},addSentMissedShot:e=>{r.push(e)},addSentHitShot:e=>{o.push(e)}}})();let r;const o=(e,t)=>{const a=(e=>{const t=e;let a=0,s=!1;return{getShipLength:()=>t,getShipHits:()=>a,isSunk:()=>s,hit:()=>{if(s)return"That ship has already been sunk!";a+=1,a===t&&(s=!0)}}})(e);s.placeShip(a,t)},i=e=>{const a=r.getGameboard(),o=r.receiveAttack(e);if("hit"===o){if(s.addSentHitShot(e),a.isAllShipsSunk())return void t.endGame(r)}else"miss"===o&&s.addSentMissedShot(e);r.isComputer()&&r.sendComputerAttack()},n=e=>{let t=[];do{t=[];const a=d(),s=l(a,e);t.push(a),t=t.concat(s)}while(t.length<e);return t},d=()=>{const e=[void 0,void 0];do{e[0]=c(),e[1]=c()}while(void 0!==s.getCoordinates(e));return e},l=(e,t)=>{const a=[];if(h(e,t,"up")){const s=[];for(let a=1;a<t;a++)s.push([e[0]-a,e[1]]);a.push(s)}if(h(e,t,"right")){const s=[];for(let a=1;a<t;a++)s.push([e[0],e[1]+a]);a.push(s)}if(h(e,t,"down")){const s=[];for(let a=1;a<t;a++)s.push([e[0]+a,e[1]]);a.push(s)}if(h(e,t,"left")){const s=[];for(let a=1;a<t;a++)s.push([e[0],e[1]-a]);a.push(s)}return 0===a.length?a:a[Math.floor(Math.random()*a.length)]},c=()=>Math.floor(10*Math.random()),u=(e,t)=>e.some((e=>e[0]===t[0]&&e[1]===t[1])),h=(e,t,a)=>{switch(a){case"up":if(e[0]-(t-1)<0)return!1;for(let a=1;a<t;a++)if(void 0!==s.getCoordinates([e[0]-a,e[1]]))return!1;return!0;case"right":if(e[1]+(t-1)>9)return!1;for(let a=1;a<t;a++)if(void 0!==s.getCoordinates([e[0],e[1]+a]))return!1;return!0;case"down":if(e[0]+(t-1)>9)return!1;for(let a=1;a<t;a++)if(void 0!==s.getCoordinates([e[0]+a,e[1]]))return!1;return!0;case"left":if(e[1]-(t-1)<0)return!1;for(let a=1;a<t;a++)if(void 0!==s.getCoordinates([e[0],e[1]-a]))return!1;return!0}};return{isComputer:()=>a,getGameboard:()=>s,getOpposingPlayer:()=>r,setOpposingPlayer:e=>{r=e},addShipToGameboard:o,sendAttack:i,initializeComputerGameboard:()=>{if(!a)return;const e=[5,4,3,3,2];for(const t of e){const e=n(t);o(t,e)}},sendComputerAttack:()=>{if(!a)return;const e=(()=>{const e=r.getGameboard().getReceivedMissedShots(),t=r.getGameboard().getReceivedHitShots(),a=[void 0,void 0];do{a[0]=c(),a[1]=c()}while(u(e,a)||u(t,a));return a})();i(e)},receiveAttack:e=>s.receiveAttack(e),checkIfValidEmptyCoordinates:h}},t=(()=>{const t=[];let a,s=!0;return{getPlayers:()=>t,isInProgress:()=>s,getWinner:()=>a,createGame:()=>{const a=e("human");t.push(a);const s=e("computer");t.push(s),a.setOpposingPlayer(s),s.setOpposingPlayer(a),s.initializeComputerGameboard()},endGame:e=>{s=!1,(e=>{const t=e.getOpposingPlayer();a=t})(e)},resetGame:()=>{t.length=0,s=!0,a=void 0}}})(),a=(()=>{const e=e=>{const t=["A","B","C","D","E","F","G","H","I","J"],r=["1","2","3","4","5","6","7","8","9","10"];for(let o=-1;o<10;o++)for(let i=-1;i<10;i++)if(-1===o)if(-1===i){const t=document.createElement("div");t.classList.add("gameboard-label"),t.style.visibility="hidden",e.appendChild(t)}else{const a=document.createElement("div");a.classList.add("column-label"),a.textContent=t[i],e.appendChild(a)}else if(-1===i){const t=document.createElement("div");t.classList.add("row-label"),t.textContent=r[o],e.appendChild(t)}else if(Array.from(e.classList).includes("player-board")){const t=document.createElement("div");t.setAttribute("data-row",o),t.setAttribute("data-column",i),t.classList.add("gameboard-cell"),t.addEventListener("dragover",(e=>{a(e)})),t.addEventListener("drop",(e=>{s(e)})),e.appendChild(t)}else if(Array.from(e.classList).includes("opponent-board")){const t=document.createElement("button");t.setAttribute("data-row",o),t.setAttribute("data-column",i),t.classList.add("gameboard-cell"),e.appendChild(t)}},a=()=>{event.preventDefault()},s=e=>{e.preventDefault();const a=e.target;if(Array.from(a.classList).includes("contains-ship-image"))return;const r=e.dataTransfer.getData("image"),o=JSON.parse(r);if(!((e,a)=>{const s=[Number(e.dataset.row),Number(e.dataset.column)],r=Number(a.shipLength);return a.horizontal?t.getPlayers()[0].checkIfValidEmptyCoordinates(s,r,"right")?(console.log("fits"),!0):(console.log("nope"),!1):a.vertical?t.getPlayers()[0].checkIfValidEmptyCoordinates(s,r,"down")?(console.log("fits"),!0):(console.log("nope"),!1):void 0})(a,o))return;const i=((e,t)=>{const a=t.shipLength,s=Number(e.dataset.row),r=Number(e.dataset.column),o=[[s,r]];e.classList.add("contains-ship-image"),e.classList.add("ship-image"),e.classList.add(`ship-image-${a}`),e.classList.add(`ship-image-${a}-1`),t.horizontal?e.classList.add("horizontal"):t.vertical&&e.classList.add("vertical");for(let e=1;e<a;e++){let i;t.horizontal?(i=document.querySelector(`.player-board [data-row='${s}'][data-column='${r+e}']`),i.classList.add("horizontal"),o.push([s,r+e])):t.vertical&&(i=document.querySelector(`.player-board [data-row='${s+e}'][data-column='${r}']`),i.classList.add("vertical"),o.push([s+e,r])),i.classList.add("contains-ship-image"),i.classList.add("ship-image"),i.classList.add(`ship-image-${a}`),i.classList.add(`ship-image-${a}-${e+1}`)}return o})(a,o);t.getPlayers()[0].addShipToGameboard(Number(o.shipLength),i),(e=>{const t=e.elementID,a=document.querySelector(`#${t}`),s=a.parentNode.querySelector("button");a.setAttribute("draggable",!1),a.classList.add("disabled-image"),s.disabled=!0})(o),a.removeEventListener("drop",s)};return{initializeBoardDOM:()=>{const t=document.querySelector(".player-board"),a=document.querySelector(".opponent-board");e(t),e(a)},insertDraggedImage:s,rotateShipImage:e=>{const t=Array.from(e.classList);t.includes("horizontal")?(e.classList.remove("horizontal"),e.classList.add("vertical")):t.includes("vertical")&&(e.classList.remove("vertical"),e.classList.add("horizontal"))},rotateDraggedImage:e=>{const t=e.target.cloneNode(),a=document.createElement("div");a.classList.add("temp-rotate"),((e,t)=>{const a=Array.from(t.classList);a.includes("horizontal")?e.classList.add("temp-rotate-horizontal"):a.includes("vertical")&&(e.classList.add("temp-rotate-vertical"),"5"===t.dataset.shipLength?e.classList.add("temp-rotate-vertical-5"):"4"===t.dataset.shipLength?e.classList.add("temp-rotate-vertical-4"):"3"===t.dataset.shipLength?e.classList.add("temp-rotate-vertical-3"):"2"===t.dataset.shipLength&&e.classList.add("temp-rotate-vertical-2"))})(a,t),a.appendChild(t),document.body.appendChild(a),e.dataTransfer.setDragImage(a,0,0),setTimeout((()=>{document.body.removeChild(a)}),0)},getDraggedImage:e=>{const t={image:e.target.src,shipLength:e.target.dataset.shipLength,horizontal:!1,vertical:!1,elementID:e.target.getAttribute("id")};Array.from(e.target.classList).includes("horizontal")?t.horizontal=!0:Array.from(e.target.classList).includes("vertical")&&(t.vertical=!0),console.log(t);const a=JSON.stringify(t);e.dataTransfer.setData("image",a)},dragOver:a}})(),s=()=>{document.querySelectorAll(".ship-placement").forEach((e=>{const t=e.children[0];e.children[2].addEventListener("click",(()=>{a.rotateShipImage(t)}))}))},r=()=>{Array.from(document.querySelectorAll(".ship-piece")).forEach((e=>{e.addEventListener("dragstart",(e=>{a.getDraggedImage(e),a.rotateDraggedImage(e)}))}))};t.createGame(),a.initializeBoardDOM(),s(),r()})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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RUFXeUIsS0FDUmhFLE1BQU1DLEtBQUtYLFNBQVMyRSxpQkFBaUIsZ0JBQzdDQyxTQUFTeEosSUFDbEJBLEVBQUsyRixpQkFBaUIsYUFBY0MsSUFDbEN0QixFQUFjMkUsZ0JBQWdCckQsR0FDOUJ0QixFQUFjaUUsbUJBQW1CM0MsRUFBTSxHQUN2QyxHQUNGLEVDaEJOcEUsRUFBU3dDLGFBRVRNLEVBQWMwRCxxQkFFZHNCLElBRUFBLEciLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9vZGluLWJhdHRsZXNoaXAvLi9zcmMvc2hpcC5qcyIsIndlYnBhY2s6Ly9vZGluLWJhdHRsZXNoaXAvLi9zcmMvcGxheWVyLmpzIiwid2VicGFjazovL29kaW4tYmF0dGxlc2hpcC8uL3NyYy9nYW1lYm9hcmQuanMiLCJ3ZWJwYWNrOi8vb2Rpbi1iYXR0bGVzaGlwLy4vc3JjL2dhbWVsb29wLmpzIiwid2VicGFjazovL29kaW4tYmF0dGxlc2hpcC8uL3NyYy9ET01fY29udHJvbGxlci5qcyIsIndlYnBhY2s6Ly9vZGluLWJhdHRsZXNoaXAvLi9zcmMvZXZlbnRfbGlzdGVuZXJfY29udHJvbGxlci5qcyIsIndlYnBhY2s6Ly9vZGluLWJhdHRsZXNoaXAvLi9zcmMvaW5kZXguanMiXSwic291cmNlc0NvbnRlbnQiOlsiY29uc3QgU2hpcCA9IChnaXZlbkxlbmd0aCkgPT4ge1xuICBjb25zdCBsZW5ndGggPSBnaXZlbkxlbmd0aDtcbiAgbGV0IGhpdHMgPSAwO1xuICBsZXQgc3VuayA9IGZhbHNlO1xuICBjb25zdCBnZXRTaGlwTGVuZ3RoID0gKCkgPT4gbGVuZ3RoO1xuICBjb25zdCBnZXRTaGlwSGl0cyA9ICgpID0+IGhpdHM7XG4gIGNvbnN0IGlzU3VuayA9ICgpID0+IHN1bms7XG4gIGNvbnN0IGNoZWNrSWZTdW5rID0gKCkgPT4ge1xuICAgIGlmIChoaXRzID09PSBsZW5ndGgpIHtcbiAgICAgIHN1bmsgPSB0cnVlO1xuICAgIH1cbiAgfTtcbiAgY29uc3QgaGl0ID0gKCkgPT4ge1xuICAgIGlmICghc3Vuaykge1xuICAgICAgaGl0cyArPSAxO1xuICAgICAgY2hlY2tJZlN1bmsoKTtcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIFwiVGhhdCBzaGlwIGhhcyBhbHJlYWR5IGJlZW4gc3VuayFcIjtcbiAgICB9XG4gIH07XG4gIHJldHVybiB7XG4gICAgZ2V0U2hpcExlbmd0aCxcbiAgICBnZXRTaGlwSGl0cyxcbiAgICBpc1N1bmssXG4gICAgaGl0LFxuICB9O1xufTtcblxuZXhwb3J0IHsgU2hpcCB9O1xuIiwiaW1wb3J0IHsgU2hpcCB9IGZyb20gXCIuL3NoaXBcIjtcbmltcG9ydCB7IEdhbWVib2FyZCB9IGZyb20gXCIuL2dhbWVib2FyZFwiO1xuaW1wb3J0IHsgR2FtZUxvb3AgfSBmcm9tIFwiLi9nYW1lbG9vcFwiO1xuXG5jb25zdCBQbGF5ZXIgPSAocGxheWVyVHlwZSkgPT4ge1xuICBjb25zdCBkZXRlcm1pbmVQbGF5ZXJUeXBlID0gKCkgPT4ge1xuICAgIGlmIChwbGF5ZXJUeXBlID09PSBcImh1bWFuXCIpIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgaWYgKHBsYXllclR5cGUgPT09IFwiY29tcHV0ZXJcIikge1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICB9O1xuICBjb25zdCBjb21wdXRlclBsYXllciA9IGRldGVybWluZVBsYXllclR5cGUoKTtcbiAgY29uc3QgcGxheWVyR2FtZWJvYXJkID0gR2FtZWJvYXJkKCk7XG4gIGxldCBvcHBvc2luZ1BsYXllcjtcbiAgY29uc3QgaXNDb21wdXRlciA9ICgpID0+IGNvbXB1dGVyUGxheWVyO1xuICBjb25zdCBnZXRHYW1lYm9hcmQgPSAoKSA9PiBwbGF5ZXJHYW1lYm9hcmQ7XG4gIGNvbnN0IGdldE9wcG9zaW5nUGxheWVyID0gKCkgPT4gb3Bwb3NpbmdQbGF5ZXI7XG4gIGNvbnN0IHNldE9wcG9zaW5nUGxheWVyID0gKHBsYXllcikgPT4ge1xuICAgIG9wcG9zaW5nUGxheWVyID0gcGxheWVyO1xuICB9O1xuICBjb25zdCBhZGRTaGlwVG9HYW1lYm9hcmQgPSAoc2hpcExlbmd0aCwgY29vcmRpbmF0ZXMpID0+IHtcbiAgICBjb25zdCBzaGlwID0gU2hpcChzaGlwTGVuZ3RoKTtcbiAgICBwbGF5ZXJHYW1lYm9hcmQucGxhY2VTaGlwKHNoaXAsIGNvb3JkaW5hdGVzKTtcbiAgfTtcbiAgY29uc3Qgc2VuZEF0dGFjayA9IChjb29yZGluYXRlcykgPT4ge1xuICAgIGNvbnN0IG9wcG9zaW5nUGxheWVyR2FtZWJvYXJkID0gb3Bwb3NpbmdQbGF5ZXIuZ2V0R2FtZWJvYXJkKCk7XG4gICAgY29uc3QgYXR0YWNrUmVzdWx0cyA9IG9wcG9zaW5nUGxheWVyLnJlY2VpdmVBdHRhY2soY29vcmRpbmF0ZXMpO1xuICAgIGlmIChhdHRhY2tSZXN1bHRzID09PSBcImhpdFwiKSB7XG4gICAgICBwbGF5ZXJHYW1lYm9hcmQuYWRkU2VudEhpdFNob3QoY29vcmRpbmF0ZXMpO1xuICAgICAgaWYgKG9wcG9zaW5nUGxheWVyR2FtZWJvYXJkLmlzQWxsU2hpcHNTdW5rKCkpIHtcbiAgICAgICAgR2FtZUxvb3AuZW5kR2FtZShvcHBvc2luZ1BsYXllcik7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICB9IGVsc2UgaWYgKGF0dGFja1Jlc3VsdHMgPT09IFwibWlzc1wiKSB7XG4gICAgICBwbGF5ZXJHYW1lYm9hcmQuYWRkU2VudE1pc3NlZFNob3QoY29vcmRpbmF0ZXMpO1xuICAgIH1cbiAgICBpZiAob3Bwb3NpbmdQbGF5ZXIuaXNDb21wdXRlcigpKSB7XG4gICAgICBvcHBvc2luZ1BsYXllci5zZW5kQ29tcHV0ZXJBdHRhY2soKTtcbiAgICB9XG4gIH07XG4gIGNvbnN0IGluaXRpYWxpemVDb21wdXRlckdhbWVib2FyZCA9ICgpID0+IHtcbiAgICBpZiAoIWNvbXB1dGVyUGxheWVyKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGNvbnN0IGxlbmd0aHNPZlNoaXBzID0gWzUsIDQsIDMsIDMsIDJdO1xuICAgIGZvciAoY29uc3Qgc2hpcExlbmd0aCBvZiBsZW5ndGhzT2ZTaGlwcykge1xuICAgICAgY29uc3Qgc2hpcENvb3JkaW5hdGVzID0gZ2VuZXJhdGVDb21wdXRlclNoaXBDb29yZGluYXRlcyhzaGlwTGVuZ3RoKTtcbiAgICAgIGFkZFNoaXBUb0dhbWVib2FyZChzaGlwTGVuZ3RoLCBzaGlwQ29vcmRpbmF0ZXMpO1xuICAgIH1cbiAgfTtcbiAgY29uc3Qgc2VuZENvbXB1dGVyQXR0YWNrID0gKCkgPT4ge1xuICAgIGlmICghY29tcHV0ZXJQbGF5ZXIpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgY29uc3QgYXR0YWNrQ29vcmRpbmF0ZXMgPSBnZW5lcmF0ZUF0dGFja0Nvb3JkaW5hdGVzKCk7XG4gICAgc2VuZEF0dGFjayhhdHRhY2tDb29yZGluYXRlcyk7XG4gIH07XG4gIGNvbnN0IHJlY2VpdmVBdHRhY2sgPSAoY29vcmRpbmF0ZXMpID0+IHtcbiAgICBjb25zdCBhdHRhY2tSZXN1bHRzID0gcGxheWVyR2FtZWJvYXJkLnJlY2VpdmVBdHRhY2soY29vcmRpbmF0ZXMpO1xuICAgIHJldHVybiBhdHRhY2tSZXN1bHRzO1xuICB9O1xuICBjb25zdCBnZW5lcmF0ZUNvbXB1dGVyU2hpcENvb3JkaW5hdGVzID0gKHNoaXBMZW5ndGgpID0+IHtcbiAgICBsZXQgbGlzdE9mQ29vcmRpbmF0ZXMgPSBbXTtcbiAgICBkbyB7XG4gICAgICBsaXN0T2ZDb29yZGluYXRlcyA9IFtdO1xuICAgICAgY29uc3Qgc3RhcnRpbmdDb29yZGluYXRlcyA9IGdlbmVyYXRlU3RhcnRpbmdDb29yZGluYXRlcygpO1xuICAgICAgY29uc3Qgbm9uU3RhcnRpbmdDb29yZGluYXRlcyA9IGdlbmVyYXRlTm9uU3RhcnRpbmdDb29yZGluYXRlcyhcbiAgICAgICAgc3RhcnRpbmdDb29yZGluYXRlcyxcbiAgICAgICAgc2hpcExlbmd0aFxuICAgICAgKTtcbiAgICAgIGxpc3RPZkNvb3JkaW5hdGVzLnB1c2goc3RhcnRpbmdDb29yZGluYXRlcyk7XG4gICAgICBsaXN0T2ZDb29yZGluYXRlcyA9IGxpc3RPZkNvb3JkaW5hdGVzLmNvbmNhdChub25TdGFydGluZ0Nvb3JkaW5hdGVzKTtcbiAgICB9IHdoaWxlIChsaXN0T2ZDb29yZGluYXRlcy5sZW5ndGggPCBzaGlwTGVuZ3RoKTtcbiAgICByZXR1cm4gbGlzdE9mQ29vcmRpbmF0ZXM7XG4gIH07XG4gIGNvbnN0IGdlbmVyYXRlU3RhcnRpbmdDb29yZGluYXRlcyA9ICgpID0+IHtcbiAgICBjb25zdCBzdGFydGluZ0Nvb3JkaW5hdGVzID0gW3VuZGVmaW5lZCwgdW5kZWZpbmVkXTtcbiAgICBkbyB7XG4gICAgICBzdGFydGluZ0Nvb3JkaW5hdGVzWzBdID0gZ2VuZXJhdGVSYW5kb21Db29yZGluYXRlKCk7XG4gICAgICBzdGFydGluZ0Nvb3JkaW5hdGVzWzFdID0gZ2VuZXJhdGVSYW5kb21Db29yZGluYXRlKCk7XG4gICAgfSB3aGlsZSAocGxheWVyR2FtZWJvYXJkLmdldENvb3JkaW5hdGVzKHN0YXJ0aW5nQ29vcmRpbmF0ZXMpICE9PSB1bmRlZmluZWQpO1xuICAgIHJldHVybiBzdGFydGluZ0Nvb3JkaW5hdGVzO1xuICB9O1xuICBjb25zdCBnZW5lcmF0ZU5vblN0YXJ0aW5nQ29vcmRpbmF0ZXMgPSAoc3RhcnRpbmdDb29yZGluYXRlcywgc2hpcExlbmd0aCkgPT4ge1xuICAgIGNvbnN0IHBvc3NpYmxlQ29vcmRpbmF0ZXMgPSBbXTtcbiAgICBpZiAoY2hlY2tJZlZhbGlkRW1wdHlDb29yZGluYXRlcyhzdGFydGluZ0Nvb3JkaW5hdGVzLCBzaGlwTGVuZ3RoLCBcInVwXCIpKSB7XG4gICAgICBjb25zdCB1cENvb3JkaW5hdGVzID0gW107XG4gICAgICBmb3IgKGxldCBpID0gMTsgaSA8IHNoaXBMZW5ndGg7IGkrKykge1xuICAgICAgICB1cENvb3JkaW5hdGVzLnB1c2goW1xuICAgICAgICAgIHN0YXJ0aW5nQ29vcmRpbmF0ZXNbMF0gLSBpLFxuICAgICAgICAgIHN0YXJ0aW5nQ29vcmRpbmF0ZXNbMV0sXG4gICAgICAgIF0pO1xuICAgICAgfVxuICAgICAgcG9zc2libGVDb29yZGluYXRlcy5wdXNoKHVwQ29vcmRpbmF0ZXMpO1xuICAgIH1cbiAgICBpZiAoXG4gICAgICBjaGVja0lmVmFsaWRFbXB0eUNvb3JkaW5hdGVzKHN0YXJ0aW5nQ29vcmRpbmF0ZXMsIHNoaXBMZW5ndGgsIFwicmlnaHRcIilcbiAgICApIHtcbiAgICAgIGNvbnN0IHJpZ2h0Q29vcmRpbmF0ZXMgPSBbXTtcbiAgICAgIGZvciAobGV0IGkgPSAxOyBpIDwgc2hpcExlbmd0aDsgaSsrKSB7XG4gICAgICAgIHJpZ2h0Q29vcmRpbmF0ZXMucHVzaChbXG4gICAgICAgICAgc3RhcnRpbmdDb29yZGluYXRlc1swXSxcbiAgICAgICAgICBzdGFydGluZ0Nvb3JkaW5hdGVzWzFdICsgaSxcbiAgICAgICAgXSk7XG4gICAgICB9XG4gICAgICBwb3NzaWJsZUNvb3JkaW5hdGVzLnB1c2gocmlnaHRDb29yZGluYXRlcyk7XG4gICAgfVxuICAgIGlmIChjaGVja0lmVmFsaWRFbXB0eUNvb3JkaW5hdGVzKHN0YXJ0aW5nQ29vcmRpbmF0ZXMsIHNoaXBMZW5ndGgsIFwiZG93blwiKSkge1xuICAgICAgY29uc3QgZG93bkNvb3JkaW5hdGVzID0gW107XG4gICAgICBmb3IgKGxldCBpID0gMTsgaSA8IHNoaXBMZW5ndGg7IGkrKykge1xuICAgICAgICBkb3duQ29vcmRpbmF0ZXMucHVzaChbXG4gICAgICAgICAgc3RhcnRpbmdDb29yZGluYXRlc1swXSArIGksXG4gICAgICAgICAgc3RhcnRpbmdDb29yZGluYXRlc1sxXSxcbiAgICAgICAgXSk7XG4gICAgICB9XG4gICAgICBwb3NzaWJsZUNvb3JkaW5hdGVzLnB1c2goZG93bkNvb3JkaW5hdGVzKTtcbiAgICB9XG4gICAgaWYgKGNoZWNrSWZWYWxpZEVtcHR5Q29vcmRpbmF0ZXMoc3RhcnRpbmdDb29yZGluYXRlcywgc2hpcExlbmd0aCwgXCJsZWZ0XCIpKSB7XG4gICAgICBjb25zdCBsZWZ0Q29vcmRpbmF0ZXMgPSBbXTtcbiAgICAgIGZvciAobGV0IGkgPSAxOyBpIDwgc2hpcExlbmd0aDsgaSsrKSB7XG4gICAgICAgIGxlZnRDb29yZGluYXRlcy5wdXNoKFtcbiAgICAgICAgICBzdGFydGluZ0Nvb3JkaW5hdGVzWzBdLFxuICAgICAgICAgIHN0YXJ0aW5nQ29vcmRpbmF0ZXNbMV0gLSBpLFxuICAgICAgICBdKTtcbiAgICAgIH1cbiAgICAgIHBvc3NpYmxlQ29vcmRpbmF0ZXMucHVzaChsZWZ0Q29vcmRpbmF0ZXMpO1xuICAgIH1cbiAgICBpZiAocG9zc2libGVDb29yZGluYXRlcy5sZW5ndGggPT09IDApIHtcbiAgICAgIHJldHVybiBwb3NzaWJsZUNvb3JkaW5hdGVzO1xuICAgIH1cbiAgICBjb25zdCByYW5kb21JbmRleCA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIHBvc3NpYmxlQ29vcmRpbmF0ZXMubGVuZ3RoKTtcbiAgICByZXR1cm4gcG9zc2libGVDb29yZGluYXRlc1tyYW5kb21JbmRleF07XG4gIH07XG4gIGNvbnN0IGdlbmVyYXRlUmFuZG9tQ29vcmRpbmF0ZSA9ICgpID0+IHtcbiAgICBjb25zdCBCT0FSREFYRVNMRU5HVEggPSAxMDtcbiAgICByZXR1cm4gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogQk9BUkRBWEVTTEVOR1RIKTtcbiAgfTtcbiAgY29uc3QgY2hlY2tJZlByZXZpb3VzbHlBdHRhY2tlZCA9IChcbiAgICBvcHBvc2luZ1BsYXllclJlY2VpdmVkU2hvdHMsXG4gICAgYXR0YWNrQ29vcmRpbmF0ZXNcbiAgKSA9PlxuICAgIG9wcG9zaW5nUGxheWVyUmVjZWl2ZWRTaG90cy5zb21lKFxuICAgICAgKHJlY2VpdmVkU2hvdCkgPT5cbiAgICAgICAgcmVjZWl2ZWRTaG90WzBdID09PSBhdHRhY2tDb29yZGluYXRlc1swXSAmJlxuICAgICAgICByZWNlaXZlZFNob3RbMV0gPT09IGF0dGFja0Nvb3JkaW5hdGVzWzFdXG4gICAgKTtcbiAgY29uc3QgZ2VuZXJhdGVBdHRhY2tDb29yZGluYXRlcyA9ICgpID0+IHtcbiAgICBjb25zdCByZWNlaXZlZE1pc3NlZFNob3RzID0gb3Bwb3NpbmdQbGF5ZXJcbiAgICAgIC5nZXRHYW1lYm9hcmQoKVxuICAgICAgLmdldFJlY2VpdmVkTWlzc2VkU2hvdHMoKTtcbiAgICBjb25zdCByZWNlaXZlZEhpdFNob3RzID0gb3Bwb3NpbmdQbGF5ZXJcbiAgICAgIC5nZXRHYW1lYm9hcmQoKVxuICAgICAgLmdldFJlY2VpdmVkSGl0U2hvdHMoKTtcbiAgICBjb25zdCBhdHRhY2tDb29yZGluYXRlcyA9IFt1bmRlZmluZWQsIHVuZGVmaW5lZF07XG4gICAgZG8ge1xuICAgICAgYXR0YWNrQ29vcmRpbmF0ZXNbMF0gPSBnZW5lcmF0ZVJhbmRvbUNvb3JkaW5hdGUoKTtcbiAgICAgIGF0dGFja0Nvb3JkaW5hdGVzWzFdID0gZ2VuZXJhdGVSYW5kb21Db29yZGluYXRlKCk7XG4gICAgfSB3aGlsZSAoXG4gICAgICBjaGVja0lmUHJldmlvdXNseUF0dGFja2VkKHJlY2VpdmVkTWlzc2VkU2hvdHMsIGF0dGFja0Nvb3JkaW5hdGVzKSB8fFxuICAgICAgY2hlY2tJZlByZXZpb3VzbHlBdHRhY2tlZChyZWNlaXZlZEhpdFNob3RzLCBhdHRhY2tDb29yZGluYXRlcylcbiAgICApO1xuICAgIHJldHVybiBhdHRhY2tDb29yZGluYXRlcztcbiAgfTtcbiAgY29uc3QgY2hlY2tJZlZhbGlkRW1wdHlDb29yZGluYXRlcyA9IChcbiAgICBzdGFydGluZ0Nvb3JkaW5hdGVzLFxuICAgIHNoaXBMZW5ndGgsXG4gICAgZGlyZWN0aW9uXG4gICkgPT4ge1xuICAgIHN3aXRjaCAoZGlyZWN0aW9uKSB7XG4gICAgICBjYXNlIFwidXBcIjpcbiAgICAgICAgaWYgKHN0YXJ0aW5nQ29vcmRpbmF0ZXNbMF0gLSAoc2hpcExlbmd0aCAtIDEpIDwgMCkge1xuICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgICBmb3IgKGxldCBpID0gMTsgaSA8IHNoaXBMZW5ndGg7IGkrKykge1xuICAgICAgICAgIGlmIChcbiAgICAgICAgICAgIHBsYXllckdhbWVib2FyZC5nZXRDb29yZGluYXRlcyhbXG4gICAgICAgICAgICAgIHN0YXJ0aW5nQ29vcmRpbmF0ZXNbMF0gLSBpLFxuICAgICAgICAgICAgICBzdGFydGluZ0Nvb3JkaW5hdGVzWzFdLFxuICAgICAgICAgICAgXSkgIT09IHVuZGVmaW5lZFxuICAgICAgICAgICkge1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdHJ1ZTtcblxuICAgICAgY2FzZSBcInJpZ2h0XCI6XG4gICAgICAgIGlmIChzdGFydGluZ0Nvb3JkaW5hdGVzWzFdICsgKHNoaXBMZW5ndGggLSAxKSA+IDkpIHtcbiAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgZm9yIChsZXQgaSA9IDE7IGkgPCBzaGlwTGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICBpZiAoXG4gICAgICAgICAgICBwbGF5ZXJHYW1lYm9hcmQuZ2V0Q29vcmRpbmF0ZXMoW1xuICAgICAgICAgICAgICBzdGFydGluZ0Nvb3JkaW5hdGVzWzBdLFxuICAgICAgICAgICAgICBzdGFydGluZ0Nvb3JkaW5hdGVzWzFdICsgaSxcbiAgICAgICAgICAgIF0pICE9PSB1bmRlZmluZWRcbiAgICAgICAgICApIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRydWU7XG5cbiAgICAgIGNhc2UgXCJkb3duXCI6XG4gICAgICAgIGlmIChzdGFydGluZ0Nvb3JkaW5hdGVzWzBdICsgKHNoaXBMZW5ndGggLSAxKSA+IDkpIHtcbiAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgZm9yIChsZXQgaSA9IDE7IGkgPCBzaGlwTGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICBpZiAoXG4gICAgICAgICAgICBwbGF5ZXJHYW1lYm9hcmQuZ2V0Q29vcmRpbmF0ZXMoW1xuICAgICAgICAgICAgICBzdGFydGluZ0Nvb3JkaW5hdGVzWzBdICsgaSxcbiAgICAgICAgICAgICAgc3RhcnRpbmdDb29yZGluYXRlc1sxXSxcbiAgICAgICAgICAgIF0pICE9PSB1bmRlZmluZWRcbiAgICAgICAgICApIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRydWU7XG5cbiAgICAgIGNhc2UgXCJsZWZ0XCI6XG4gICAgICAgIGlmIChzdGFydGluZ0Nvb3JkaW5hdGVzWzFdIC0gKHNoaXBMZW5ndGggLSAxKSA8IDApIHtcbiAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgZm9yIChsZXQgaSA9IDE7IGkgPCBzaGlwTGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICBpZiAoXG4gICAgICAgICAgICBwbGF5ZXJHYW1lYm9hcmQuZ2V0Q29vcmRpbmF0ZXMoW1xuICAgICAgICAgICAgICBzdGFydGluZ0Nvb3JkaW5hdGVzWzBdLFxuICAgICAgICAgICAgICBzdGFydGluZ0Nvb3JkaW5hdGVzWzFdIC0gaSxcbiAgICAgICAgICAgIF0pICE9PSB1bmRlZmluZWRcbiAgICAgICAgICApIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRydWU7XG5cbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIGJyZWFrO1xuICAgIH1cbiAgfTtcbiAgcmV0dXJuIHtcbiAgICBpc0NvbXB1dGVyLFxuICAgIGdldEdhbWVib2FyZCxcbiAgICBnZXRPcHBvc2luZ1BsYXllcixcbiAgICBzZXRPcHBvc2luZ1BsYXllcixcbiAgICBhZGRTaGlwVG9HYW1lYm9hcmQsXG4gICAgc2VuZEF0dGFjayxcbiAgICBpbml0aWFsaXplQ29tcHV0ZXJHYW1lYm9hcmQsXG4gICAgc2VuZENvbXB1dGVyQXR0YWNrLFxuICAgIHJlY2VpdmVBdHRhY2ssXG4gICAgY2hlY2tJZlZhbGlkRW1wdHlDb29yZGluYXRlcyxcbiAgfTtcbn07XG5cbmV4cG9ydCB7IFBsYXllciB9O1xuIiwiY29uc3QgR2FtZWJvYXJkID0gKCkgPT4ge1xuICBjb25zdCBjcmVhdGVCb2FyZCA9ICgpID0+IHtcbiAgICBjb25zdCBib2FyZCA9IFtdO1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgMTA7IGkrKykge1xuICAgICAgYm9hcmQucHVzaChbXSk7XG4gICAgICBmb3IgKGxldCBqID0gMDsgaiA8IDEwOyBqKyspIHtcbiAgICAgICAgYm9hcmRbaV0ucHVzaCh1bmRlZmluZWQpO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gYm9hcmQ7XG4gIH07XG4gIGNvbnN0IGJvYXJkID0gY3JlYXRlQm9hcmQoKTtcbiAgY29uc3QgcGxhY2VkU2hpcHMgPSBbXTtcbiAgY29uc3QgcmVjZWl2ZWRNaXNzZWRTaG90cyA9IFtdO1xuICBjb25zdCByZWNlaXZlZEhpdFNob3RzID0gW107XG4gIGNvbnN0IHNlbnRNaXNzZWRTaG90cyA9IFtdO1xuICBjb25zdCBzZW50SGl0U2hvdHMgPSBbXTtcbiAgbGV0IGFsbFNoaXBzU3VuayA9IGZhbHNlO1xuICBjb25zdCBnZXRDb29yZGluYXRlcyA9IChjb29yZGluYXRlcykgPT4gYm9hcmRbY29vcmRpbmF0ZXNbMF1dW2Nvb3JkaW5hdGVzWzFdXTtcbiAgY29uc3QgZ2V0UGxhY2VkU2hpcHMgPSAoKSA9PiBwbGFjZWRTaGlwcztcbiAgY29uc3QgZ2V0UmVjZWl2ZWRNaXNzZWRTaG90cyA9ICgpID0+IHJlY2VpdmVkTWlzc2VkU2hvdHM7XG4gIGNvbnN0IGdldFJlY2VpdmVkSGl0U2hvdHMgPSAoKSA9PiByZWNlaXZlZEhpdFNob3RzO1xuICBjb25zdCBnZXRTZW50TWlzc2VkU2hvdHMgPSAoKSA9PiBzZW50TWlzc2VkU2hvdHM7XG4gIGNvbnN0IGdldFNlbnRIaXRTaG90cyA9ICgpID0+IHNlbnRIaXRTaG90cztcbiAgY29uc3QgaXNBbGxTaGlwc1N1bmsgPSAoKSA9PiBhbGxTaGlwc1N1bms7XG4gIGNvbnN0IHBsYWNlU2hpcCA9IChzaGlwLCBjb29yZGluYXRlc0xpc3QpID0+IHtcbiAgICBmb3IgKGNvbnN0IGNvb3JkaW5hdGVzIG9mIGNvb3JkaW5hdGVzTGlzdCkge1xuICAgICAgYm9hcmRbY29vcmRpbmF0ZXNbMF1dW2Nvb3JkaW5hdGVzWzFdXSA9IHNoaXA7XG4gICAgfVxuICAgIHBsYWNlZFNoaXBzLnB1c2goc2hpcCk7XG4gIH07XG4gIGNvbnN0IGNoZWNrQWxsU2hpcHNTdW5rID0gKCkgPT4ge1xuICAgIGlmIChwbGFjZWRTaGlwcy5ldmVyeSgoc2hpcCkgPT4gc2hpcC5pc1N1bmsoKSkpIHtcbiAgICAgIGFsbFNoaXBzU3VuayA9IHRydWU7XG4gICAgfVxuICB9O1xuICBjb25zdCByZWNlaXZlQXR0YWNrID0gKGNvb3JkaW5hdGVzKSA9PiB7XG4gICAgY29uc3QgZW50aXR5QXRDb29yZGluYXRlcyA9IGdldENvb3JkaW5hdGVzKGNvb3JkaW5hdGVzKTtcbiAgICBpZiAoZW50aXR5QXRDb29yZGluYXRlcyAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICBlbnRpdHlBdENvb3JkaW5hdGVzLmhpdCgpO1xuICAgICAgY2hlY2tBbGxTaGlwc1N1bmsoKTtcbiAgICAgIHJlY2VpdmVkSGl0U2hvdHMucHVzaChjb29yZGluYXRlcyk7XG4gICAgICByZXR1cm4gXCJoaXRcIjtcbiAgICB9XG4gICAgcmVjZWl2ZWRNaXNzZWRTaG90cy5wdXNoKGNvb3JkaW5hdGVzKTtcbiAgICByZXR1cm4gXCJtaXNzXCI7XG4gIH07XG4gIGNvbnN0IGFkZFNlbnRNaXNzZWRTaG90ID0gKGNvb3JkaW5hdGVzKSA9PiB7XG4gICAgc2VudE1pc3NlZFNob3RzLnB1c2goY29vcmRpbmF0ZXMpO1xuICB9O1xuICBjb25zdCBhZGRTZW50SGl0U2hvdCA9IChjb29yZGluYXRlcykgPT4ge1xuICAgIHNlbnRIaXRTaG90cy5wdXNoKGNvb3JkaW5hdGVzKTtcbiAgfTtcbiAgcmV0dXJuIHtcbiAgICBnZXRDb29yZGluYXRlcyxcbiAgICBnZXRQbGFjZWRTaGlwcyxcbiAgICBnZXRSZWNlaXZlZE1pc3NlZFNob3RzLFxuICAgIGdldFJlY2VpdmVkSGl0U2hvdHMsXG4gICAgZ2V0U2VudE1pc3NlZFNob3RzLFxuICAgIGdldFNlbnRIaXRTaG90cyxcbiAgICBpc0FsbFNoaXBzU3VuayxcbiAgICBwbGFjZVNoaXAsXG4gICAgcmVjZWl2ZUF0dGFjayxcbiAgICBhZGRTZW50TWlzc2VkU2hvdCxcbiAgICBhZGRTZW50SGl0U2hvdCxcbiAgfTtcbn07XG5cbmV4cG9ydCB7IEdhbWVib2FyZCB9O1xuIiwiaW1wb3J0IHsgU2hpcCB9IGZyb20gXCIuL3NoaXBcIjtcbmltcG9ydCB7IEdhbWVib2FyZCB9IGZyb20gXCIuL2dhbWVib2FyZFwiO1xuaW1wb3J0IHsgUGxheWVyIH0gZnJvbSBcIi4vcGxheWVyXCI7XG5cbmNvbnN0IEdhbWVMb29wID0gKCgpID0+IHtcbiAgY29uc3QgcGxheWVycyA9IFtdO1xuICBsZXQgaW5Qcm9ncmVzcyA9IHRydWU7XG4gIGxldCB3aW5uZXI7XG4gIGNvbnN0IGdldFBsYXllcnMgPSAoKSA9PiBwbGF5ZXJzO1xuICBjb25zdCBpc0luUHJvZ3Jlc3MgPSAoKSA9PiBpblByb2dyZXNzO1xuICBjb25zdCBnZXRXaW5uZXIgPSAoKSA9PiB3aW5uZXI7XG4gIGNvbnN0IHNldFdpbm5lciA9IChsb3NlclBsYXllcikgPT4ge1xuICAgIGNvbnN0IHdpbm5lclBsYXllciA9IGxvc2VyUGxheWVyLmdldE9wcG9zaW5nUGxheWVyKCk7XG4gICAgd2lubmVyID0gd2lubmVyUGxheWVyO1xuICB9O1xuICBjb25zdCBjcmVhdGVHYW1lID0gKCkgPT4ge1xuICAgIGNvbnN0IGh1bWFuUGxheWVyID0gUGxheWVyKFwiaHVtYW5cIik7XG4gICAgcGxheWVycy5wdXNoKGh1bWFuUGxheWVyKTtcbiAgICBjb25zdCBjb21wdXRlclBsYXllciA9IFBsYXllcihcImNvbXB1dGVyXCIpO1xuICAgIHBsYXllcnMucHVzaChjb21wdXRlclBsYXllcik7XG4gICAgaHVtYW5QbGF5ZXIuc2V0T3Bwb3NpbmdQbGF5ZXIoY29tcHV0ZXJQbGF5ZXIpO1xuICAgIGNvbXB1dGVyUGxheWVyLnNldE9wcG9zaW5nUGxheWVyKGh1bWFuUGxheWVyKTtcbiAgICBjb21wdXRlclBsYXllci5pbml0aWFsaXplQ29tcHV0ZXJHYW1lYm9hcmQoKTtcbiAgfTtcbiAgY29uc3QgZW5kR2FtZSA9IChsb3NlclBsYXllcikgPT4ge1xuICAgIGluUHJvZ3Jlc3MgPSBmYWxzZTtcbiAgICBzZXRXaW5uZXIobG9zZXJQbGF5ZXIpO1xuICB9O1xuICBjb25zdCByZXNldEdhbWUgPSAoKSA9PiB7XG4gICAgcGxheWVycy5sZW5ndGggPSAwO1xuICAgIGluUHJvZ3Jlc3MgPSB0cnVlO1xuICAgIHdpbm5lciA9IHVuZGVmaW5lZDtcbiAgfTtcbiAgcmV0dXJuIHtcbiAgICBnZXRQbGF5ZXJzLFxuICAgIGlzSW5Qcm9ncmVzcyxcbiAgICBnZXRXaW5uZXIsXG4gICAgY3JlYXRlR2FtZSxcbiAgICBlbmRHYW1lLFxuICAgIHJlc2V0R2FtZSxcbiAgfTtcbn0pKCk7XG5cbmV4cG9ydCB7IEdhbWVMb29wIH07XG4iLCJpbXBvcnQgeyBHYW1lTG9vcCB9IGZyb20gXCIuL2dhbWVsb29wXCI7XG5cbmNvbnN0IERPTUNvbnRyb2xsZXIgPSAoKCkgPT4ge1xuICBjb25zdCBjcmVhdGVCb2FyZENlbGxzID0gKGdhbWVib2FyZERPTSkgPT4ge1xuICAgIGNvbnN0IEJPQVJEQVhFU0xFTkdUSCA9IDEwO1xuICAgIGNvbnN0IGNvbHVtbkxhYmVscyA9IFtcIkFcIiwgXCJCXCIsIFwiQ1wiLCBcIkRcIiwgXCJFXCIsIFwiRlwiLCBcIkdcIiwgXCJIXCIsIFwiSVwiLCBcIkpcIl07XG4gICAgY29uc3Qgcm93TGFiZWxzID0gW1wiMVwiLCBcIjJcIiwgXCIzXCIsIFwiNFwiLCBcIjVcIiwgXCI2XCIsIFwiN1wiLCBcIjhcIiwgXCI5XCIsIFwiMTBcIl07XG4gICAgZm9yIChsZXQgaSA9IC0xOyBpIDwgQk9BUkRBWEVTTEVOR1RIOyBpKyspIHtcbiAgICAgIGZvciAobGV0IGogPSAtMTsgaiA8IEJPQVJEQVhFU0xFTkdUSDsgaisrKSB7XG4gICAgICAgIGlmIChpID09PSAtMSkge1xuICAgICAgICAgIGlmIChqID09PSAtMSkge1xuICAgICAgICAgICAgY29uc3QgaW52aXNpYmxlUGxhY2Vob2xkZXJFbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcbiAgICAgICAgICAgIGludmlzaWJsZVBsYWNlaG9sZGVyRWxlbWVudC5jbGFzc0xpc3QuYWRkKFwiZ2FtZWJvYXJkLWxhYmVsXCIpO1xuICAgICAgICAgICAgaW52aXNpYmxlUGxhY2Vob2xkZXJFbGVtZW50LnN0eWxlLnZpc2liaWxpdHkgPSBcImhpZGRlblwiO1xuICAgICAgICAgICAgZ2FtZWJvYXJkRE9NLmFwcGVuZENoaWxkKGludmlzaWJsZVBsYWNlaG9sZGVyRWxlbWVudCk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGNvbnN0IGNvbHVtbkxhYmVsRWxlbWVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG4gICAgICAgICAgICBjb2x1bW5MYWJlbEVsZW1lbnQuY2xhc3NMaXN0LmFkZChcImNvbHVtbi1sYWJlbFwiKTtcbiAgICAgICAgICAgIGNvbHVtbkxhYmVsRWxlbWVudC50ZXh0Q29udGVudCA9IGNvbHVtbkxhYmVsc1tqXTtcbiAgICAgICAgICAgIGdhbWVib2FyZERPTS5hcHBlbmRDaGlsZChjb2x1bW5MYWJlbEVsZW1lbnQpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIGlmIChqID09PSAtMSkge1xuICAgICAgICAgIGNvbnN0IHJvd0xhYmVsRWxlbWVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG4gICAgICAgICAgcm93TGFiZWxFbGVtZW50LmNsYXNzTGlzdC5hZGQoXCJyb3ctbGFiZWxcIik7XG4gICAgICAgICAgcm93TGFiZWxFbGVtZW50LnRleHRDb250ZW50ID0gcm93TGFiZWxzW2ldO1xuICAgICAgICAgIGdhbWVib2FyZERPTS5hcHBlbmRDaGlsZChyb3dMYWJlbEVsZW1lbnQpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIC8vIGNvbnN0IGNlbGxFbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcbiAgICAgICAgICAvLyBjZWxsRWxlbWVudC5zZXRBdHRyaWJ1dGUoXCJkYXRhLXJvd1wiLCBpKTtcbiAgICAgICAgICAvLyBjZWxsRWxlbWVudC5zZXRBdHRyaWJ1dGUoXCJkYXRhLWNvbHVtblwiLCBqKTtcbiAgICAgICAgICAvLyBjZWxsRWxlbWVudC5jbGFzc0xpc3QuYWRkKFwiZ2FtZWJvYXJkLWNlbGxcIik7XG4gICAgICAgICAgLy8gY2VsbEVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcImRyYWdvdmVyXCIsIChldmVudCkgPT4ge1xuICAgICAgICAgIC8vICAgZHJhZ092ZXIoZXZlbnQpO1xuICAgICAgICAgIC8vIH0pO1xuICAgICAgICAgIC8vIGNlbGxFbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJkcm9wXCIsIChldmVudCkgPT4ge1xuICAgICAgICAgIC8vICAgaW5zZXJ0RHJhZ2dlZEltYWdlKGV2ZW50KTtcbiAgICAgICAgICAvLyB9KTtcbiAgICAgICAgICBpZiAoQXJyYXkuZnJvbShnYW1lYm9hcmRET00uY2xhc3NMaXN0KS5pbmNsdWRlcyhcInBsYXllci1ib2FyZFwiKSkge1xuICAgICAgICAgICAgY29uc3QgY2VsbEVsZW1lbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuICAgICAgICAgICAgY2VsbEVsZW1lbnQuc2V0QXR0cmlidXRlKFwiZGF0YS1yb3dcIiwgaSk7XG4gICAgICAgICAgICBjZWxsRWxlbWVudC5zZXRBdHRyaWJ1dGUoXCJkYXRhLWNvbHVtblwiLCBqKTtcbiAgICAgICAgICAgIGNlbGxFbGVtZW50LmNsYXNzTGlzdC5hZGQoXCJnYW1lYm9hcmQtY2VsbFwiKTtcbiAgICAgICAgICAgIGNlbGxFbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJkcmFnb3ZlclwiLCAoZXZlbnQpID0+IHtcbiAgICAgICAgICAgICAgZHJhZ092ZXIoZXZlbnQpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBjZWxsRWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwiZHJvcFwiLCAoZXZlbnQpID0+IHtcbiAgICAgICAgICAgICAgaW5zZXJ0RHJhZ2dlZEltYWdlKGV2ZW50KTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgZ2FtZWJvYXJkRE9NLmFwcGVuZENoaWxkKGNlbGxFbGVtZW50KTtcbiAgICAgICAgICB9IGVsc2UgaWYgKFxuICAgICAgICAgICAgQXJyYXkuZnJvbShnYW1lYm9hcmRET00uY2xhc3NMaXN0KS5pbmNsdWRlcyhcIm9wcG9uZW50LWJvYXJkXCIpXG4gICAgICAgICAgKSB7XG4gICAgICAgICAgICBjb25zdCBjZWxsRWxlbWVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJidXR0b25cIik7XG4gICAgICAgICAgICBjZWxsRWxlbWVudC5zZXRBdHRyaWJ1dGUoXCJkYXRhLXJvd1wiLCBpKTtcbiAgICAgICAgICAgIGNlbGxFbGVtZW50LnNldEF0dHJpYnV0ZShcImRhdGEtY29sdW1uXCIsIGopO1xuICAgICAgICAgICAgY2VsbEVsZW1lbnQuY2xhc3NMaXN0LmFkZChcImdhbWVib2FyZC1jZWxsXCIpO1xuICAgICAgICAgICAgZ2FtZWJvYXJkRE9NLmFwcGVuZENoaWxkKGNlbGxFbGVtZW50KTtcbiAgICAgICAgICB9XG4gICAgICAgICAgLy8gc29tZSBjbGljayBldmVudCBsaXN0ZW5lciB3aGVyZSBhdHRhY2sgaXMgbWFkZSBPUiBwcmlvciB0byB0aGF0LCBwbGFjaW5nIHNoaXAgb24gdGhhdCBjZWxsXG4gICAgICAgICAgLy8gZ2FtZWJvYXJkRE9NLmFwcGVuZENoaWxkKGNlbGxFbGVtZW50KTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfTtcbiAgY29uc3QgZ2V0RHJhZ2dlZEltYWdlID0gKGV2ZW50KSA9PiB7XG4gICAgY29uc3QgZGF0YU9iamVjdCA9IHtcbiAgICAgIGltYWdlOiBldmVudC50YXJnZXQuc3JjLFxuICAgICAgc2hpcExlbmd0aDogZXZlbnQudGFyZ2V0LmRhdGFzZXQuc2hpcExlbmd0aCxcbiAgICAgIGhvcml6b250YWw6IGZhbHNlLFxuICAgICAgdmVydGljYWw6IGZhbHNlLFxuICAgICAgZWxlbWVudElEOiBldmVudC50YXJnZXQuZ2V0QXR0cmlidXRlKFwiaWRcIiksXG4gICAgfTtcbiAgICBpZiAoQXJyYXkuZnJvbShldmVudC50YXJnZXQuY2xhc3NMaXN0KS5pbmNsdWRlcyhcImhvcml6b250YWxcIikpIHtcbiAgICAgIGRhdGFPYmplY3QuaG9yaXpvbnRhbCA9IHRydWU7XG4gICAgfSBlbHNlIGlmIChBcnJheS5mcm9tKGV2ZW50LnRhcmdldC5jbGFzc0xpc3QpLmluY2x1ZGVzKFwidmVydGljYWxcIikpIHtcbiAgICAgIGRhdGFPYmplY3QudmVydGljYWwgPSB0cnVlO1xuICAgIH1cbiAgICBjb25zb2xlLmxvZyhkYXRhT2JqZWN0KTtcbiAgICBjb25zdCBkYXRhU3RyaW5nID0gSlNPTi5zdHJpbmdpZnkoZGF0YU9iamVjdCk7XG4gICAgZXZlbnQuZGF0YVRyYW5zZmVyLnNldERhdGEoXCJpbWFnZVwiLCBkYXRhU3RyaW5nKTtcbiAgfTtcbiAgY29uc3QgZHJhZ092ZXIgPSAoKSA9PiB7XG4gICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgfTtcbiAgY29uc3QgaW5pdGlhbGl6ZUJvYXJkRE9NID0gKCkgPT4ge1xuICAgIGNvbnN0IGh1bWFuUGxheWVyR2FtZWJvYXJkRE9NID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wbGF5ZXItYm9hcmRcIik7XG4gICAgY29uc3Qgb3Bwb25lbnRHYW1lYm9hcmRET00gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLm9wcG9uZW50LWJvYXJkXCIpO1xuICAgIGNyZWF0ZUJvYXJkQ2VsbHMoaHVtYW5QbGF5ZXJHYW1lYm9hcmRET00pO1xuICAgIGNyZWF0ZUJvYXJkQ2VsbHMob3Bwb25lbnRHYW1lYm9hcmRET00pO1xuICB9O1xuICBjb25zdCBpc1ZhbGlkR2FtZWJvYXJkQ2VsbCA9ICh0YXJnZXRDZWxsLCBkYXRhT2JqZWN0KSA9PiB7XG4gICAgY29uc3QgY2VsbENvb3JkaW5hdGVzID0gW1xuICAgICAgTnVtYmVyKHRhcmdldENlbGwuZGF0YXNldC5yb3cpLFxuICAgICAgTnVtYmVyKHRhcmdldENlbGwuZGF0YXNldC5jb2x1bW4pLFxuICAgIF07XG4gICAgY29uc3QgbGVuZ3RoID0gTnVtYmVyKGRhdGFPYmplY3Quc2hpcExlbmd0aCk7XG4gICAgaWYgKGRhdGFPYmplY3QuaG9yaXpvbnRhbCkge1xuICAgICAgaWYgKFxuICAgICAgICBHYW1lTG9vcC5nZXRQbGF5ZXJzKClbMF0uY2hlY2tJZlZhbGlkRW1wdHlDb29yZGluYXRlcyhcbiAgICAgICAgICBjZWxsQ29vcmRpbmF0ZXMsXG4gICAgICAgICAgbGVuZ3RoLFxuICAgICAgICAgIFwicmlnaHRcIlxuICAgICAgICApXG4gICAgICApIHtcbiAgICAgICAgY29uc29sZS5sb2coXCJmaXRzXCIpO1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgIH1cbiAgICAgIGNvbnNvbGUubG9nKFwibm9wZVwiKTtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgaWYgKGRhdGFPYmplY3QudmVydGljYWwpIHtcbiAgICAgIGlmIChcbiAgICAgICAgR2FtZUxvb3AuZ2V0UGxheWVycygpWzBdLmNoZWNrSWZWYWxpZEVtcHR5Q29vcmRpbmF0ZXMoXG4gICAgICAgICAgY2VsbENvb3JkaW5hdGVzLFxuICAgICAgICAgIGxlbmd0aCxcbiAgICAgICAgICBcImRvd25cIlxuICAgICAgICApXG4gICAgICApIHtcbiAgICAgICAgY29uc29sZS5sb2coXCJmaXRzXCIpO1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgIH1cbiAgICAgIGNvbnNvbGUubG9nKFwibm9wZVwiKTtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gIH07XG4gIGNvbnN0IGFkZFNoaXBUb0RPTSA9ICh0YXJnZXRDZWxsLCBkYXRhT2JqZWN0KSA9PiB7XG4gICAgY29uc3QgbGVuZ3RoID0gZGF0YU9iamVjdC5zaGlwTGVuZ3RoO1xuICAgIGNvbnN0IHRhcmdldENlbGxSb3cgPSBOdW1iZXIodGFyZ2V0Q2VsbC5kYXRhc2V0LnJvdyk7XG4gICAgY29uc3QgdGFyZ2V0Q2VsbENvbHVtbiA9IE51bWJlcih0YXJnZXRDZWxsLmRhdGFzZXQuY29sdW1uKTtcbiAgICBjb25zdCBjb29yZGluYXRlc0FycmF5ID0gW1t0YXJnZXRDZWxsUm93LCB0YXJnZXRDZWxsQ29sdW1uXV07XG4gICAgdGFyZ2V0Q2VsbC5jbGFzc0xpc3QuYWRkKFwiY29udGFpbnMtc2hpcC1pbWFnZVwiKTtcbiAgICB0YXJnZXRDZWxsLmNsYXNzTGlzdC5hZGQoXCJzaGlwLWltYWdlXCIpO1xuICAgIHRhcmdldENlbGwuY2xhc3NMaXN0LmFkZChgc2hpcC1pbWFnZS0ke2xlbmd0aH1gKTtcbiAgICB0YXJnZXRDZWxsLmNsYXNzTGlzdC5hZGQoYHNoaXAtaW1hZ2UtJHtsZW5ndGh9LTFgKTtcbiAgICBpZiAoZGF0YU9iamVjdC5ob3Jpem9udGFsKSB7XG4gICAgICB0YXJnZXRDZWxsLmNsYXNzTGlzdC5hZGQoXCJob3Jpem9udGFsXCIpO1xuICAgIH0gZWxzZSBpZiAoZGF0YU9iamVjdC52ZXJ0aWNhbCkge1xuICAgICAgdGFyZ2V0Q2VsbC5jbGFzc0xpc3QuYWRkKFwidmVydGljYWxcIik7XG4gICAgfVxuICAgIGZvciAobGV0IGkgPSAxOyBpIDwgbGVuZ3RoOyBpKyspIHtcbiAgICAgIGxldCByZW1haW5pbmdDZWxsO1xuICAgICAgaWYgKGRhdGFPYmplY3QuaG9yaXpvbnRhbCkge1xuICAgICAgICByZW1haW5pbmdDZWxsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcbiAgICAgICAgICBgLnBsYXllci1ib2FyZCBbZGF0YS1yb3c9JyR7dGFyZ2V0Q2VsbFJvd30nXVtkYXRhLWNvbHVtbj0nJHtcbiAgICAgICAgICAgIHRhcmdldENlbGxDb2x1bW4gKyBpXG4gICAgICAgICAgfSddYFxuICAgICAgICApO1xuICAgICAgICByZW1haW5pbmdDZWxsLmNsYXNzTGlzdC5hZGQoXCJob3Jpem9udGFsXCIpO1xuICAgICAgICBjb29yZGluYXRlc0FycmF5LnB1c2goW3RhcmdldENlbGxSb3csIHRhcmdldENlbGxDb2x1bW4gKyBpXSk7XG4gICAgICB9IGVsc2UgaWYgKGRhdGFPYmplY3QudmVydGljYWwpIHtcbiAgICAgICAgcmVtYWluaW5nQ2VsbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXG4gICAgICAgICAgYC5wbGF5ZXItYm9hcmQgW2RhdGEtcm93PScke1xuICAgICAgICAgICAgdGFyZ2V0Q2VsbFJvdyArIGlcbiAgICAgICAgICB9J11bZGF0YS1jb2x1bW49JyR7dGFyZ2V0Q2VsbENvbHVtbn0nXWBcbiAgICAgICAgKTtcbiAgICAgICAgcmVtYWluaW5nQ2VsbC5jbGFzc0xpc3QuYWRkKFwidmVydGljYWxcIik7XG4gICAgICAgIGNvb3JkaW5hdGVzQXJyYXkucHVzaChbdGFyZ2V0Q2VsbFJvdyArIGksIHRhcmdldENlbGxDb2x1bW5dKTtcbiAgICAgIH1cbiAgICAgIHJlbWFpbmluZ0NlbGwuY2xhc3NMaXN0LmFkZChcImNvbnRhaW5zLXNoaXAtaW1hZ2VcIik7XG4gICAgICByZW1haW5pbmdDZWxsLmNsYXNzTGlzdC5hZGQoXCJzaGlwLWltYWdlXCIpO1xuICAgICAgcmVtYWluaW5nQ2VsbC5jbGFzc0xpc3QuYWRkKGBzaGlwLWltYWdlLSR7bGVuZ3RofWApO1xuICAgICAgcmVtYWluaW5nQ2VsbC5jbGFzc0xpc3QuYWRkKGBzaGlwLWltYWdlLSR7bGVuZ3RofS0ke2kgKyAxfWApO1xuICAgIH1cbiAgICByZXR1cm4gY29vcmRpbmF0ZXNBcnJheTtcbiAgfTtcbiAgY29uc3QgZGlzYWJsZUltYWdlQnV0dG9uSW50ZXJhY3Rpb25zID0gKGRhdGFPYmplY3QpID0+IHtcbiAgICBjb25zdCBJRCA9IGRhdGFPYmplY3QuZWxlbWVudElEO1xuICAgIGNvbnN0IGltYWdlRWxlbWVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYCMke0lEfWApO1xuICAgIGNvbnN0IGJ1dHRvbkVsZW1lbnQgPSBpbWFnZUVsZW1lbnQucGFyZW50Tm9kZS5xdWVyeVNlbGVjdG9yKFwiYnV0dG9uXCIpO1xuICAgIGltYWdlRWxlbWVudC5zZXRBdHRyaWJ1dGUoXCJkcmFnZ2FibGVcIiwgZmFsc2UpO1xuICAgIGltYWdlRWxlbWVudC5jbGFzc0xpc3QuYWRkKFwiZGlzYWJsZWQtaW1hZ2VcIik7XG4gICAgYnV0dG9uRWxlbWVudC5kaXNhYmxlZCA9IHRydWU7XG4gIH07XG4gIGNvbnN0IGluc2VydERyYWdnZWRJbWFnZSA9IChldmVudCkgPT4ge1xuICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgY29uc3QgdGFyZ2V0Q2VsbCA9IGV2ZW50LnRhcmdldDtcbiAgICBpZiAoQXJyYXkuZnJvbSh0YXJnZXRDZWxsLmNsYXNzTGlzdCkuaW5jbHVkZXMoXCJjb250YWlucy1zaGlwLWltYWdlXCIpKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGNvbnN0IGRhdGFTdHJpbmcgPSBldmVudC5kYXRhVHJhbnNmZXIuZ2V0RGF0YShcImltYWdlXCIpO1xuICAgIGNvbnN0IGRhdGFPYmplY3QgPSBKU09OLnBhcnNlKGRhdGFTdHJpbmcpO1xuICAgIGlmICghaXNWYWxpZEdhbWVib2FyZENlbGwodGFyZ2V0Q2VsbCwgZGF0YU9iamVjdCkpIHtcbiAgICAgIC8vIHByb2JhYmx5IG1ha2Ugc29tZSBET00gZXJyb3IgbWVzc2FnZSBhcHBlYXJcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgY29uc3Qgc2hpcENvb3JkaW5hdGVzID0gYWRkU2hpcFRvRE9NKHRhcmdldENlbGwsIGRhdGFPYmplY3QpO1xuICAgIEdhbWVMb29wLmdldFBsYXllcnMoKVswXS5hZGRTaGlwVG9HYW1lYm9hcmQoXG4gICAgICBOdW1iZXIoZGF0YU9iamVjdC5zaGlwTGVuZ3RoKSxcbiAgICAgIHNoaXBDb29yZGluYXRlc1xuICAgICk7XG4gICAgZGlzYWJsZUltYWdlQnV0dG9uSW50ZXJhY3Rpb25zKGRhdGFPYmplY3QpO1xuICAgIHRhcmdldENlbGwucmVtb3ZlRXZlbnRMaXN0ZW5lcihcImRyb3BcIiwgaW5zZXJ0RHJhZ2dlZEltYWdlKTtcbiAgfTtcbiAgY29uc3Qgcm90YXRlU2hpcEltYWdlID0gKGltYWdlKSA9PiB7XG4gICAgY29uc3QgaW1hZ2VDbGFzc2VzID0gQXJyYXkuZnJvbShpbWFnZS5jbGFzc0xpc3QpO1xuICAgIGlmIChpbWFnZUNsYXNzZXMuaW5jbHVkZXMoXCJob3Jpem9udGFsXCIpKSB7XG4gICAgICBpbWFnZS5jbGFzc0xpc3QucmVtb3ZlKFwiaG9yaXpvbnRhbFwiKTtcbiAgICAgIGltYWdlLmNsYXNzTGlzdC5hZGQoXCJ2ZXJ0aWNhbFwiKTtcbiAgICB9IGVsc2UgaWYgKGltYWdlQ2xhc3Nlcy5pbmNsdWRlcyhcInZlcnRpY2FsXCIpKSB7XG4gICAgICBpbWFnZS5jbGFzc0xpc3QucmVtb3ZlKFwidmVydGljYWxcIik7XG4gICAgICBpbWFnZS5jbGFzc0xpc3QuYWRkKFwiaG9yaXpvbnRhbFwiKTtcbiAgICB9XG4gIH07XG4gIGNvbnN0IHJvdGF0ZVBlckxlbmd0aCA9ICh0ZW1wRGl2LCBjbG9uZWRJbWFnZUVsZW1lbnQpID0+IHtcbiAgICBjb25zdCBjbG9uZWRJbWFnZUVsZW1lbnRDbGFzc2VzID0gQXJyYXkuZnJvbShjbG9uZWRJbWFnZUVsZW1lbnQuY2xhc3NMaXN0KTtcbiAgICBpZiAoY2xvbmVkSW1hZ2VFbGVtZW50Q2xhc3Nlcy5pbmNsdWRlcyhcImhvcml6b250YWxcIikpIHtcbiAgICAgIHRlbXBEaXYuY2xhc3NMaXN0LmFkZChcInRlbXAtcm90YXRlLWhvcml6b250YWxcIik7XG4gICAgfSBlbHNlIGlmIChjbG9uZWRJbWFnZUVsZW1lbnRDbGFzc2VzLmluY2x1ZGVzKFwidmVydGljYWxcIikpIHtcbiAgICAgIHRlbXBEaXYuY2xhc3NMaXN0LmFkZChcInRlbXAtcm90YXRlLXZlcnRpY2FsXCIpO1xuICAgICAgaWYgKGNsb25lZEltYWdlRWxlbWVudC5kYXRhc2V0LnNoaXBMZW5ndGggPT09IFwiNVwiKSB7XG4gICAgICAgIHRlbXBEaXYuY2xhc3NMaXN0LmFkZChcInRlbXAtcm90YXRlLXZlcnRpY2FsLTVcIik7XG4gICAgICB9IGVsc2UgaWYgKGNsb25lZEltYWdlRWxlbWVudC5kYXRhc2V0LnNoaXBMZW5ndGggPT09IFwiNFwiKSB7XG4gICAgICAgIHRlbXBEaXYuY2xhc3NMaXN0LmFkZChcInRlbXAtcm90YXRlLXZlcnRpY2FsLTRcIik7XG4gICAgICB9IGVsc2UgaWYgKGNsb25lZEltYWdlRWxlbWVudC5kYXRhc2V0LnNoaXBMZW5ndGggPT09IFwiM1wiKSB7XG4gICAgICAgIHRlbXBEaXYuY2xhc3NMaXN0LmFkZChcInRlbXAtcm90YXRlLXZlcnRpY2FsLTNcIik7XG4gICAgICB9IGVsc2UgaWYgKGNsb25lZEltYWdlRWxlbWVudC5kYXRhc2V0LnNoaXBMZW5ndGggPT09IFwiMlwiKSB7XG4gICAgICAgIHRlbXBEaXYuY2xhc3NMaXN0LmFkZChcInRlbXAtcm90YXRlLXZlcnRpY2FsLTJcIik7XG4gICAgICB9XG4gICAgfVxuICB9O1xuICBjb25zdCByb3RhdGVEcmFnZ2VkSW1hZ2UgPSAoZXZlbnQpID0+IHtcbiAgICBjb25zdCBpbWFnZUVsZW1lbnQgPSBldmVudC50YXJnZXQ7XG4gICAgY29uc3QgY2xvbmVkSW1hZ2VFbGVtZW50ID0gaW1hZ2VFbGVtZW50LmNsb25lTm9kZSgpO1xuICAgIGNvbnN0IHRlbXBEaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuICAgIHRlbXBEaXYuY2xhc3NMaXN0LmFkZChcInRlbXAtcm90YXRlXCIpO1xuICAgIHJvdGF0ZVBlckxlbmd0aCh0ZW1wRGl2LCBjbG9uZWRJbWFnZUVsZW1lbnQpO1xuICAgIHRlbXBEaXYuYXBwZW5kQ2hpbGQoY2xvbmVkSW1hZ2VFbGVtZW50KTtcbiAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKHRlbXBEaXYpO1xuICAgIGV2ZW50LmRhdGFUcmFuc2Zlci5zZXREcmFnSW1hZ2UodGVtcERpdiwgMCwgMCk7XG4gICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICBkb2N1bWVudC5ib2R5LnJlbW92ZUNoaWxkKHRlbXBEaXYpO1xuICAgIH0sIDApO1xuICB9O1xuICByZXR1cm4ge1xuICAgIGluaXRpYWxpemVCb2FyZERPTSxcbiAgICBpbnNlcnREcmFnZ2VkSW1hZ2UsXG4gICAgcm90YXRlU2hpcEltYWdlLFxuICAgIHJvdGF0ZURyYWdnZWRJbWFnZSxcbiAgICBnZXREcmFnZ2VkSW1hZ2UsXG4gICAgZHJhZ092ZXIsXG4gIH07XG59KSgpO1xuXG5leHBvcnQgeyBET01Db250cm9sbGVyIH07XG4iLCJpbXBvcnQgeyBET01Db250cm9sbGVyIH0gZnJvbSBcIi4vRE9NX2NvbnRyb2xsZXJcIjtcblxuY29uc3QgRXZlbnRMaXN0ZW5lckNvbnRyb2xsZXIgPSAoKCkgPT4ge1xuICBjb25zdCByb3RhdGVTaGlwSW1hZ2VMaXN0ZW5lcnMgPSAoKSA9PiB7XG4gICAgY29uc3Qgc2hpcFBsYWNlbWVudEVsZW1lbnRzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChcIi5zaGlwLXBsYWNlbWVudFwiKTtcbiAgICBzaGlwUGxhY2VtZW50RWxlbWVudHMuZm9yRWFjaCgoZ3JvdXApID0+IHtcbiAgICAgIGNvbnN0IGltZyA9IGdyb3VwLmNoaWxkcmVuWzBdO1xuICAgICAgY29uc3QgYnRuID0gZ3JvdXAuY2hpbGRyZW5bMl07XG4gICAgICBidG4uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcbiAgICAgICAgRE9NQ29udHJvbGxlci5yb3RhdGVTaGlwSW1hZ2UoaW1nKTtcbiAgICAgIH0pO1xuICAgIH0pO1xuICB9O1xuICBjb25zdCBhZGRTaGlwUGxhY2VtZW50RHJhZyA9ICgpID0+IHtcbiAgICBjb25zdCBzaGlwSW1hZ2VzID0gQXJyYXkuZnJvbShkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKFwiLnNoaXAtcGllY2VcIikpO1xuICAgIHNoaXBJbWFnZXMuZm9yRWFjaCgoc2hpcCkgPT4ge1xuICAgICAgc2hpcC5hZGRFdmVudExpc3RlbmVyKFwiZHJhZ3N0YXJ0XCIsIChldmVudCkgPT4ge1xuICAgICAgICBET01Db250cm9sbGVyLmdldERyYWdnZWRJbWFnZShldmVudCk7XG4gICAgICAgIERPTUNvbnRyb2xsZXIucm90YXRlRHJhZ2dlZEltYWdlKGV2ZW50KTtcbiAgICAgIH0pO1xuICAgIH0pO1xuICB9O1xuICByZXR1cm4ge1xuICAgIHJvdGF0ZVNoaXBJbWFnZUxpc3RlbmVycyxcbiAgICBhZGRTaGlwUGxhY2VtZW50RHJhZyxcbiAgfTtcbn0pKCk7XG5cbmV4cG9ydCB7IEV2ZW50TGlzdGVuZXJDb250cm9sbGVyIH07XG4iLCJpbXBvcnQgeyBHYW1lTG9vcCB9IGZyb20gXCIuL2dhbWVsb29wXCI7XG5pbXBvcnQgeyBET01Db250cm9sbGVyIH0gZnJvbSBcIi4vRE9NX2NvbnRyb2xsZXJcIjtcbmltcG9ydCB7IEV2ZW50TGlzdGVuZXJDb250cm9sbGVyIH0gZnJvbSBcIi4vZXZlbnRfbGlzdGVuZXJfY29udHJvbGxlclwiO1xuXG5HYW1lTG9vcC5jcmVhdGVHYW1lKCk7XG5cbkRPTUNvbnRyb2xsZXIuaW5pdGlhbGl6ZUJvYXJkRE9NKCk7XG5cbkV2ZW50TGlzdGVuZXJDb250cm9sbGVyLnJvdGF0ZVNoaXBJbWFnZUxpc3RlbmVycygpO1xuXG5FdmVudExpc3RlbmVyQ29udHJvbGxlci5hZGRTaGlwUGxhY2VtZW50RHJhZygpO1xuIl0sIm5hbWVzIjpbIlBsYXllciIsInBsYXllclR5cGUiLCJjb21wdXRlclBsYXllciIsInBsYXllckdhbWVib2FyZCIsImJvYXJkIiwiaSIsInB1c2giLCJqIiwidW5kZWZpbmVkIiwiY3JlYXRlQm9hcmQiLCJwbGFjZWRTaGlwcyIsInJlY2VpdmVkTWlzc2VkU2hvdHMiLCJyZWNlaXZlZEhpdFNob3RzIiwic2VudE1pc3NlZFNob3RzIiwic2VudEhpdFNob3RzIiwiYWxsU2hpcHNTdW5rIiwiZ2V0Q29vcmRpbmF0ZXMiLCJjb29yZGluYXRlcyIsImdldFBsYWNlZFNoaXBzIiwiZ2V0UmVjZWl2ZWRNaXNzZWRTaG90cyIsImdldFJlY2VpdmVkSGl0U2hvdHMiLCJnZXRTZW50TWlzc2VkU2hvdHMiLCJnZXRTZW50SGl0U2hvdHMiLCJpc0FsbFNoaXBzU3VuayIsInBsYWNlU2hpcCIsInNoaXAiLCJjb29yZGluYXRlc0xpc3QiLCJyZWNlaXZlQXR0YWNrIiwiZW50aXR5QXRDb29yZGluYXRlcyIsImhpdCIsImV2ZXJ5IiwiaXNTdW5rIiwiYWRkU2VudE1pc3NlZFNob3QiLCJhZGRTZW50SGl0U2hvdCIsIkdhbWVib2FyZCIsIm9wcG9zaW5nUGxheWVyIiwiYWRkU2hpcFRvR2FtZWJvYXJkIiwic2hpcExlbmd0aCIsImdpdmVuTGVuZ3RoIiwibGVuZ3RoIiwiaGl0cyIsInN1bmsiLCJnZXRTaGlwTGVuZ3RoIiwiZ2V0U2hpcEhpdHMiLCJTaGlwIiwic2VuZEF0dGFjayIsIm9wcG9zaW5nUGxheWVyR2FtZWJvYXJkIiwiZ2V0R2FtZWJvYXJkIiwiYXR0YWNrUmVzdWx0cyIsIkdhbWVMb29wIiwiZW5kR2FtZSIsImlzQ29tcHV0ZXIiLCJzZW5kQ29tcHV0ZXJBdHRhY2siLCJnZW5lcmF0ZUNvbXB1dGVyU2hpcENvb3JkaW5hdGVzIiwibGlzdE9mQ29vcmRpbmF0ZXMiLCJzdGFydGluZ0Nvb3JkaW5hdGVzIiwiZ2VuZXJhdGVTdGFydGluZ0Nvb3JkaW5hdGVzIiwibm9uU3RhcnRpbmdDb29yZGluYXRlcyIsImdlbmVyYXRlTm9uU3RhcnRpbmdDb29yZGluYXRlcyIsImNvbmNhdCIsImdlbmVyYXRlUmFuZG9tQ29vcmRpbmF0ZSIsInBvc3NpYmxlQ29vcmRpbmF0ZXMiLCJjaGVja0lmVmFsaWRFbXB0eUNvb3JkaW5hdGVzIiwidXBDb29yZGluYXRlcyIsInJpZ2h0Q29vcmRpbmF0ZXMiLCJkb3duQ29vcmRpbmF0ZXMiLCJsZWZ0Q29vcmRpbmF0ZXMiLCJNYXRoIiwiZmxvb3IiLCJyYW5kb20iLCJjaGVja0lmUHJldmlvdXNseUF0dGFja2VkIiwib3Bwb3NpbmdQbGF5ZXJSZWNlaXZlZFNob3RzIiwiYXR0YWNrQ29vcmRpbmF0ZXMiLCJzb21lIiwicmVjZWl2ZWRTaG90IiwiZGlyZWN0aW9uIiwiZ2V0T3Bwb3NpbmdQbGF5ZXIiLCJzZXRPcHBvc2luZ1BsYXllciIsInBsYXllciIsImluaXRpYWxpemVDb21wdXRlckdhbWVib2FyZCIsImxlbmd0aHNPZlNoaXBzIiwic2hpcENvb3JkaW5hdGVzIiwiZ2VuZXJhdGVBdHRhY2tDb29yZGluYXRlcyIsInBsYXllcnMiLCJ3aW5uZXIiLCJpblByb2dyZXNzIiwiZ2V0UGxheWVycyIsImlzSW5Qcm9ncmVzcyIsImdldFdpbm5lciIsImNyZWF0ZUdhbWUiLCJodW1hblBsYXllciIsImxvc2VyUGxheWVyIiwid2lubmVyUGxheWVyIiwic2V0V2lubmVyIiwicmVzZXRHYW1lIiwiRE9NQ29udHJvbGxlciIsImNyZWF0ZUJvYXJkQ2VsbHMiLCJnYW1lYm9hcmRET00iLCJjb2x1bW5MYWJlbHMiLCJyb3dMYWJlbHMiLCJpbnZpc2libGVQbGFjZWhvbGRlckVsZW1lbnQiLCJkb2N1bWVudCIsImNyZWF0ZUVsZW1lbnQiLCJjbGFzc0xpc3QiLCJhZGQiLCJzdHlsZSIsInZpc2liaWxpdHkiLCJhcHBlbmRDaGlsZCIsImNvbHVtbkxhYmVsRWxlbWVudCIsInRleHRDb250ZW50Iiwicm93TGFiZWxFbGVtZW50IiwiQXJyYXkiLCJmcm9tIiwiaW5jbHVkZXMiLCJjZWxsRWxlbWVudCIsInNldEF0dHJpYnV0ZSIsImFkZEV2ZW50TGlzdGVuZXIiLCJldmVudCIsImRyYWdPdmVyIiwiaW5zZXJ0RHJhZ2dlZEltYWdlIiwicHJldmVudERlZmF1bHQiLCJ0YXJnZXRDZWxsIiwidGFyZ2V0IiwiZGF0YVN0cmluZyIsImRhdGFUcmFuc2ZlciIsImdldERhdGEiLCJkYXRhT2JqZWN0IiwiSlNPTiIsInBhcnNlIiwiY2VsbENvb3JkaW5hdGVzIiwiTnVtYmVyIiwiZGF0YXNldCIsInJvdyIsImNvbHVtbiIsImhvcml6b250YWwiLCJjb25zb2xlIiwibG9nIiwidmVydGljYWwiLCJpc1ZhbGlkR2FtZWJvYXJkQ2VsbCIsInRhcmdldENlbGxSb3ciLCJ0YXJnZXRDZWxsQ29sdW1uIiwiY29vcmRpbmF0ZXNBcnJheSIsInJlbWFpbmluZ0NlbGwiLCJxdWVyeVNlbGVjdG9yIiwiYWRkU2hpcFRvRE9NIiwiSUQiLCJlbGVtZW50SUQiLCJpbWFnZUVsZW1lbnQiLCJidXR0b25FbGVtZW50IiwicGFyZW50Tm9kZSIsImRpc2FibGVkIiwiZGlzYWJsZUltYWdlQnV0dG9uSW50ZXJhY3Rpb25zIiwicmVtb3ZlRXZlbnRMaXN0ZW5lciIsImluaXRpYWxpemVCb2FyZERPTSIsImh1bWFuUGxheWVyR2FtZWJvYXJkRE9NIiwib3Bwb25lbnRHYW1lYm9hcmRET00iLCJyb3RhdGVTaGlwSW1hZ2UiLCJpbWFnZSIsImltYWdlQ2xhc3NlcyIsInJlbW92ZSIsInJvdGF0ZURyYWdnZWRJbWFnZSIsImNsb25lZEltYWdlRWxlbWVudCIsImNsb25lTm9kZSIsInRlbXBEaXYiLCJjbG9uZWRJbWFnZUVsZW1lbnRDbGFzc2VzIiwicm90YXRlUGVyTGVuZ3RoIiwiYm9keSIsInNldERyYWdJbWFnZSIsInNldFRpbWVvdXQiLCJyZW1vdmVDaGlsZCIsImdldERyYWdnZWRJbWFnZSIsInNyYyIsImdldEF0dHJpYnV0ZSIsInN0cmluZ2lmeSIsInNldERhdGEiLCJFdmVudExpc3RlbmVyQ29udHJvbGxlciIsInF1ZXJ5U2VsZWN0b3JBbGwiLCJmb3JFYWNoIiwiZ3JvdXAiLCJpbWciLCJjaGlsZHJlbiJdLCJzb3VyY2VSb290IjoiIn0=