(()=>{"use strict";const e=(()=>{const e=e=>{const i=["A","B","C","D","E","F","G","H","I","J"],o=["1","2","3","4","5","6","7","8","9","10"],d=a.getPlayers()[0];for(let n=-1;n<10;n++)for(let l=-1;l<10;l++)if(-1===n)if(-1===l){const t=document.createElement("div");t.classList.add("gameboard-label"),t.style.visibility="hidden",e.appendChild(t)}else{const t=document.createElement("div");t.classList.add("column-label"),t.textContent=i[l],e.appendChild(t)}else if(-1===l){const t=document.createElement("div");t.classList.add("row-label"),t.textContent=o[n],e.appendChild(t)}else if(Array.from(e.classList).includes("player-board")){const a=document.createElement("div");a.setAttribute("data-row",n),a.setAttribute("data-column",l),a.classList.add("gameboard-cell"),a.addEventListener("dragover",(e=>{r(e)})),a.addEventListener("drop",(e=>{s(e),5===d.getGameboard().getPlacedShips().length&&t("enable")})),e.appendChild(a)}else if(Array.from(e.classList).includes("computer-board")){const t=document.createElement("button");t.setAttribute("data-row",n),t.setAttribute("data-column",l),t.classList.add("gameboard-cell"),t.disabled=!0,t.addEventListener("click",(()=>{if(!a.isMidAttack()){const e=Number(t.dataset.row),a=Number(t.dataset.column);d.sendAttack([e,a])}})),e.appendChild(t)}},t=e=>{const t=document.querySelector(".computer-board"),a=Array.from(t.querySelectorAll(".gameboard-cell"));"enable"===e?a.forEach((e=>{e.disabled=!1})):"disable"===e&&a.forEach((e=>{e.disabled=!0}))},r=e=>{e.preventDefault()},s=e=>{e.preventDefault();const t=a.getPlayers()[0],r=e.target;if(Array.from(r.classList).includes("contains-ship-image"))return;const i=e.dataTransfer.getData("image"),o=JSON.parse(i);if(!((e,t)=>{const r=[Number(e.dataset.row),Number(e.dataset.column)],s=Number(t.shipLength);return t.horizontal?!!a.getPlayers()[0].checkIfValidEmptyCoordinates(r,s,"right"):t.vertical?!!a.getPlayers()[0].checkIfValidEmptyCoordinates(r,s,"down"):void 0})(r,o))return;const d=((e,t)=>{const a=t.shipLength,r=Number(e.dataset.row),s=Number(e.dataset.column),i=[[r,s]];e.classList.add("contains-ship-image"),e.classList.add("ship-image"),e.classList.add(`ship-image-${a}`),e.classList.add(`ship-image-${a}-1`),t.horizontal?e.classList.add("horizontal"):t.vertical&&e.classList.add("vertical");for(let e=1;e<a;e++){let o;t.horizontal?(o=document.querySelector(`.player-board [data-row='${r}'][data-column='${s+e}']`),o.classList.add("horizontal"),i.push([r,s+e])):t.vertical&&(o=document.querySelector(`.player-board [data-row='${r+e}'][data-column='${s}']`),o.classList.add("vertical"),i.push([r+e,s])),o.classList.add("contains-ship-image"),o.classList.add("ship-image"),o.classList.add(`ship-image-${a}`),o.classList.add(`ship-image-${a}-${e+1}`)}return i})(r,o);t.addShipToGameboard(Number(o.shipLength),d),(e=>{const t=e.elementID,a=document.querySelector(`#${t}`),r=a.parentNode.querySelector("button");a.setAttribute("draggable",!1),a.classList.add("disabled-image"),r.disabled=!0})(o),r.removeEventListener("drop",s)};return{initializeBoardDOM:()=>{const t=document.querySelector(".player-board"),a=document.querySelector(".computer-board");e(t),e(a)},insertDraggedImage:s,rotateShipImage:e=>{const t=Array.from(e.classList);t.includes("horizontal")?(e.classList.remove("horizontal"),e.classList.add("vertical")):t.includes("vertical")&&(e.classList.remove("vertical"),e.classList.add("horizontal"))},rotateDraggedImage:e=>{const t=e.target.cloneNode(),a=document.createElement("div");a.classList.add("temp-rotate"),((e,t)=>{const a=Array.from(t.classList);a.includes("horizontal")?e.classList.add("temp-rotate-horizontal"):a.includes("vertical")&&(e.classList.add("temp-rotate-vertical"),"5"===t.dataset.shipLength?e.classList.add("temp-rotate-vertical-5"):"4"===t.dataset.shipLength?e.classList.add("temp-rotate-vertical-4"):"3"===t.dataset.shipLength?e.classList.add("temp-rotate-vertical-3"):"2"===t.dataset.shipLength&&e.classList.add("temp-rotate-vertical-2"))})(a,t),a.appendChild(t),document.body.appendChild(a),e.dataTransfer.setDragImage(a,0,0),setTimeout((()=>{document.body.removeChild(a)}),0)},getDraggedImage:e=>{const t={image:e.target.src,shipLength:e.target.dataset.shipLength,horizontal:!1,vertical:!1,elementID:e.target.getAttribute("id")};Array.from(e.target.classList).includes("horizontal")?t.horizontal=!0:Array.from(e.target.classList).includes("vertical")&&(t.vertical=!0);const a=JSON.stringify(t);e.dataTransfer.setData("image",a)},dragOver:r,addAttackResultDOM:(e,t,a)=>{const r=a[0],s=a[1],i=document.querySelector(`.${e}-board`).querySelector(`[data-row='${r}'][data-column='${s}']`),o=document.createElement("img");o.classList.add("attack-results"),i.appendChild(o),"hit"===t?o.setAttribute("src","../dist/red_X.png"):o.setAttribute("src","../dist/white_O.png"),i.disabled=!0},toggleAbilityToAttack:t,displayWinner:e=>{const t=e.isComputer();document.querySelector(".game-results").classList.remove("default-hidden");document.querySelector(".display-winner").textContent=t?"Oh no, you lost! Try again!":"Congratulations, you won!"},resetDOM:()=>{document.querySelector(".player-board").innerHTML="",document.querySelector(".computer-board").innerHTML="",Array.from(document.querySelectorAll(".ship-piece")).forEach((e=>{e.setAttribute("draggable",!0),e.classList.remove("disabled-image"),Array.from(e.classList).includes("vertical")&&(e.classList.remove("vertical"),e.classList.add("horizontal"))})),Array.from(document.querySelectorAll(".rotate-ship")).forEach((e=>{e.disabled=!1})),(()=>{const e=document.querySelector(".game-results");e.classList.add("default-hidden"),e.querySelector(".display-winner").textContent="Placeholder"})()}}})(),t=t=>{const r="human"!==t&&("computer"===t||void 0),s=(()=>{const e=(()=>{const e=[];for(let t=0;t<10;t++){e.push([]);for(let a=0;a<10;a++)e[t].push(void 0)}return e})(),t=[],a=[],r=[],s=[],i=[];let o=!1;const d=t=>e[t[0]][t[1]];return{getCoordinates:d,getPlacedShips:()=>t,getReceivedMissedShots:()=>a,getReceivedHitShots:()=>r,getSentMissedShots:()=>s,getSentHitShots:()=>i,isAllShipsSunk:()=>o,placeShip:(a,r)=>{for(const t of r)e[t[0]][t[1]]=a;t.push(a)},receiveAttack:e=>{const s=d(e);return void 0!==s?(s.hit(),t.every((e=>e.isSunk()))&&(o=!0),r.push(e),"hit"):(a.push(e),"miss")},addSentMissedShot:e=>{s.push(e)},addSentHitShot:e=>{i.push(e)}}})();let i;const o=()=>r,d=(e,t)=>{const a=(e=>{const t=e;let a=0,r=!1;return{getShipLength:()=>t,getShipHits:()=>a,isSunk:()=>r,hit:()=>{if(r)return"That ship has already been sunk!";a+=1,a===t&&(r=!0)}}})(e);s.placeShip(a,t)},n=t=>{if(h(t)||!a.isInProgress()||a.isMidAttack())return;const r=i.getGameboard(),d=i.receiveAttack(t);if("hit"===d){if(s.addSentHitShot(t),o()?o()&&e.addAttackResultDOM("player",d,t):e.addAttackResultDOM("computer",d,t),r.isAllShipsSunk())return void a.endGame(i)}else"miss"===d&&(s.addSentMissedShot(t),o()?o()&&e.addAttackResultDOM("player",d,t):e.addAttackResultDOM("computer",d,t));i.isComputer()&&(a.toggleMidAttack(!0),setTimeout((()=>{a.toggleMidAttack(!1),i.sendComputerAttack()}),0))},l=e=>{let t=[];do{t=[];const a=c(),r=u(a,e);t.push(a),t=t.concat(r)}while(t.length<e);return t},c=()=>{const e=[void 0,void 0];do{e[0]=m(),e[1]=m()}while(void 0!==s.getCoordinates(e));return e},u=(e,t)=>{const a=[];if(p(e,t,"up")){const r=[];for(let a=1;a<t;a++)r.push([e[0]-a,e[1]]);a.push(r)}if(p(e,t,"right")){const r=[];for(let a=1;a<t;a++)r.push([e[0],e[1]+a]);a.push(r)}if(p(e,t,"down")){const r=[];for(let a=1;a<t;a++)r.push([e[0]+a,e[1]]);a.push(r)}if(p(e,t,"left")){const r=[];for(let a=1;a<t;a++)r.push([e[0],e[1]-a]);a.push(r)}return 0===a.length?a:a[Math.floor(Math.random()*a.length)]},m=()=>Math.floor(10*Math.random()),h=e=>{let t=!1;const a=i.getGameboard().getReceivedMissedShots(),r=i.getGameboard().getReceivedHitShots();return t=a.some((t=>t[0]===e[0]&&t[1]===e[1])),t||(t=r.some((t=>t[0]===e[0]&&t[1]===e[1]))),t},p=(e,t,a)=>{switch(a){case"up":if(e[0]-(t-1)<0)return!1;for(let a=1;a<t;a++)if(void 0!==s.getCoordinates([e[0]-a,e[1]]))return!1;return!0;case"right":if(e[1]+(t-1)>9)return!1;for(let a=1;a<t;a++)if(void 0!==s.getCoordinates([e[0],e[1]+a]))return!1;return!0;case"down":if(e[0]+(t-1)>9)return!1;for(let a=1;a<t;a++)if(void 0!==s.getCoordinates([e[0]+a,e[1]]))return!1;return!0;case"left":if(e[1]-(t-1)<0)return!1;for(let a=1;a<t;a++)if(void 0!==s.getCoordinates([e[0],e[1]-a]))return!1;return!0}};return{isComputer:o,getGameboard:()=>s,getOpposingPlayer:()=>i,setOpposingPlayer:e=>{i=e},addShipToGameboard:d,sendAttack:n,initializeComputerGameboard:()=>{if(!r)return;const e=[5,4,3,3,2];for(const t of e){const e=l(t);d(t,e)}},sendComputerAttack:()=>{if(!r||!a.isInProgress())return;const e=(()=>{const e=[void 0,void 0];do{e[0]=m(),e[1]=m()}while(h(e));return e})();n(e)},receiveAttack:e=>s.receiveAttack(e),checkIfValidEmptyCoordinates:p}},a=(()=>{const a=[];let r,s=!0,i=!1;const o=()=>{const e=t("human");a.push(e);const r=t("computer");a.push(r),e.setOpposingPlayer(r),r.setOpposingPlayer(e),r.initializeComputerGameboard()};return{getPlayers:()=>a,isInProgress:()=>s,getWinner:()=>r,isMidAttack:()=>i,toggleMidAttack:e=>{i=!!e},createGame:o,endGame:t=>{const a=t.getOpposingPlayer();s=!1,r=a,e.toggleAbilityToAttack("disable"),e.displayWinner(r)},resetGame:()=>{a.length=0,s=!0,r=void 0,e.resetDOM(),o(),e.initializeBoardDOM()}}})(),r=()=>{document.querySelectorAll(".ship-placement").forEach((t=>{const a=t.querySelector("img");t.querySelector("button").addEventListener("click",(()=>{e.rotateShipImage(a)}))}))},s=()=>{Array.from(document.querySelectorAll(".ship-piece")).forEach((t=>{t.addEventListener("dragstart",(t=>{e.getDraggedImage(t),e.rotateDraggedImage(t)}))}))},i=()=>{document.querySelector(".play-again").addEventListener("click",(()=>{a.resetGame()}))};a.createGame(),e.initializeBoardDOM(),r(),s(),i()})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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eUgsRUFBZ0J2SixjQUFjLE9BQzdCdUosRUFBZ0J2SixjQUFjLFVBQ3RDcEIsaUJBQWlCLFNBQVMsS0FDdEMxQixFQUFjb0YsZ0JBQWdCUixFQUFhLEdBQzNDLEdBQ0YsRUFUQXdILEVBV3lCLEtBQ1IvSyxNQUFNQyxLQUFLWCxTQUFTcUMsaUJBQWlCLGdCQUM3Q0MsU0FBU3NGLElBQ2xCQSxFQUFLN0csaUJBQWlCLGFBQWNDLElBQ2xDM0IsRUFBY2tHLGdCQUFnQnZFLEdBQzlCM0IsRUFBY3dGLG1CQUFtQjdELEVBQU0sR0FDdkMsR0FDRixFQWxCQXlLLEVBb0J5QixLQUNIekwsU0FBU21DLGNBQWMsZUFDL0JwQixpQkFBaUIsU0FBUyxLQUN4Q3BCLEVBQVM2TCxXQUFXLEdBQ3BCLEVDdkJON0wsRUFBU3VMLGFBRVQ3TCxFQUFjaUYscUJBRWRtSCxJQUVBQSxJQUVBQSxHIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vb2Rpbi1iYXR0bGVzaGlwLy4vc3JjL3NoaXAuanMiLCJ3ZWJwYWNrOi8vb2Rpbi1iYXR0bGVzaGlwLy4vc3JjL0RPTV9jb250cm9sbGVyLmpzIiwid2VicGFjazovL29kaW4tYmF0dGxlc2hpcC8uL3NyYy9wbGF5ZXIuanMiLCJ3ZWJwYWNrOi8vb2Rpbi1iYXR0bGVzaGlwLy4vc3JjL2dhbWVib2FyZC5qcyIsIndlYnBhY2s6Ly9vZGluLWJhdHRsZXNoaXAvLi9zcmMvZ2FtZWxvb3AuanMiLCJ3ZWJwYWNrOi8vb2Rpbi1iYXR0bGVzaGlwLy4vc3JjL2V2ZW50X2xpc3RlbmVyX2NvbnRyb2xsZXIuanMiLCJ3ZWJwYWNrOi8vb2Rpbi1iYXR0bGVzaGlwLy4vc3JjL2luZGV4LmpzIl0sInNvdXJjZXNDb250ZW50IjpbImNvbnN0IFNoaXAgPSAoZ2l2ZW5MZW5ndGgpID0+IHtcbiAgY29uc3QgbGVuZ3RoID0gZ2l2ZW5MZW5ndGg7XG4gIGxldCBoaXRzID0gMDtcbiAgbGV0IHN1bmsgPSBmYWxzZTtcbiAgY29uc3QgZ2V0U2hpcExlbmd0aCA9ICgpID0+IGxlbmd0aDtcbiAgY29uc3QgZ2V0U2hpcEhpdHMgPSAoKSA9PiBoaXRzO1xuICBjb25zdCBpc1N1bmsgPSAoKSA9PiBzdW5rO1xuICBjb25zdCBjaGVja0lmU3VuayA9ICgpID0+IHtcbiAgICBpZiAoaGl0cyA9PT0gbGVuZ3RoKSB7XG4gICAgICBzdW5rID0gdHJ1ZTtcbiAgICB9XG4gIH07XG4gIGNvbnN0IGhpdCA9ICgpID0+IHtcbiAgICBpZiAoIXN1bmspIHtcbiAgICAgIGhpdHMgKz0gMTtcbiAgICAgIGNoZWNrSWZTdW5rKCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVybiBcIlRoYXQgc2hpcCBoYXMgYWxyZWFkeSBiZWVuIHN1bmshXCI7XG4gICAgfVxuICB9O1xuICByZXR1cm4ge1xuICAgIGdldFNoaXBMZW5ndGgsXG4gICAgZ2V0U2hpcEhpdHMsXG4gICAgaXNTdW5rLFxuICAgIGhpdCxcbiAgfTtcbn07XG5cbmV4cG9ydCB7IFNoaXAgfTtcbiIsImltcG9ydCB7IEdhbWVMb29wIH0gZnJvbSBcIi4vZ2FtZWxvb3BcIjtcblxuY29uc3QgRE9NQ29udHJvbGxlciA9ICgoKSA9PiB7XG4gIGNvbnN0IGNyZWF0ZUJvYXJkQ2VsbHMgPSAoZ2FtZWJvYXJkRE9NKSA9PiB7XG4gICAgY29uc3QgQk9BUkRBWEVTTEVOR1RIID0gMTA7XG4gICAgY29uc3QgY29sdW1uTGFiZWxzID0gW1wiQVwiLCBcIkJcIiwgXCJDXCIsIFwiRFwiLCBcIkVcIiwgXCJGXCIsIFwiR1wiLCBcIkhcIiwgXCJJXCIsIFwiSlwiXTtcbiAgICBjb25zdCByb3dMYWJlbHMgPSBbXCIxXCIsIFwiMlwiLCBcIjNcIiwgXCI0XCIsIFwiNVwiLCBcIjZcIiwgXCI3XCIsIFwiOFwiLCBcIjlcIiwgXCIxMFwiXTtcbiAgICBjb25zdCBodW1hblBsYXllck9iamVjdCA9IEdhbWVMb29wLmdldFBsYXllcnMoKVswXTtcbiAgICBmb3IgKGxldCBpID0gLTE7IGkgPCBCT0FSREFYRVNMRU5HVEg7IGkrKykge1xuICAgICAgZm9yIChsZXQgaiA9IC0xOyBqIDwgQk9BUkRBWEVTTEVOR1RIOyBqKyspIHtcbiAgICAgICAgaWYgKGkgPT09IC0xKSB7XG4gICAgICAgICAgaWYgKGogPT09IC0xKSB7XG4gICAgICAgICAgICBjb25zdCBpbnZpc2libGVQbGFjZWhvbGRlckVsZW1lbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuICAgICAgICAgICAgaW52aXNpYmxlUGxhY2Vob2xkZXJFbGVtZW50LmNsYXNzTGlzdC5hZGQoXCJnYW1lYm9hcmQtbGFiZWxcIik7XG4gICAgICAgICAgICBpbnZpc2libGVQbGFjZWhvbGRlckVsZW1lbnQuc3R5bGUudmlzaWJpbGl0eSA9IFwiaGlkZGVuXCI7XG4gICAgICAgICAgICBnYW1lYm9hcmRET00uYXBwZW5kQ2hpbGQoaW52aXNpYmxlUGxhY2Vob2xkZXJFbGVtZW50KTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgY29uc3QgY29sdW1uTGFiZWxFbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcbiAgICAgICAgICAgIGNvbHVtbkxhYmVsRWxlbWVudC5jbGFzc0xpc3QuYWRkKFwiY29sdW1uLWxhYmVsXCIpO1xuICAgICAgICAgICAgY29sdW1uTGFiZWxFbGVtZW50LnRleHRDb250ZW50ID0gY29sdW1uTGFiZWxzW2pdO1xuICAgICAgICAgICAgZ2FtZWJvYXJkRE9NLmFwcGVuZENoaWxkKGNvbHVtbkxhYmVsRWxlbWVudCk7XG4gICAgICAgICAgfVxuICAgICAgICB9IGVsc2UgaWYgKGogPT09IC0xKSB7XG4gICAgICAgICAgY29uc3Qgcm93TGFiZWxFbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcbiAgICAgICAgICByb3dMYWJlbEVsZW1lbnQuY2xhc3NMaXN0LmFkZChcInJvdy1sYWJlbFwiKTtcbiAgICAgICAgICByb3dMYWJlbEVsZW1lbnQudGV4dENvbnRlbnQgPSByb3dMYWJlbHNbaV07XG4gICAgICAgICAgZ2FtZWJvYXJkRE9NLmFwcGVuZENoaWxkKHJvd0xhYmVsRWxlbWVudCk7XG4gICAgICAgIH0gZWxzZSBpZiAoXG4gICAgICAgICAgQXJyYXkuZnJvbShnYW1lYm9hcmRET00uY2xhc3NMaXN0KS5pbmNsdWRlcyhcInBsYXllci1ib2FyZFwiKVxuICAgICAgICApIHtcbiAgICAgICAgICBjb25zdCBwbGF5ZXJDZWxsRWxlbWVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG4gICAgICAgICAgcGxheWVyQ2VsbEVsZW1lbnQuc2V0QXR0cmlidXRlKFwiZGF0YS1yb3dcIiwgaSk7XG4gICAgICAgICAgcGxheWVyQ2VsbEVsZW1lbnQuc2V0QXR0cmlidXRlKFwiZGF0YS1jb2x1bW5cIiwgaik7XG4gICAgICAgICAgcGxheWVyQ2VsbEVsZW1lbnQuY2xhc3NMaXN0LmFkZChcImdhbWVib2FyZC1jZWxsXCIpO1xuICAgICAgICAgIHBsYXllckNlbGxFbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJkcmFnb3ZlclwiLCAoZXZlbnQpID0+IHtcbiAgICAgICAgICAgIGRyYWdPdmVyKGV2ZW50KTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgICBwbGF5ZXJDZWxsRWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwiZHJvcFwiLCAoZXZlbnQpID0+IHtcbiAgICAgICAgICAgIGluc2VydERyYWdnZWRJbWFnZShldmVudCk7XG4gICAgICAgICAgICBpZiAoXG4gICAgICAgICAgICAgIGh1bWFuUGxheWVyT2JqZWN0LmdldEdhbWVib2FyZCgpLmdldFBsYWNlZFNoaXBzKCkubGVuZ3RoID09PSA1XG4gICAgICAgICAgICApIHtcbiAgICAgICAgICAgICAgdG9nZ2xlQWJpbGl0eVRvQXR0YWNrKFwiZW5hYmxlXCIpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0pO1xuICAgICAgICAgIGdhbWVib2FyZERPTS5hcHBlbmRDaGlsZChwbGF5ZXJDZWxsRWxlbWVudCk7XG4gICAgICAgIH0gZWxzZSBpZiAoXG4gICAgICAgICAgQXJyYXkuZnJvbShnYW1lYm9hcmRET00uY2xhc3NMaXN0KS5pbmNsdWRlcyhcImNvbXB1dGVyLWJvYXJkXCIpXG4gICAgICAgICkge1xuICAgICAgICAgIGNvbnN0IGNvbXB1dGVyQ2VsbEVsZW1lbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiYnV0dG9uXCIpO1xuICAgICAgICAgIGNvbXB1dGVyQ2VsbEVsZW1lbnQuc2V0QXR0cmlidXRlKFwiZGF0YS1yb3dcIiwgaSk7XG4gICAgICAgICAgY29tcHV0ZXJDZWxsRWxlbWVudC5zZXRBdHRyaWJ1dGUoXCJkYXRhLWNvbHVtblwiLCBqKTtcbiAgICAgICAgICBjb21wdXRlckNlbGxFbGVtZW50LmNsYXNzTGlzdC5hZGQoXCJnYW1lYm9hcmQtY2VsbFwiKTtcbiAgICAgICAgICBjb21wdXRlckNlbGxFbGVtZW50LmRpc2FibGVkID0gdHJ1ZTtcbiAgICAgICAgICBjb21wdXRlckNlbGxFbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XG4gICAgICAgICAgICBpZiAoIUdhbWVMb29wLmlzTWlkQXR0YWNrKCkpIHtcbiAgICAgICAgICAgICAgY29uc3QgY2VsbFJvdyA9IE51bWJlcihjb21wdXRlckNlbGxFbGVtZW50LmRhdGFzZXQucm93KTtcbiAgICAgICAgICAgICAgY29uc3QgY2VsbENvbHVtbiA9IE51bWJlcihjb21wdXRlckNlbGxFbGVtZW50LmRhdGFzZXQuY29sdW1uKTtcbiAgICAgICAgICAgICAgaHVtYW5QbGF5ZXJPYmplY3Quc2VuZEF0dGFjayhbY2VsbFJvdywgY2VsbENvbHVtbl0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0pO1xuICAgICAgICAgIGdhbWVib2FyZERPTS5hcHBlbmRDaGlsZChjb21wdXRlckNlbGxFbGVtZW50KTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfTtcbiAgY29uc3QgdG9nZ2xlQWJpbGl0eVRvQXR0YWNrID0gKGFjdGlvbikgPT4ge1xuICAgIGNvbnN0IGNvbXB1dGVyR2FtZWJvYXJkRWxlbWVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuY29tcHV0ZXItYm9hcmRcIik7XG4gICAgY29uc3QgY2VsbEVsZW1lbnRzID0gQXJyYXkuZnJvbShcbiAgICAgIGNvbXB1dGVyR2FtZWJvYXJkRWxlbWVudC5xdWVyeVNlbGVjdG9yQWxsKFwiLmdhbWVib2FyZC1jZWxsXCIpXG4gICAgKTtcbiAgICBpZiAoYWN0aW9uID09PSBcImVuYWJsZVwiKSB7XG4gICAgICBjZWxsRWxlbWVudHMuZm9yRWFjaCgoY2VsbEVsZW1lbnQpID0+IHtcbiAgICAgICAgY2VsbEVsZW1lbnQuZGlzYWJsZWQgPSBmYWxzZTtcbiAgICAgIH0pO1xuICAgIH0gZWxzZSBpZiAoYWN0aW9uID09PSBcImRpc2FibGVcIikge1xuICAgICAgY2VsbEVsZW1lbnRzLmZvckVhY2goKGNlbGxFbGVtZW50KSA9PiB7XG4gICAgICAgIGNlbGxFbGVtZW50LmRpc2FibGVkID0gdHJ1ZTtcbiAgICAgIH0pO1xuICAgIH1cbiAgfTtcbiAgY29uc3QgZ2V0RHJhZ2dlZEltYWdlID0gKGV2ZW50KSA9PiB7XG4gICAgY29uc3QgZGF0YU9iamVjdCA9IHtcbiAgICAgIGltYWdlOiBldmVudC50YXJnZXQuc3JjLFxuICAgICAgc2hpcExlbmd0aDogZXZlbnQudGFyZ2V0LmRhdGFzZXQuc2hpcExlbmd0aCxcbiAgICAgIGhvcml6b250YWw6IGZhbHNlLFxuICAgICAgdmVydGljYWw6IGZhbHNlLFxuICAgICAgZWxlbWVudElEOiBldmVudC50YXJnZXQuZ2V0QXR0cmlidXRlKFwiaWRcIiksXG4gICAgfTtcbiAgICBpZiAoQXJyYXkuZnJvbShldmVudC50YXJnZXQuY2xhc3NMaXN0KS5pbmNsdWRlcyhcImhvcml6b250YWxcIikpIHtcbiAgICAgIGRhdGFPYmplY3QuaG9yaXpvbnRhbCA9IHRydWU7XG4gICAgfSBlbHNlIGlmIChBcnJheS5mcm9tKGV2ZW50LnRhcmdldC5jbGFzc0xpc3QpLmluY2x1ZGVzKFwidmVydGljYWxcIikpIHtcbiAgICAgIGRhdGFPYmplY3QudmVydGljYWwgPSB0cnVlO1xuICAgIH1cbiAgICBjb25zdCBkYXRhU3RyaW5nID0gSlNPTi5zdHJpbmdpZnkoZGF0YU9iamVjdCk7XG4gICAgZXZlbnQuZGF0YVRyYW5zZmVyLnNldERhdGEoXCJpbWFnZVwiLCBkYXRhU3RyaW5nKTtcbiAgfTtcbiAgY29uc3QgZHJhZ092ZXIgPSAoZXZlbnQpID0+IHtcbiAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICB9O1xuICBjb25zdCBpbml0aWFsaXplQm9hcmRET00gPSAoKSA9PiB7XG4gICAgY29uc3QgaHVtYW5QbGF5ZXJHYW1lYm9hcmRET00gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnBsYXllci1ib2FyZFwiKTtcbiAgICBjb25zdCBjb21wdXRlckdhbWVib2FyZERPTSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuY29tcHV0ZXItYm9hcmRcIik7XG4gICAgY3JlYXRlQm9hcmRDZWxscyhodW1hblBsYXllckdhbWVib2FyZERPTSk7XG4gICAgY3JlYXRlQm9hcmRDZWxscyhjb21wdXRlckdhbWVib2FyZERPTSk7XG4gIH07XG4gIGNvbnN0IGlzVmFsaWRHYW1lYm9hcmRDZWxsID0gKHRhcmdldENlbGwsIGRhdGFPYmplY3QpID0+IHtcbiAgICBjb25zdCBjZWxsQ29vcmRpbmF0ZXMgPSBbXG4gICAgICBOdW1iZXIodGFyZ2V0Q2VsbC5kYXRhc2V0LnJvdyksXG4gICAgICBOdW1iZXIodGFyZ2V0Q2VsbC5kYXRhc2V0LmNvbHVtbiksXG4gICAgXTtcbiAgICBjb25zdCBsZW5ndGggPSBOdW1iZXIoZGF0YU9iamVjdC5zaGlwTGVuZ3RoKTtcbiAgICBpZiAoZGF0YU9iamVjdC5ob3Jpem9udGFsKSB7XG4gICAgICBpZiAoXG4gICAgICAgIEdhbWVMb29wLmdldFBsYXllcnMoKVswXS5jaGVja0lmVmFsaWRFbXB0eUNvb3JkaW5hdGVzKFxuICAgICAgICAgIGNlbGxDb29yZGluYXRlcyxcbiAgICAgICAgICBsZW5ndGgsXG4gICAgICAgICAgXCJyaWdodFwiXG4gICAgICAgIClcbiAgICAgICkge1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgaWYgKGRhdGFPYmplY3QudmVydGljYWwpIHtcbiAgICAgIGlmIChcbiAgICAgICAgR2FtZUxvb3AuZ2V0UGxheWVycygpWzBdLmNoZWNrSWZWYWxpZEVtcHR5Q29vcmRpbmF0ZXMoXG4gICAgICAgICAgY2VsbENvb3JkaW5hdGVzLFxuICAgICAgICAgIGxlbmd0aCxcbiAgICAgICAgICBcImRvd25cIlxuICAgICAgICApXG4gICAgICApIHtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICB9XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICB9O1xuICBjb25zdCBhZGRTaGlwVG9ET00gPSAodGFyZ2V0Q2VsbCwgZGF0YU9iamVjdCkgPT4ge1xuICAgIGNvbnN0IGxlbmd0aCA9IGRhdGFPYmplY3Quc2hpcExlbmd0aDtcbiAgICBjb25zdCB0YXJnZXRDZWxsUm93ID0gTnVtYmVyKHRhcmdldENlbGwuZGF0YXNldC5yb3cpO1xuICAgIGNvbnN0IHRhcmdldENlbGxDb2x1bW4gPSBOdW1iZXIodGFyZ2V0Q2VsbC5kYXRhc2V0LmNvbHVtbik7XG4gICAgY29uc3QgY29vcmRpbmF0ZXNBcnJheSA9IFtbdGFyZ2V0Q2VsbFJvdywgdGFyZ2V0Q2VsbENvbHVtbl1dO1xuICAgIHRhcmdldENlbGwuY2xhc3NMaXN0LmFkZChcImNvbnRhaW5zLXNoaXAtaW1hZ2VcIik7XG4gICAgdGFyZ2V0Q2VsbC5jbGFzc0xpc3QuYWRkKFwic2hpcC1pbWFnZVwiKTtcbiAgICB0YXJnZXRDZWxsLmNsYXNzTGlzdC5hZGQoYHNoaXAtaW1hZ2UtJHtsZW5ndGh9YCk7XG4gICAgdGFyZ2V0Q2VsbC5jbGFzc0xpc3QuYWRkKGBzaGlwLWltYWdlLSR7bGVuZ3RofS0xYCk7XG4gICAgaWYgKGRhdGFPYmplY3QuaG9yaXpvbnRhbCkge1xuICAgICAgdGFyZ2V0Q2VsbC5jbGFzc0xpc3QuYWRkKFwiaG9yaXpvbnRhbFwiKTtcbiAgICB9IGVsc2UgaWYgKGRhdGFPYmplY3QudmVydGljYWwpIHtcbiAgICAgIHRhcmdldENlbGwuY2xhc3NMaXN0LmFkZChcInZlcnRpY2FsXCIpO1xuICAgIH1cbiAgICBmb3IgKGxldCBpID0gMTsgaSA8IGxlbmd0aDsgaSsrKSB7XG4gICAgICBsZXQgcmVtYWluaW5nQ2VsbDtcbiAgICAgIGlmIChkYXRhT2JqZWN0Lmhvcml6b250YWwpIHtcbiAgICAgICAgcmVtYWluaW5nQ2VsbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXG4gICAgICAgICAgYC5wbGF5ZXItYm9hcmQgW2RhdGEtcm93PScke3RhcmdldENlbGxSb3d9J11bZGF0YS1jb2x1bW49JyR7XG4gICAgICAgICAgICB0YXJnZXRDZWxsQ29sdW1uICsgaVxuICAgICAgICAgIH0nXWBcbiAgICAgICAgKTtcbiAgICAgICAgcmVtYWluaW5nQ2VsbC5jbGFzc0xpc3QuYWRkKFwiaG9yaXpvbnRhbFwiKTtcbiAgICAgICAgY29vcmRpbmF0ZXNBcnJheS5wdXNoKFt0YXJnZXRDZWxsUm93LCB0YXJnZXRDZWxsQ29sdW1uICsgaV0pO1xuICAgICAgfSBlbHNlIGlmIChkYXRhT2JqZWN0LnZlcnRpY2FsKSB7XG4gICAgICAgIHJlbWFpbmluZ0NlbGwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFxuICAgICAgICAgIGAucGxheWVyLWJvYXJkIFtkYXRhLXJvdz0nJHtcbiAgICAgICAgICAgIHRhcmdldENlbGxSb3cgKyBpXG4gICAgICAgICAgfSddW2RhdGEtY29sdW1uPScke3RhcmdldENlbGxDb2x1bW59J11gXG4gICAgICAgICk7XG4gICAgICAgIHJlbWFpbmluZ0NlbGwuY2xhc3NMaXN0LmFkZChcInZlcnRpY2FsXCIpO1xuICAgICAgICBjb29yZGluYXRlc0FycmF5LnB1c2goW3RhcmdldENlbGxSb3cgKyBpLCB0YXJnZXRDZWxsQ29sdW1uXSk7XG4gICAgICB9XG4gICAgICByZW1haW5pbmdDZWxsLmNsYXNzTGlzdC5hZGQoXCJjb250YWlucy1zaGlwLWltYWdlXCIpO1xuICAgICAgcmVtYWluaW5nQ2VsbC5jbGFzc0xpc3QuYWRkKFwic2hpcC1pbWFnZVwiKTtcbiAgICAgIHJlbWFpbmluZ0NlbGwuY2xhc3NMaXN0LmFkZChgc2hpcC1pbWFnZS0ke2xlbmd0aH1gKTtcbiAgICAgIHJlbWFpbmluZ0NlbGwuY2xhc3NMaXN0LmFkZChgc2hpcC1pbWFnZS0ke2xlbmd0aH0tJHtpICsgMX1gKTtcbiAgICB9XG4gICAgcmV0dXJuIGNvb3JkaW5hdGVzQXJyYXk7XG4gIH07XG4gIGNvbnN0IGRpc2FibGVJbWFnZUJ1dHRvbkludGVyYWN0aW9ucyA9IChkYXRhT2JqZWN0KSA9PiB7XG4gICAgY29uc3QgSUQgPSBkYXRhT2JqZWN0LmVsZW1lbnRJRDtcbiAgICBjb25zdCBpbWFnZUVsZW1lbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGAjJHtJRH1gKTtcbiAgICBjb25zdCBidXR0b25FbGVtZW50ID0gaW1hZ2VFbGVtZW50LnBhcmVudE5vZGUucXVlcnlTZWxlY3RvcihcImJ1dHRvblwiKTtcbiAgICBpbWFnZUVsZW1lbnQuc2V0QXR0cmlidXRlKFwiZHJhZ2dhYmxlXCIsIGZhbHNlKTtcbiAgICBpbWFnZUVsZW1lbnQuY2xhc3NMaXN0LmFkZChcImRpc2FibGVkLWltYWdlXCIpO1xuICAgIGJ1dHRvbkVsZW1lbnQuZGlzYWJsZWQgPSB0cnVlO1xuICB9O1xuICBjb25zdCBpbnNlcnREcmFnZ2VkSW1hZ2UgPSAoZXZlbnQpID0+IHtcbiAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgIGNvbnN0IGh1bWFuUGxheWVyT2JqZWN0ID0gR2FtZUxvb3AuZ2V0UGxheWVycygpWzBdO1xuICAgIGNvbnN0IHRhcmdldENlbGwgPSBldmVudC50YXJnZXQ7XG4gICAgaWYgKEFycmF5LmZyb20odGFyZ2V0Q2VsbC5jbGFzc0xpc3QpLmluY2x1ZGVzKFwiY29udGFpbnMtc2hpcC1pbWFnZVwiKSkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBjb25zdCBkYXRhU3RyaW5nID0gZXZlbnQuZGF0YVRyYW5zZmVyLmdldERhdGEoXCJpbWFnZVwiKTtcbiAgICBjb25zdCBkYXRhT2JqZWN0ID0gSlNPTi5wYXJzZShkYXRhU3RyaW5nKTtcbiAgICBpZiAoIWlzVmFsaWRHYW1lYm9hcmRDZWxsKHRhcmdldENlbGwsIGRhdGFPYmplY3QpKSB7XG4gICAgICAvLyBwcm9iYWJseSBtYWtlIHNvbWUgRE9NIGVycm9yIG1lc3NhZ2UgYXBwZWFyXG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGNvbnN0IHNoaXBDb29yZGluYXRlcyA9IGFkZFNoaXBUb0RPTSh0YXJnZXRDZWxsLCBkYXRhT2JqZWN0KTtcbiAgICBodW1hblBsYXllck9iamVjdC5hZGRTaGlwVG9HYW1lYm9hcmQoXG4gICAgICBOdW1iZXIoZGF0YU9iamVjdC5zaGlwTGVuZ3RoKSxcbiAgICAgIHNoaXBDb29yZGluYXRlc1xuICAgICk7XG4gICAgZGlzYWJsZUltYWdlQnV0dG9uSW50ZXJhY3Rpb25zKGRhdGFPYmplY3QpO1xuICAgIHRhcmdldENlbGwucmVtb3ZlRXZlbnRMaXN0ZW5lcihcImRyb3BcIiwgaW5zZXJ0RHJhZ2dlZEltYWdlKTtcbiAgfTtcbiAgY29uc3Qgcm90YXRlU2hpcEltYWdlID0gKGltYWdlKSA9PiB7XG4gICAgY29uc3QgaW1hZ2VDbGFzc2VzID0gQXJyYXkuZnJvbShpbWFnZS5jbGFzc0xpc3QpO1xuICAgIGlmIChpbWFnZUNsYXNzZXMuaW5jbHVkZXMoXCJob3Jpem9udGFsXCIpKSB7XG4gICAgICBpbWFnZS5jbGFzc0xpc3QucmVtb3ZlKFwiaG9yaXpvbnRhbFwiKTtcbiAgICAgIGltYWdlLmNsYXNzTGlzdC5hZGQoXCJ2ZXJ0aWNhbFwiKTtcbiAgICB9IGVsc2UgaWYgKGltYWdlQ2xhc3Nlcy5pbmNsdWRlcyhcInZlcnRpY2FsXCIpKSB7XG4gICAgICBpbWFnZS5jbGFzc0xpc3QucmVtb3ZlKFwidmVydGljYWxcIik7XG4gICAgICBpbWFnZS5jbGFzc0xpc3QuYWRkKFwiaG9yaXpvbnRhbFwiKTtcbiAgICB9XG4gIH07XG4gIGNvbnN0IHJvdGF0ZVBlckxlbmd0aCA9ICh0ZW1wRGl2LCBjbG9uZWRJbWFnZUVsZW1lbnQpID0+IHtcbiAgICBjb25zdCBjbG9uZWRJbWFnZUVsZW1lbnRDbGFzc2VzID0gQXJyYXkuZnJvbShjbG9uZWRJbWFnZUVsZW1lbnQuY2xhc3NMaXN0KTtcbiAgICBpZiAoY2xvbmVkSW1hZ2VFbGVtZW50Q2xhc3Nlcy5pbmNsdWRlcyhcImhvcml6b250YWxcIikpIHtcbiAgICAgIHRlbXBEaXYuY2xhc3NMaXN0LmFkZChcInRlbXAtcm90YXRlLWhvcml6b250YWxcIik7XG4gICAgfSBlbHNlIGlmIChjbG9uZWRJbWFnZUVsZW1lbnRDbGFzc2VzLmluY2x1ZGVzKFwidmVydGljYWxcIikpIHtcbiAgICAgIHRlbXBEaXYuY2xhc3NMaXN0LmFkZChcInRlbXAtcm90YXRlLXZlcnRpY2FsXCIpO1xuICAgICAgaWYgKGNsb25lZEltYWdlRWxlbWVudC5kYXRhc2V0LnNoaXBMZW5ndGggPT09IFwiNVwiKSB7XG4gICAgICAgIHRlbXBEaXYuY2xhc3NMaXN0LmFkZChcInRlbXAtcm90YXRlLXZlcnRpY2FsLTVcIik7XG4gICAgICB9IGVsc2UgaWYgKGNsb25lZEltYWdlRWxlbWVudC5kYXRhc2V0LnNoaXBMZW5ndGggPT09IFwiNFwiKSB7XG4gICAgICAgIHRlbXBEaXYuY2xhc3NMaXN0LmFkZChcInRlbXAtcm90YXRlLXZlcnRpY2FsLTRcIik7XG4gICAgICB9IGVsc2UgaWYgKGNsb25lZEltYWdlRWxlbWVudC5kYXRhc2V0LnNoaXBMZW5ndGggPT09IFwiM1wiKSB7XG4gICAgICAgIHRlbXBEaXYuY2xhc3NMaXN0LmFkZChcInRlbXAtcm90YXRlLXZlcnRpY2FsLTNcIik7XG4gICAgICB9IGVsc2UgaWYgKGNsb25lZEltYWdlRWxlbWVudC5kYXRhc2V0LnNoaXBMZW5ndGggPT09IFwiMlwiKSB7XG4gICAgICAgIHRlbXBEaXYuY2xhc3NMaXN0LmFkZChcInRlbXAtcm90YXRlLXZlcnRpY2FsLTJcIik7XG4gICAgICB9XG4gICAgfVxuICB9O1xuICBjb25zdCByb3RhdGVEcmFnZ2VkSW1hZ2UgPSAoZXZlbnQpID0+IHtcbiAgICBjb25zdCBpbWFnZUVsZW1lbnQgPSBldmVudC50YXJnZXQ7XG4gICAgY29uc3QgY2xvbmVkSW1hZ2VFbGVtZW50ID0gaW1hZ2VFbGVtZW50LmNsb25lTm9kZSgpO1xuICAgIGNvbnN0IHRlbXBEaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuICAgIHRlbXBEaXYuY2xhc3NMaXN0LmFkZChcInRlbXAtcm90YXRlXCIpO1xuICAgIHJvdGF0ZVBlckxlbmd0aCh0ZW1wRGl2LCBjbG9uZWRJbWFnZUVsZW1lbnQpO1xuICAgIHRlbXBEaXYuYXBwZW5kQ2hpbGQoY2xvbmVkSW1hZ2VFbGVtZW50KTtcbiAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKHRlbXBEaXYpO1xuICAgIGV2ZW50LmRhdGFUcmFuc2Zlci5zZXREcmFnSW1hZ2UodGVtcERpdiwgMCwgMCk7XG4gICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICBkb2N1bWVudC5ib2R5LnJlbW92ZUNoaWxkKHRlbXBEaXYpO1xuICAgIH0sIDApO1xuICB9O1xuICBjb25zdCBhZGRBdHRhY2tSZXN1bHRET00gPSAocGxheWVyVHlwZSwgYXR0YWNrUmVzdWx0cywgY29vcmRpbmF0ZXMpID0+IHtcbiAgICBjb25zdCBjZWxsUm93ID0gY29vcmRpbmF0ZXNbMF07XG4gICAgY29uc3QgY2VsbENvbHVtbiA9IGNvb3JkaW5hdGVzWzFdO1xuICAgIGNvbnN0IGdhbWVib2FyZERPTSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYC4ke3BsYXllclR5cGV9LWJvYXJkYCk7XG4gICAgY29uc3QgdGFyZ2V0Q2VsbCA9IGdhbWVib2FyZERPTS5xdWVyeVNlbGVjdG9yKFxuICAgICAgYFtkYXRhLXJvdz0nJHtjZWxsUm93fSddW2RhdGEtY29sdW1uPScke2NlbGxDb2x1bW59J11gXG4gICAgKTtcbiAgICBjb25zdCBhdHRhY2tSZXN1bHRzRWxlbWVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJpbWdcIik7XG4gICAgYXR0YWNrUmVzdWx0c0VsZW1lbnQuY2xhc3NMaXN0LmFkZChcImF0dGFjay1yZXN1bHRzXCIpO1xuICAgIHRhcmdldENlbGwuYXBwZW5kQ2hpbGQoYXR0YWNrUmVzdWx0c0VsZW1lbnQpO1xuICAgIGlmIChhdHRhY2tSZXN1bHRzID09PSBcImhpdFwiKSB7XG4gICAgICBhdHRhY2tSZXN1bHRzRWxlbWVudC5zZXRBdHRyaWJ1dGUoXCJzcmNcIiwgXCIuLi9kaXN0L3JlZF9YLnBuZ1wiKTtcbiAgICB9IGVsc2Uge1xuICAgICAgYXR0YWNrUmVzdWx0c0VsZW1lbnQuc2V0QXR0cmlidXRlKFwic3JjXCIsIFwiLi4vZGlzdC93aGl0ZV9PLnBuZ1wiKTtcbiAgICB9XG4gICAgdGFyZ2V0Q2VsbC5kaXNhYmxlZCA9IHRydWU7XG4gIH07XG4gIGNvbnN0IGRpc3BsYXlXaW5uZXIgPSAod2lubmluZ1BsYXllcikgPT4ge1xuICAgIGNvbnN0IHBsYXllclR5cGUgPSB3aW5uaW5nUGxheWVyLmlzQ29tcHV0ZXIoKTtcbiAgICBjb25zdCBnYW1lUmVzdWx0c0VsZW1lbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLmdhbWUtcmVzdWx0c1wiKTtcbiAgICBnYW1lUmVzdWx0c0VsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZShcImRlZmF1bHQtaGlkZGVuXCIpO1xuICAgIGNvbnN0IGRpc3BsYXlXaW5uZXJFbGVtZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5kaXNwbGF5LXdpbm5lclwiKTtcbiAgICBpZiAoIXBsYXllclR5cGUpIHtcbiAgICAgIGRpc3BsYXlXaW5uZXJFbGVtZW50LnRleHRDb250ZW50ID0gXCJDb25ncmF0dWxhdGlvbnMsIHlvdSB3b24hXCI7XG4gICAgfSBlbHNlIHtcbiAgICAgIGRpc3BsYXlXaW5uZXJFbGVtZW50LnRleHRDb250ZW50ID0gXCJPaCBubywgeW91IGxvc3QhIFRyeSBhZ2FpbiFcIjtcbiAgICB9XG4gIH07XG4gIGNvbnN0IHJlc2V0R2FtZWJvYXJkcyA9ICgpID0+IHtcbiAgICBjb25zdCBwbGF5ZXJHYW1lYm9hcmQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnBsYXllci1ib2FyZFwiKTtcbiAgICBwbGF5ZXJHYW1lYm9hcmQuaW5uZXJIVE1MID0gXCJcIjtcbiAgICBjb25zdCBjb21wdXRlckdhbWVib2FyZCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuY29tcHV0ZXItYm9hcmRcIik7XG4gICAgY29tcHV0ZXJHYW1lYm9hcmQuaW5uZXJIVE1MID0gXCJcIjtcbiAgfTtcbiAgY29uc3QgcmVzZXRTaGlwSW1hZ2VzID0gKCkgPT4ge1xuICAgIGNvbnN0IHNoaXBQaWVjZUltYWdlcyA9IEFycmF5LmZyb20oXG4gICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKFwiLnNoaXAtcGllY2VcIilcbiAgICApO1xuICAgIHNoaXBQaWVjZUltYWdlcy5mb3JFYWNoKChpbWFnZSkgPT4ge1xuICAgICAgaW1hZ2Uuc2V0QXR0cmlidXRlKFwiZHJhZ2dhYmxlXCIsIHRydWUpO1xuICAgICAgaW1hZ2UuY2xhc3NMaXN0LnJlbW92ZShcImRpc2FibGVkLWltYWdlXCIpO1xuICAgICAgaWYgKEFycmF5LmZyb20oaW1hZ2UuY2xhc3NMaXN0KS5pbmNsdWRlcyhcInZlcnRpY2FsXCIpKSB7XG4gICAgICAgIGltYWdlLmNsYXNzTGlzdC5yZW1vdmUoXCJ2ZXJ0aWNhbFwiKTtcbiAgICAgICAgaW1hZ2UuY2xhc3NMaXN0LmFkZChcImhvcml6b250YWxcIik7XG4gICAgICB9XG4gICAgfSk7XG4gIH07XG4gIGNvbnN0IHJlc2V0Um90YXRlU2hpcEJ1dHRvbnMgPSAoKSA9PiB7XG4gICAgY29uc3Qgcm90YXRlU2hpcEJ1dHRvbnMgPSBBcnJheS5mcm9tKFxuICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChcIi5yb3RhdGUtc2hpcFwiKVxuICAgICk7XG4gICAgcm90YXRlU2hpcEJ1dHRvbnMuZm9yRWFjaCgoYnV0dG9uKSA9PiB7XG4gICAgICBidXR0b24uZGlzYWJsZWQgPSBmYWxzZTtcbiAgICB9KTtcbiAgfTtcbiAgY29uc3QgcmVzZXRHYW1lUmVzdWx0cyA9ICgpID0+IHtcbiAgICBjb25zdCBnYW1lUmVzdWx0c0VsZW1lbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLmdhbWUtcmVzdWx0c1wiKTtcbiAgICBnYW1lUmVzdWx0c0VsZW1lbnQuY2xhc3NMaXN0LmFkZChcImRlZmF1bHQtaGlkZGVuXCIpO1xuICAgIGNvbnN0IGRpc3BsYXlXaW5uZXJFbGVtZW50ID1cbiAgICAgIGdhbWVSZXN1bHRzRWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLmRpc3BsYXktd2lubmVyXCIpO1xuICAgIGRpc3BsYXlXaW5uZXJFbGVtZW50LnRleHRDb250ZW50ID0gXCJQbGFjZWhvbGRlclwiO1xuICB9O1xuICBjb25zdCByZXNldERPTSA9ICgpID0+IHtcbiAgICByZXNldEdhbWVib2FyZHMoKTtcbiAgICByZXNldFNoaXBJbWFnZXMoKTtcbiAgICByZXNldFJvdGF0ZVNoaXBCdXR0b25zKCk7XG4gICAgcmVzZXRHYW1lUmVzdWx0cygpO1xuICB9O1xuICByZXR1cm4ge1xuICAgIGluaXRpYWxpemVCb2FyZERPTSxcbiAgICBpbnNlcnREcmFnZ2VkSW1hZ2UsXG4gICAgcm90YXRlU2hpcEltYWdlLFxuICAgIHJvdGF0ZURyYWdnZWRJbWFnZSxcbiAgICBnZXREcmFnZ2VkSW1hZ2UsXG4gICAgZHJhZ092ZXIsXG4gICAgYWRkQXR0YWNrUmVzdWx0RE9NLFxuICAgIHRvZ2dsZUFiaWxpdHlUb0F0dGFjayxcbiAgICBkaXNwbGF5V2lubmVyLFxuICAgIHJlc2V0RE9NLFxuICB9O1xufSkoKTtcblxuZXhwb3J0IHsgRE9NQ29udHJvbGxlciB9O1xuIiwiaW1wb3J0IHsgU2hpcCB9IGZyb20gXCIuL3NoaXBcIjtcbmltcG9ydCB7IEdhbWVib2FyZCB9IGZyb20gXCIuL2dhbWVib2FyZFwiO1xuaW1wb3J0IHsgR2FtZUxvb3AgfSBmcm9tIFwiLi9nYW1lbG9vcFwiO1xuaW1wb3J0IHsgRE9NQ29udHJvbGxlciB9IGZyb20gXCIuL0RPTV9jb250cm9sbGVyXCI7XG5cbmNvbnN0IFBsYXllciA9IChwbGF5ZXJUeXBlKSA9PiB7XG4gIGNvbnN0IGRldGVybWluZVBsYXllclR5cGUgPSAoKSA9PiB7XG4gICAgaWYgKHBsYXllclR5cGUgPT09IFwiaHVtYW5cIikge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICBpZiAocGxheWVyVHlwZSA9PT0gXCJjb21wdXRlclwiKSB7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gIH07XG4gIGNvbnN0IGNvbXB1dGVyUGxheWVyID0gZGV0ZXJtaW5lUGxheWVyVHlwZSgpO1xuICBjb25zdCBwbGF5ZXJHYW1lYm9hcmQgPSBHYW1lYm9hcmQoKTtcbiAgbGV0IG9wcG9zaW5nUGxheWVyO1xuICBjb25zdCBpc0NvbXB1dGVyID0gKCkgPT4gY29tcHV0ZXJQbGF5ZXI7XG4gIGNvbnN0IGdldEdhbWVib2FyZCA9ICgpID0+IHBsYXllckdhbWVib2FyZDtcbiAgY29uc3QgZ2V0T3Bwb3NpbmdQbGF5ZXIgPSAoKSA9PiBvcHBvc2luZ1BsYXllcjtcbiAgY29uc3Qgc2V0T3Bwb3NpbmdQbGF5ZXIgPSAocGxheWVyKSA9PiB7XG4gICAgb3Bwb3NpbmdQbGF5ZXIgPSBwbGF5ZXI7XG4gIH07XG4gIGNvbnN0IGFkZFNoaXBUb0dhbWVib2FyZCA9IChzaGlwTGVuZ3RoLCBjb29yZGluYXRlcykgPT4ge1xuICAgIGNvbnN0IHNoaXAgPSBTaGlwKHNoaXBMZW5ndGgpO1xuICAgIHBsYXllckdhbWVib2FyZC5wbGFjZVNoaXAoc2hpcCwgY29vcmRpbmF0ZXMpO1xuICB9O1xuICBjb25zdCBzZW5kQXR0YWNrID0gKGNvb3JkaW5hdGVzKSA9PiB7XG4gICAgaWYgKFxuICAgICAgY2hlY2tJZlByZXZpb3VzbHlBdHRhY2tlZChjb29yZGluYXRlcykgfHxcbiAgICAgICFHYW1lTG9vcC5pc0luUHJvZ3Jlc3MoKSB8fFxuICAgICAgR2FtZUxvb3AuaXNNaWRBdHRhY2soKVxuICAgICkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBjb25zdCBvcHBvc2luZ1BsYXllckdhbWVib2FyZCA9IG9wcG9zaW5nUGxheWVyLmdldEdhbWVib2FyZCgpO1xuICAgIGNvbnN0IGF0dGFja1Jlc3VsdHMgPSBvcHBvc2luZ1BsYXllci5yZWNlaXZlQXR0YWNrKGNvb3JkaW5hdGVzKTtcbiAgICBpZiAoYXR0YWNrUmVzdWx0cyA9PT0gXCJoaXRcIikge1xuICAgICAgcGxheWVyR2FtZWJvYXJkLmFkZFNlbnRIaXRTaG90KGNvb3JkaW5hdGVzKTtcbiAgICAgIGlmICghaXNDb21wdXRlcigpKSB7XG4gICAgICAgIERPTUNvbnRyb2xsZXIuYWRkQXR0YWNrUmVzdWx0RE9NKFxuICAgICAgICAgIFwiY29tcHV0ZXJcIixcbiAgICAgICAgICBhdHRhY2tSZXN1bHRzLFxuICAgICAgICAgIGNvb3JkaW5hdGVzXG4gICAgICAgICk7XG4gICAgICB9IGVsc2UgaWYgKGlzQ29tcHV0ZXIoKSkge1xuICAgICAgICBET01Db250cm9sbGVyLmFkZEF0dGFja1Jlc3VsdERPTShcInBsYXllclwiLCBhdHRhY2tSZXN1bHRzLCBjb29yZGluYXRlcyk7XG4gICAgICB9XG4gICAgICBpZiAob3Bwb3NpbmdQbGF5ZXJHYW1lYm9hcmQuaXNBbGxTaGlwc1N1bmsoKSkge1xuICAgICAgICBHYW1lTG9vcC5lbmRHYW1lKG9wcG9zaW5nUGxheWVyKTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgIH0gZWxzZSBpZiAoYXR0YWNrUmVzdWx0cyA9PT0gXCJtaXNzXCIpIHtcbiAgICAgIHBsYXllckdhbWVib2FyZC5hZGRTZW50TWlzc2VkU2hvdChjb29yZGluYXRlcyk7XG4gICAgICBpZiAoIWlzQ29tcHV0ZXIoKSkge1xuICAgICAgICBET01Db250cm9sbGVyLmFkZEF0dGFja1Jlc3VsdERPTShcbiAgICAgICAgICBcImNvbXB1dGVyXCIsXG4gICAgICAgICAgYXR0YWNrUmVzdWx0cyxcbiAgICAgICAgICBjb29yZGluYXRlc1xuICAgICAgICApO1xuICAgICAgfSBlbHNlIGlmIChpc0NvbXB1dGVyKCkpIHtcbiAgICAgICAgRE9NQ29udHJvbGxlci5hZGRBdHRhY2tSZXN1bHRET00oXCJwbGF5ZXJcIiwgYXR0YWNrUmVzdWx0cywgY29vcmRpbmF0ZXMpO1xuICAgICAgfVxuICAgIH1cbiAgICBpZiAob3Bwb3NpbmdQbGF5ZXIuaXNDb21wdXRlcigpKSB7XG4gICAgICBHYW1lTG9vcC50b2dnbGVNaWRBdHRhY2sodHJ1ZSk7XG4gICAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgR2FtZUxvb3AudG9nZ2xlTWlkQXR0YWNrKGZhbHNlKTtcbiAgICAgICAgb3Bwb3NpbmdQbGF5ZXIuc2VuZENvbXB1dGVyQXR0YWNrKCk7XG4gICAgICB9LCAwKTtcbiAgICB9XG4gIH07XG4gIGNvbnN0IGluaXRpYWxpemVDb21wdXRlckdhbWVib2FyZCA9ICgpID0+IHtcbiAgICBpZiAoIWNvbXB1dGVyUGxheWVyKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGNvbnN0IGxlbmd0aHNPZlNoaXBzID0gWzUsIDQsIDMsIDMsIDJdO1xuICAgIGZvciAoY29uc3Qgc2hpcExlbmd0aCBvZiBsZW5ndGhzT2ZTaGlwcykge1xuICAgICAgY29uc3Qgc2hpcENvb3JkaW5hdGVzID0gZ2VuZXJhdGVDb21wdXRlclNoaXBDb29yZGluYXRlcyhzaGlwTGVuZ3RoKTtcbiAgICAgIGFkZFNoaXBUb0dhbWVib2FyZChzaGlwTGVuZ3RoLCBzaGlwQ29vcmRpbmF0ZXMpO1xuICAgIH1cbiAgfTtcbiAgY29uc3Qgc2VuZENvbXB1dGVyQXR0YWNrID0gKCkgPT4ge1xuICAgIGlmICghY29tcHV0ZXJQbGF5ZXIgfHwgIUdhbWVMb29wLmlzSW5Qcm9ncmVzcygpKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGNvbnN0IGF0dGFja0Nvb3JkaW5hdGVzID0gZ2VuZXJhdGVBdHRhY2tDb29yZGluYXRlcygpO1xuICAgIHNlbmRBdHRhY2soYXR0YWNrQ29vcmRpbmF0ZXMpO1xuICB9O1xuICBjb25zdCByZWNlaXZlQXR0YWNrID0gKGNvb3JkaW5hdGVzKSA9PiB7XG4gICAgY29uc3QgYXR0YWNrUmVzdWx0cyA9IHBsYXllckdhbWVib2FyZC5yZWNlaXZlQXR0YWNrKGNvb3JkaW5hdGVzKTtcbiAgICByZXR1cm4gYXR0YWNrUmVzdWx0cztcbiAgfTtcbiAgY29uc3QgZ2VuZXJhdGVDb21wdXRlclNoaXBDb29yZGluYXRlcyA9IChzaGlwTGVuZ3RoKSA9PiB7XG4gICAgbGV0IGxpc3RPZkNvb3JkaW5hdGVzID0gW107XG4gICAgZG8ge1xuICAgICAgbGlzdE9mQ29vcmRpbmF0ZXMgPSBbXTtcbiAgICAgIGNvbnN0IHN0YXJ0aW5nQ29vcmRpbmF0ZXMgPSBnZW5lcmF0ZVN0YXJ0aW5nQ29vcmRpbmF0ZXMoKTtcbiAgICAgIGNvbnN0IG5vblN0YXJ0aW5nQ29vcmRpbmF0ZXMgPSBnZW5lcmF0ZU5vblN0YXJ0aW5nQ29vcmRpbmF0ZXMoXG4gICAgICAgIHN0YXJ0aW5nQ29vcmRpbmF0ZXMsXG4gICAgICAgIHNoaXBMZW5ndGhcbiAgICAgICk7XG4gICAgICBsaXN0T2ZDb29yZGluYXRlcy5wdXNoKHN0YXJ0aW5nQ29vcmRpbmF0ZXMpO1xuICAgICAgbGlzdE9mQ29vcmRpbmF0ZXMgPSBsaXN0T2ZDb29yZGluYXRlcy5jb25jYXQobm9uU3RhcnRpbmdDb29yZGluYXRlcyk7XG4gICAgfSB3aGlsZSAobGlzdE9mQ29vcmRpbmF0ZXMubGVuZ3RoIDwgc2hpcExlbmd0aCk7XG4gICAgcmV0dXJuIGxpc3RPZkNvb3JkaW5hdGVzO1xuICB9O1xuICBjb25zdCBnZW5lcmF0ZVN0YXJ0aW5nQ29vcmRpbmF0ZXMgPSAoKSA9PiB7XG4gICAgY29uc3Qgc3RhcnRpbmdDb29yZGluYXRlcyA9IFt1bmRlZmluZWQsIHVuZGVmaW5lZF07XG4gICAgZG8ge1xuICAgICAgc3RhcnRpbmdDb29yZGluYXRlc1swXSA9IGdlbmVyYXRlUmFuZG9tQ29vcmRpbmF0ZSgpO1xuICAgICAgc3RhcnRpbmdDb29yZGluYXRlc1sxXSA9IGdlbmVyYXRlUmFuZG9tQ29vcmRpbmF0ZSgpO1xuICAgIH0gd2hpbGUgKHBsYXllckdhbWVib2FyZC5nZXRDb29yZGluYXRlcyhzdGFydGluZ0Nvb3JkaW5hdGVzKSAhPT0gdW5kZWZpbmVkKTtcbiAgICByZXR1cm4gc3RhcnRpbmdDb29yZGluYXRlcztcbiAgfTtcbiAgY29uc3QgZ2VuZXJhdGVOb25TdGFydGluZ0Nvb3JkaW5hdGVzID0gKHN0YXJ0aW5nQ29vcmRpbmF0ZXMsIHNoaXBMZW5ndGgpID0+IHtcbiAgICBjb25zdCBwb3NzaWJsZUNvb3JkaW5hdGVzID0gW107XG4gICAgaWYgKGNoZWNrSWZWYWxpZEVtcHR5Q29vcmRpbmF0ZXMoc3RhcnRpbmdDb29yZGluYXRlcywgc2hpcExlbmd0aCwgXCJ1cFwiKSkge1xuICAgICAgY29uc3QgdXBDb29yZGluYXRlcyA9IFtdO1xuICAgICAgZm9yIChsZXQgaSA9IDE7IGkgPCBzaGlwTGVuZ3RoOyBpKyspIHtcbiAgICAgICAgdXBDb29yZGluYXRlcy5wdXNoKFtcbiAgICAgICAgICBzdGFydGluZ0Nvb3JkaW5hdGVzWzBdIC0gaSxcbiAgICAgICAgICBzdGFydGluZ0Nvb3JkaW5hdGVzWzFdLFxuICAgICAgICBdKTtcbiAgICAgIH1cbiAgICAgIHBvc3NpYmxlQ29vcmRpbmF0ZXMucHVzaCh1cENvb3JkaW5hdGVzKTtcbiAgICB9XG4gICAgaWYgKFxuICAgICAgY2hlY2tJZlZhbGlkRW1wdHlDb29yZGluYXRlcyhzdGFydGluZ0Nvb3JkaW5hdGVzLCBzaGlwTGVuZ3RoLCBcInJpZ2h0XCIpXG4gICAgKSB7XG4gICAgICBjb25zdCByaWdodENvb3JkaW5hdGVzID0gW107XG4gICAgICBmb3IgKGxldCBpID0gMTsgaSA8IHNoaXBMZW5ndGg7IGkrKykge1xuICAgICAgICByaWdodENvb3JkaW5hdGVzLnB1c2goW1xuICAgICAgICAgIHN0YXJ0aW5nQ29vcmRpbmF0ZXNbMF0sXG4gICAgICAgICAgc3RhcnRpbmdDb29yZGluYXRlc1sxXSArIGksXG4gICAgICAgIF0pO1xuICAgICAgfVxuICAgICAgcG9zc2libGVDb29yZGluYXRlcy5wdXNoKHJpZ2h0Q29vcmRpbmF0ZXMpO1xuICAgIH1cbiAgICBpZiAoY2hlY2tJZlZhbGlkRW1wdHlDb29yZGluYXRlcyhzdGFydGluZ0Nvb3JkaW5hdGVzLCBzaGlwTGVuZ3RoLCBcImRvd25cIikpIHtcbiAgICAgIGNvbnN0IGRvd25Db29yZGluYXRlcyA9IFtdO1xuICAgICAgZm9yIChsZXQgaSA9IDE7IGkgPCBzaGlwTGVuZ3RoOyBpKyspIHtcbiAgICAgICAgZG93bkNvb3JkaW5hdGVzLnB1c2goW1xuICAgICAgICAgIHN0YXJ0aW5nQ29vcmRpbmF0ZXNbMF0gKyBpLFxuICAgICAgICAgIHN0YXJ0aW5nQ29vcmRpbmF0ZXNbMV0sXG4gICAgICAgIF0pO1xuICAgICAgfVxuICAgICAgcG9zc2libGVDb29yZGluYXRlcy5wdXNoKGRvd25Db29yZGluYXRlcyk7XG4gICAgfVxuICAgIGlmIChjaGVja0lmVmFsaWRFbXB0eUNvb3JkaW5hdGVzKHN0YXJ0aW5nQ29vcmRpbmF0ZXMsIHNoaXBMZW5ndGgsIFwibGVmdFwiKSkge1xuICAgICAgY29uc3QgbGVmdENvb3JkaW5hdGVzID0gW107XG4gICAgICBmb3IgKGxldCBpID0gMTsgaSA8IHNoaXBMZW5ndGg7IGkrKykge1xuICAgICAgICBsZWZ0Q29vcmRpbmF0ZXMucHVzaChbXG4gICAgICAgICAgc3RhcnRpbmdDb29yZGluYXRlc1swXSxcbiAgICAgICAgICBzdGFydGluZ0Nvb3JkaW5hdGVzWzFdIC0gaSxcbiAgICAgICAgXSk7XG4gICAgICB9XG4gICAgICBwb3NzaWJsZUNvb3JkaW5hdGVzLnB1c2gobGVmdENvb3JkaW5hdGVzKTtcbiAgICB9XG4gICAgaWYgKHBvc3NpYmxlQ29vcmRpbmF0ZXMubGVuZ3RoID09PSAwKSB7XG4gICAgICByZXR1cm4gcG9zc2libGVDb29yZGluYXRlcztcbiAgICB9XG4gICAgY29uc3QgcmFuZG9tSW5kZXggPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiBwb3NzaWJsZUNvb3JkaW5hdGVzLmxlbmd0aCk7XG4gICAgcmV0dXJuIHBvc3NpYmxlQ29vcmRpbmF0ZXNbcmFuZG9tSW5kZXhdO1xuICB9O1xuICBjb25zdCBnZW5lcmF0ZVJhbmRvbUNvb3JkaW5hdGUgPSAoKSA9PiB7XG4gICAgY29uc3QgQk9BUkRBWEVTTEVOR1RIID0gMTA7XG4gICAgcmV0dXJuIE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIEJPQVJEQVhFU0xFTkdUSCk7XG4gIH07XG4gIGNvbnN0IGNoZWNrSWZQcmV2aW91c2x5QXR0YWNrZWQgPSAoYXR0YWNrQ29vcmRpbmF0ZXMpID0+IHtcbiAgICBsZXQgcHJldmlvdXNseUF0dGFja2VkID0gZmFsc2U7XG4gICAgY29uc3QgcmVjZWl2ZWRNaXNzZWRTaG90cyA9IG9wcG9zaW5nUGxheWVyXG4gICAgICAuZ2V0R2FtZWJvYXJkKClcbiAgICAgIC5nZXRSZWNlaXZlZE1pc3NlZFNob3RzKCk7XG4gICAgY29uc3QgcmVjZWl2ZWRIaXRTaG90cyA9IG9wcG9zaW5nUGxheWVyXG4gICAgICAuZ2V0R2FtZWJvYXJkKClcbiAgICAgIC5nZXRSZWNlaXZlZEhpdFNob3RzKCk7XG4gICAgcHJldmlvdXNseUF0dGFja2VkID0gcmVjZWl2ZWRNaXNzZWRTaG90cy5zb21lKFxuICAgICAgKHNob3QpID0+XG4gICAgICAgIHNob3RbMF0gPT09IGF0dGFja0Nvb3JkaW5hdGVzWzBdICYmIHNob3RbMV0gPT09IGF0dGFja0Nvb3JkaW5hdGVzWzFdXG4gICAgKTtcbiAgICBpZiAoIXByZXZpb3VzbHlBdHRhY2tlZCkge1xuICAgICAgcHJldmlvdXNseUF0dGFja2VkID0gcmVjZWl2ZWRIaXRTaG90cy5zb21lKFxuICAgICAgICAoc2hvdCkgPT5cbiAgICAgICAgICBzaG90WzBdID09PSBhdHRhY2tDb29yZGluYXRlc1swXSAmJiBzaG90WzFdID09PSBhdHRhY2tDb29yZGluYXRlc1sxXVxuICAgICAgKTtcbiAgICB9XG4gICAgcmV0dXJuIHByZXZpb3VzbHlBdHRhY2tlZDtcbiAgfTtcbiAgY29uc3QgZ2VuZXJhdGVBdHRhY2tDb29yZGluYXRlcyA9ICgpID0+IHtcbiAgICBjb25zdCBhdHRhY2tDb29yZGluYXRlcyA9IFt1bmRlZmluZWQsIHVuZGVmaW5lZF07XG4gICAgZG8ge1xuICAgICAgYXR0YWNrQ29vcmRpbmF0ZXNbMF0gPSBnZW5lcmF0ZVJhbmRvbUNvb3JkaW5hdGUoKTtcbiAgICAgIGF0dGFja0Nvb3JkaW5hdGVzWzFdID0gZ2VuZXJhdGVSYW5kb21Db29yZGluYXRlKCk7XG4gICAgfSB3aGlsZSAoY2hlY2tJZlByZXZpb3VzbHlBdHRhY2tlZChhdHRhY2tDb29yZGluYXRlcykpO1xuICAgIHJldHVybiBhdHRhY2tDb29yZGluYXRlcztcbiAgfTtcbiAgY29uc3QgY2hlY2tJZlZhbGlkRW1wdHlDb29yZGluYXRlcyA9IChcbiAgICBzdGFydGluZ0Nvb3JkaW5hdGVzLFxuICAgIHNoaXBMZW5ndGgsXG4gICAgZGlyZWN0aW9uXG4gICkgPT4ge1xuICAgIHN3aXRjaCAoZGlyZWN0aW9uKSB7XG4gICAgICBjYXNlIFwidXBcIjpcbiAgICAgICAgaWYgKHN0YXJ0aW5nQ29vcmRpbmF0ZXNbMF0gLSAoc2hpcExlbmd0aCAtIDEpIDwgMCkge1xuICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgICBmb3IgKGxldCBpID0gMTsgaSA8IHNoaXBMZW5ndGg7IGkrKykge1xuICAgICAgICAgIGlmIChcbiAgICAgICAgICAgIHBsYXllckdhbWVib2FyZC5nZXRDb29yZGluYXRlcyhbXG4gICAgICAgICAgICAgIHN0YXJ0aW5nQ29vcmRpbmF0ZXNbMF0gLSBpLFxuICAgICAgICAgICAgICBzdGFydGluZ0Nvb3JkaW5hdGVzWzFdLFxuICAgICAgICAgICAgXSkgIT09IHVuZGVmaW5lZFxuICAgICAgICAgICkge1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdHJ1ZTtcblxuICAgICAgY2FzZSBcInJpZ2h0XCI6XG4gICAgICAgIGlmIChzdGFydGluZ0Nvb3JkaW5hdGVzWzFdICsgKHNoaXBMZW5ndGggLSAxKSA+IDkpIHtcbiAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgZm9yIChsZXQgaSA9IDE7IGkgPCBzaGlwTGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICBpZiAoXG4gICAgICAgICAgICBwbGF5ZXJHYW1lYm9hcmQuZ2V0Q29vcmRpbmF0ZXMoW1xuICAgICAgICAgICAgICBzdGFydGluZ0Nvb3JkaW5hdGVzWzBdLFxuICAgICAgICAgICAgICBzdGFydGluZ0Nvb3JkaW5hdGVzWzFdICsgaSxcbiAgICAgICAgICAgIF0pICE9PSB1bmRlZmluZWRcbiAgICAgICAgICApIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRydWU7XG5cbiAgICAgIGNhc2UgXCJkb3duXCI6XG4gICAgICAgIGlmIChzdGFydGluZ0Nvb3JkaW5hdGVzWzBdICsgKHNoaXBMZW5ndGggLSAxKSA+IDkpIHtcbiAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgZm9yIChsZXQgaSA9IDE7IGkgPCBzaGlwTGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICBpZiAoXG4gICAgICAgICAgICBwbGF5ZXJHYW1lYm9hcmQuZ2V0Q29vcmRpbmF0ZXMoW1xuICAgICAgICAgICAgICBzdGFydGluZ0Nvb3JkaW5hdGVzWzBdICsgaSxcbiAgICAgICAgICAgICAgc3RhcnRpbmdDb29yZGluYXRlc1sxXSxcbiAgICAgICAgICAgIF0pICE9PSB1bmRlZmluZWRcbiAgICAgICAgICApIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRydWU7XG5cbiAgICAgIGNhc2UgXCJsZWZ0XCI6XG4gICAgICAgIGlmIChzdGFydGluZ0Nvb3JkaW5hdGVzWzFdIC0gKHNoaXBMZW5ndGggLSAxKSA8IDApIHtcbiAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgZm9yIChsZXQgaSA9IDE7IGkgPCBzaGlwTGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICBpZiAoXG4gICAgICAgICAgICBwbGF5ZXJHYW1lYm9hcmQuZ2V0Q29vcmRpbmF0ZXMoW1xuICAgICAgICAgICAgICBzdGFydGluZ0Nvb3JkaW5hdGVzWzBdLFxuICAgICAgICAgICAgICBzdGFydGluZ0Nvb3JkaW5hdGVzWzFdIC0gaSxcbiAgICAgICAgICAgIF0pICE9PSB1bmRlZmluZWRcbiAgICAgICAgICApIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRydWU7XG5cbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIGJyZWFrO1xuICAgIH1cbiAgfTtcbiAgcmV0dXJuIHtcbiAgICBpc0NvbXB1dGVyLFxuICAgIGdldEdhbWVib2FyZCxcbiAgICBnZXRPcHBvc2luZ1BsYXllcixcbiAgICBzZXRPcHBvc2luZ1BsYXllcixcbiAgICBhZGRTaGlwVG9HYW1lYm9hcmQsXG4gICAgc2VuZEF0dGFjayxcbiAgICBpbml0aWFsaXplQ29tcHV0ZXJHYW1lYm9hcmQsXG4gICAgc2VuZENvbXB1dGVyQXR0YWNrLFxuICAgIHJlY2VpdmVBdHRhY2ssXG4gICAgY2hlY2tJZlZhbGlkRW1wdHlDb29yZGluYXRlcyxcbiAgfTtcbn07XG5cbmV4cG9ydCB7IFBsYXllciB9O1xuIiwiY29uc3QgR2FtZWJvYXJkID0gKCkgPT4ge1xuICBjb25zdCBjcmVhdGVCb2FyZCA9ICgpID0+IHtcbiAgICBjb25zdCBib2FyZCA9IFtdO1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgMTA7IGkrKykge1xuICAgICAgYm9hcmQucHVzaChbXSk7XG4gICAgICBmb3IgKGxldCBqID0gMDsgaiA8IDEwOyBqKyspIHtcbiAgICAgICAgYm9hcmRbaV0ucHVzaCh1bmRlZmluZWQpO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gYm9hcmQ7XG4gIH07XG4gIGNvbnN0IGJvYXJkID0gY3JlYXRlQm9hcmQoKTtcbiAgY29uc3QgcGxhY2VkU2hpcHMgPSBbXTtcbiAgY29uc3QgcmVjZWl2ZWRNaXNzZWRTaG90cyA9IFtdO1xuICBjb25zdCByZWNlaXZlZEhpdFNob3RzID0gW107XG4gIGNvbnN0IHNlbnRNaXNzZWRTaG90cyA9IFtdO1xuICBjb25zdCBzZW50SGl0U2hvdHMgPSBbXTtcbiAgbGV0IGFsbFNoaXBzU3VuayA9IGZhbHNlO1xuICBjb25zdCBnZXRDb29yZGluYXRlcyA9IChjb29yZGluYXRlcykgPT4gYm9hcmRbY29vcmRpbmF0ZXNbMF1dW2Nvb3JkaW5hdGVzWzFdXTtcbiAgY29uc3QgZ2V0UGxhY2VkU2hpcHMgPSAoKSA9PiBwbGFjZWRTaGlwcztcbiAgY29uc3QgZ2V0UmVjZWl2ZWRNaXNzZWRTaG90cyA9ICgpID0+IHJlY2VpdmVkTWlzc2VkU2hvdHM7XG4gIGNvbnN0IGdldFJlY2VpdmVkSGl0U2hvdHMgPSAoKSA9PiByZWNlaXZlZEhpdFNob3RzO1xuICBjb25zdCBnZXRTZW50TWlzc2VkU2hvdHMgPSAoKSA9PiBzZW50TWlzc2VkU2hvdHM7XG4gIGNvbnN0IGdldFNlbnRIaXRTaG90cyA9ICgpID0+IHNlbnRIaXRTaG90cztcbiAgY29uc3QgaXNBbGxTaGlwc1N1bmsgPSAoKSA9PiBhbGxTaGlwc1N1bms7XG4gIGNvbnN0IHBsYWNlU2hpcCA9IChzaGlwLCBjb29yZGluYXRlc0xpc3QpID0+IHtcbiAgICBmb3IgKGNvbnN0IGNvb3JkaW5hdGVzIG9mIGNvb3JkaW5hdGVzTGlzdCkge1xuICAgICAgYm9hcmRbY29vcmRpbmF0ZXNbMF1dW2Nvb3JkaW5hdGVzWzFdXSA9IHNoaXA7XG4gICAgfVxuICAgIHBsYWNlZFNoaXBzLnB1c2goc2hpcCk7XG4gIH07XG4gIGNvbnN0IGNoZWNrQWxsU2hpcHNTdW5rID0gKCkgPT4ge1xuICAgIGlmIChwbGFjZWRTaGlwcy5ldmVyeSgoc2hpcCkgPT4gc2hpcC5pc1N1bmsoKSkpIHtcbiAgICAgIGFsbFNoaXBzU3VuayA9IHRydWU7XG4gICAgfVxuICB9O1xuICBjb25zdCByZWNlaXZlQXR0YWNrID0gKGNvb3JkaW5hdGVzKSA9PiB7XG4gICAgY29uc3QgZW50aXR5QXRDb29yZGluYXRlcyA9IGdldENvb3JkaW5hdGVzKGNvb3JkaW5hdGVzKTtcbiAgICBpZiAoZW50aXR5QXRDb29yZGluYXRlcyAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICBlbnRpdHlBdENvb3JkaW5hdGVzLmhpdCgpO1xuICAgICAgY2hlY2tBbGxTaGlwc1N1bmsoKTtcbiAgICAgIHJlY2VpdmVkSGl0U2hvdHMucHVzaChjb29yZGluYXRlcyk7XG4gICAgICByZXR1cm4gXCJoaXRcIjtcbiAgICB9XG4gICAgcmVjZWl2ZWRNaXNzZWRTaG90cy5wdXNoKGNvb3JkaW5hdGVzKTtcbiAgICByZXR1cm4gXCJtaXNzXCI7XG4gIH07XG4gIGNvbnN0IGFkZFNlbnRNaXNzZWRTaG90ID0gKGNvb3JkaW5hdGVzKSA9PiB7XG4gICAgc2VudE1pc3NlZFNob3RzLnB1c2goY29vcmRpbmF0ZXMpO1xuICB9O1xuICBjb25zdCBhZGRTZW50SGl0U2hvdCA9IChjb29yZGluYXRlcykgPT4ge1xuICAgIHNlbnRIaXRTaG90cy5wdXNoKGNvb3JkaW5hdGVzKTtcbiAgfTtcbiAgcmV0dXJuIHtcbiAgICBnZXRDb29yZGluYXRlcyxcbiAgICBnZXRQbGFjZWRTaGlwcyxcbiAgICBnZXRSZWNlaXZlZE1pc3NlZFNob3RzLFxuICAgIGdldFJlY2VpdmVkSGl0U2hvdHMsXG4gICAgZ2V0U2VudE1pc3NlZFNob3RzLFxuICAgIGdldFNlbnRIaXRTaG90cyxcbiAgICBpc0FsbFNoaXBzU3VuayxcbiAgICBwbGFjZVNoaXAsXG4gICAgcmVjZWl2ZUF0dGFjayxcbiAgICBhZGRTZW50TWlzc2VkU2hvdCxcbiAgICBhZGRTZW50SGl0U2hvdCxcbiAgfTtcbn07XG5cbmV4cG9ydCB7IEdhbWVib2FyZCB9O1xuIiwiaW1wb3J0IHsgU2hpcCB9IGZyb20gXCIuL3NoaXBcIjtcbmltcG9ydCB7IEdhbWVib2FyZCB9IGZyb20gXCIuL2dhbWVib2FyZFwiO1xuaW1wb3J0IHsgUGxheWVyIH0gZnJvbSBcIi4vcGxheWVyXCI7XG5pbXBvcnQgeyBET01Db250cm9sbGVyIH0gZnJvbSBcIi4vRE9NX2NvbnRyb2xsZXJcIjtcblxuY29uc3QgR2FtZUxvb3AgPSAoKCkgPT4ge1xuICBjb25zdCBwbGF5ZXJzID0gW107XG4gIGxldCBpblByb2dyZXNzID0gdHJ1ZTtcbiAgbGV0IHdpbm5lcjtcbiAgbGV0IG1pZEF0dGFjayA9IGZhbHNlO1xuICBjb25zdCBnZXRQbGF5ZXJzID0gKCkgPT4gcGxheWVycztcbiAgY29uc3QgaXNJblByb2dyZXNzID0gKCkgPT4gaW5Qcm9ncmVzcztcbiAgY29uc3QgZ2V0V2lubmVyID0gKCkgPT4gd2lubmVyO1xuICBjb25zdCBpc01pZEF0dGFjayA9ICgpID0+IG1pZEF0dGFjaztcbiAgY29uc3QgdG9nZ2xlTWlkQXR0YWNrID0gKHN0YXRlKSA9PiB7XG4gICAgc3RhdGUgPyAobWlkQXR0YWNrID0gdHJ1ZSkgOiAobWlkQXR0YWNrID0gZmFsc2UpO1xuICB9O1xuICBjb25zdCBjcmVhdGVHYW1lID0gKCkgPT4ge1xuICAgIGNvbnN0IGh1bWFuUGxheWVyID0gUGxheWVyKFwiaHVtYW5cIik7XG4gICAgcGxheWVycy5wdXNoKGh1bWFuUGxheWVyKTtcbiAgICBjb25zdCBjb21wdXRlclBsYXllciA9IFBsYXllcihcImNvbXB1dGVyXCIpO1xuICAgIHBsYXllcnMucHVzaChjb21wdXRlclBsYXllcik7XG4gICAgaHVtYW5QbGF5ZXIuc2V0T3Bwb3NpbmdQbGF5ZXIoY29tcHV0ZXJQbGF5ZXIpO1xuICAgIGNvbXB1dGVyUGxheWVyLnNldE9wcG9zaW5nUGxheWVyKGh1bWFuUGxheWVyKTtcbiAgICBjb21wdXRlclBsYXllci5pbml0aWFsaXplQ29tcHV0ZXJHYW1lYm9hcmQoKTtcbiAgfTtcbiAgY29uc3QgZW5kR2FtZSA9IChsb3NlclBsYXllcikgPT4ge1xuICAgIGNvbnN0IHdpbm5lclBsYXllciA9IGxvc2VyUGxheWVyLmdldE9wcG9zaW5nUGxheWVyKCk7XG4gICAgaW5Qcm9ncmVzcyA9IGZhbHNlO1xuICAgIHdpbm5lciA9IHdpbm5lclBsYXllcjtcbiAgICBET01Db250cm9sbGVyLnRvZ2dsZUFiaWxpdHlUb0F0dGFjayhcImRpc2FibGVcIik7XG4gICAgRE9NQ29udHJvbGxlci5kaXNwbGF5V2lubmVyKHdpbm5lcik7XG4gIH07XG4gIGNvbnN0IHJlc2V0R2FtZUxvb3BTdGF0ZSA9ICgpID0+IHtcbiAgICBwbGF5ZXJzLmxlbmd0aCA9IDA7XG4gICAgaW5Qcm9ncmVzcyA9IHRydWU7XG4gICAgd2lubmVyID0gdW5kZWZpbmVkO1xuICB9O1xuICBjb25zdCByZXNldEdhbWUgPSAoKSA9PiB7XG4gICAgcmVzZXRHYW1lTG9vcFN0YXRlKCk7XG4gICAgRE9NQ29udHJvbGxlci5yZXNldERPTSgpO1xuICAgIGNyZWF0ZUdhbWUoKTtcbiAgICBET01Db250cm9sbGVyLmluaXRpYWxpemVCb2FyZERPTSgpO1xuICB9O1xuICByZXR1cm4ge1xuICAgIGdldFBsYXllcnMsXG4gICAgaXNJblByb2dyZXNzLFxuICAgIGdldFdpbm5lcixcbiAgICBpc01pZEF0dGFjayxcbiAgICB0b2dnbGVNaWRBdHRhY2ssXG4gICAgY3JlYXRlR2FtZSxcbiAgICBlbmRHYW1lLFxuICAgIHJlc2V0R2FtZSxcbiAgfTtcbn0pKCk7XG5cbmV4cG9ydCB7IEdhbWVMb29wIH07XG4iLCJpbXBvcnQgeyBET01Db250cm9sbGVyIH0gZnJvbSBcIi4vRE9NX2NvbnRyb2xsZXJcIjtcbmltcG9ydCB7IEdhbWVMb29wIH0gZnJvbSBcIi4vZ2FtZWxvb3BcIjtcblxuY29uc3QgRXZlbnRMaXN0ZW5lckNvbnRyb2xsZXIgPSAoKCkgPT4ge1xuICBjb25zdCByb3RhdGVTaGlwSW1hZ2VMaXN0ZW5lcnMgPSAoKSA9PiB7XG4gICAgY29uc3Qgc2hpcFBsYWNlbWVudEVsZW1lbnRzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChcIi5zaGlwLXBsYWNlbWVudFwiKTtcbiAgICBzaGlwUGxhY2VtZW50RWxlbWVudHMuZm9yRWFjaCgoZ3JvdXBPZkVsZW1lbnRzKSA9PiB7XG4gICAgICBjb25zdCBpbWFnZUVsZW1lbnQgPSBncm91cE9mRWxlbWVudHMucXVlcnlTZWxlY3RvcihcImltZ1wiKTtcbiAgICAgIGNvbnN0IGJ1dHRvbkVsZW1lbnQgPSBncm91cE9mRWxlbWVudHMucXVlcnlTZWxlY3RvcihcImJ1dHRvblwiKTtcbiAgICAgIGJ1dHRvbkVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcbiAgICAgICAgRE9NQ29udHJvbGxlci5yb3RhdGVTaGlwSW1hZ2UoaW1hZ2VFbGVtZW50KTtcbiAgICAgIH0pO1xuICAgIH0pO1xuICB9O1xuICBjb25zdCBhZGRTaGlwUGxhY2VtZW50RHJhZyA9ICgpID0+IHtcbiAgICBjb25zdCBzaGlwSW1hZ2VzID0gQXJyYXkuZnJvbShkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKFwiLnNoaXAtcGllY2VcIikpO1xuICAgIHNoaXBJbWFnZXMuZm9yRWFjaCgoc2hpcCkgPT4ge1xuICAgICAgc2hpcC5hZGRFdmVudExpc3RlbmVyKFwiZHJhZ3N0YXJ0XCIsIChldmVudCkgPT4ge1xuICAgICAgICBET01Db250cm9sbGVyLmdldERyYWdnZWRJbWFnZShldmVudCk7XG4gICAgICAgIERPTUNvbnRyb2xsZXIucm90YXRlRHJhZ2dlZEltYWdlKGV2ZW50KTtcbiAgICAgIH0pO1xuICAgIH0pO1xuICB9O1xuICBjb25zdCBhZGRQbGF5QWdhaW5MaXN0ZW5lciA9ICgpID0+IHtcbiAgICBjb25zdCBwbGF5QWdhaW5CdXR0b24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnBsYXktYWdhaW5cIik7XG4gICAgcGxheUFnYWluQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XG4gICAgICBHYW1lTG9vcC5yZXNldEdhbWUoKTtcbiAgICB9KTtcbiAgfTtcbiAgcmV0dXJuIHtcbiAgICByb3RhdGVTaGlwSW1hZ2VMaXN0ZW5lcnMsXG4gICAgYWRkU2hpcFBsYWNlbWVudERyYWcsXG4gICAgYWRkUGxheUFnYWluTGlzdGVuZXIsXG4gIH07XG59KSgpO1xuXG5leHBvcnQgeyBFdmVudExpc3RlbmVyQ29udHJvbGxlciB9O1xuIiwiaW1wb3J0IHsgR2FtZUxvb3AgfSBmcm9tIFwiLi9nYW1lbG9vcFwiO1xuaW1wb3J0IHsgRE9NQ29udHJvbGxlciB9IGZyb20gXCIuL0RPTV9jb250cm9sbGVyXCI7XG5pbXBvcnQgeyBFdmVudExpc3RlbmVyQ29udHJvbGxlciB9IGZyb20gXCIuL2V2ZW50X2xpc3RlbmVyX2NvbnRyb2xsZXJcIjtcblxuR2FtZUxvb3AuY3JlYXRlR2FtZSgpO1xuXG5ET01Db250cm9sbGVyLmluaXRpYWxpemVCb2FyZERPTSgpO1xuXG5FdmVudExpc3RlbmVyQ29udHJvbGxlci5yb3RhdGVTaGlwSW1hZ2VMaXN0ZW5lcnMoKTtcblxuRXZlbnRMaXN0ZW5lckNvbnRyb2xsZXIuYWRkU2hpcFBsYWNlbWVudERyYWcoKTtcblxuRXZlbnRMaXN0ZW5lckNvbnRyb2xsZXIuYWRkUGxheUFnYWluTGlzdGVuZXIoKTtcbiJdLCJuYW1lcyI6WyJET01Db250cm9sbGVyIiwiY3JlYXRlQm9hcmRDZWxscyIsImdhbWVib2FyZERPTSIsImNvbHVtbkxhYmVscyIsInJvd0xhYmVscyIsImh1bWFuUGxheWVyT2JqZWN0IiwiR2FtZUxvb3AiLCJnZXRQbGF5ZXJzIiwiaSIsImoiLCJpbnZpc2libGVQbGFjZWhvbGRlckVsZW1lbnQiLCJkb2N1bWVudCIsImNyZWF0ZUVsZW1lbnQiLCJjbGFzc0xpc3QiLCJhZGQiLCJzdHlsZSIsInZpc2liaWxpdHkiLCJhcHBlbmRDaGlsZCIsImNvbHVtbkxhYmVsRWxlbWVudCIsInRleHRDb250ZW50Iiwicm93TGFiZWxFbGVtZW50IiwiQXJyYXkiLCJmcm9tIiwiaW5jbHVkZXMiLCJwbGF5ZXJDZWxsRWxlbWVudCIsInNldEF0dHJpYnV0ZSIsImFkZEV2ZW50TGlzdGVuZXIiLCJldmVudCIsImRyYWdPdmVyIiwiaW5zZXJ0RHJhZ2dlZEltYWdlIiwiZ2V0R2FtZWJvYXJkIiwiZ2V0UGxhY2VkU2hpcHMiLCJsZW5ndGgiLCJ0b2dnbGVBYmlsaXR5VG9BdHRhY2siLCJjb21wdXRlckNlbGxFbGVtZW50IiwiZGlzYWJsZWQiLCJpc01pZEF0dGFjayIsImNlbGxSb3ciLCJOdW1iZXIiLCJkYXRhc2V0Iiwicm93IiwiY2VsbENvbHVtbiIsImNvbHVtbiIsInNlbmRBdHRhY2siLCJhY3Rpb24iLCJjb21wdXRlckdhbWVib2FyZEVsZW1lbnQiLCJxdWVyeVNlbGVjdG9yIiwiY2VsbEVsZW1lbnRzIiwicXVlcnlTZWxlY3RvckFsbCIsImZvckVhY2giLCJjZWxsRWxlbWVudCIsInByZXZlbnREZWZhdWx0IiwidGFyZ2V0Q2VsbCIsInRhcmdldCIsImRhdGFTdHJpbmciLCJkYXRhVHJhbnNmZXIiLCJnZXREYXRhIiwiZGF0YU9iamVjdCIsIkpTT04iLCJwYXJzZSIsImNlbGxDb29yZGluYXRlcyIsInNoaXBMZW5ndGgiLCJob3Jpem9udGFsIiwiY2hlY2tJZlZhbGlkRW1wdHlDb29yZGluYXRlcyIsInZlcnRpY2FsIiwiaXNWYWxpZEdhbWVib2FyZENlbGwiLCJzaGlwQ29vcmRpbmF0ZXMiLCJ0YXJnZXRDZWxsUm93IiwidGFyZ2V0Q2VsbENvbHVtbiIsImNvb3JkaW5hdGVzQXJyYXkiLCJyZW1haW5pbmdDZWxsIiwicHVzaCIsImFkZFNoaXBUb0RPTSIsImFkZFNoaXBUb0dhbWVib2FyZCIsIklEIiwiZWxlbWVudElEIiwiaW1hZ2VFbGVtZW50IiwiYnV0dG9uRWxlbWVudCIsInBhcmVudE5vZGUiLCJkaXNhYmxlSW1hZ2VCdXR0b25JbnRlcmFjdGlvbnMiLCJyZW1vdmVFdmVudExpc3RlbmVyIiwiaW5pdGlhbGl6ZUJvYXJkRE9NIiwiaHVtYW5QbGF5ZXJHYW1lYm9hcmRET00iLCJjb21wdXRlckdhbWVib2FyZERPTSIsInJvdGF0ZVNoaXBJbWFnZSIsImltYWdlIiwiaW1hZ2VDbGFzc2VzIiwicmVtb3ZlIiwicm90YXRlRHJhZ2dlZEltYWdlIiwiY2xvbmVkSW1hZ2VFbGVtZW50IiwiY2xvbmVOb2RlIiwidGVtcERpdiIsImNsb25lZEltYWdlRWxlbWVudENsYXNzZXMiLCJyb3RhdGVQZXJMZW5ndGgiLCJib2R5Iiwic2V0RHJhZ0ltYWdlIiwic2V0VGltZW91dCIsInJlbW92ZUNoaWxkIiwiZ2V0RHJhZ2dlZEltYWdlIiwic3JjIiwiZ2V0QXR0cmlidXRlIiwic3RyaW5naWZ5Iiwic2V0RGF0YSIsImFkZEF0dGFja1Jlc3VsdERPTSIsInBsYXllclR5cGUiLCJhdHRhY2tSZXN1bHRzIiwiY29vcmRpbmF0ZXMiLCJhdHRhY2tSZXN1bHRzRWxlbWVudCIsImRpc3BsYXlXaW5uZXIiLCJ3aW5uaW5nUGxheWVyIiwiaXNDb21wdXRlciIsInJlc2V0RE9NIiwiaW5uZXJIVE1MIiwiYnV0dG9uIiwiZ2FtZVJlc3VsdHNFbGVtZW50IiwicmVzZXRHYW1lUmVzdWx0cyIsIlBsYXllciIsImNvbXB1dGVyUGxheWVyIiwicGxheWVyR2FtZWJvYXJkIiwiYm9hcmQiLCJ1bmRlZmluZWQiLCJjcmVhdGVCb2FyZCIsInBsYWNlZFNoaXBzIiwicmVjZWl2ZWRNaXNzZWRTaG90cyIsInJlY2VpdmVkSGl0U2hvdHMiLCJzZW50TWlzc2VkU2hvdHMiLCJzZW50SGl0U2hvdHMiLCJhbGxTaGlwc1N1bmsiLCJnZXRDb29yZGluYXRlcyIsImdldFJlY2VpdmVkTWlzc2VkU2hvdHMiLCJnZXRSZWNlaXZlZEhpdFNob3RzIiwiZ2V0U2VudE1pc3NlZFNob3RzIiwiZ2V0U2VudEhpdFNob3RzIiwiaXNBbGxTaGlwc1N1bmsiLCJwbGFjZVNoaXAiLCJzaGlwIiwiY29vcmRpbmF0ZXNMaXN0IiwicmVjZWl2ZUF0dGFjayIsImVudGl0eUF0Q29vcmRpbmF0ZXMiLCJoaXQiLCJldmVyeSIsImlzU3VuayIsImFkZFNlbnRNaXNzZWRTaG90IiwiYWRkU2VudEhpdFNob3QiLCJHYW1lYm9hcmQiLCJvcHBvc2luZ1BsYXllciIsImdpdmVuTGVuZ3RoIiwiaGl0cyIsInN1bmsiLCJnZXRTaGlwTGVuZ3RoIiwiZ2V0U2hpcEhpdHMiLCJTaGlwIiwiY2hlY2tJZlByZXZpb3VzbHlBdHRhY2tlZCIsImlzSW5Qcm9ncmVzcyIsIm9wcG9zaW5nUGxheWVyR2FtZWJvYXJkIiwiZW5kR2FtZSIsInRvZ2dsZU1pZEF0dGFjayIsInNlbmRDb21wdXRlckF0dGFjayIsImdlbmVyYXRlQ29tcHV0ZXJTaGlwQ29vcmRpbmF0ZXMiLCJsaXN0T2ZDb29yZGluYXRlcyIsInN0YXJ0aW5nQ29vcmRpbmF0ZXMiLCJnZW5lcmF0ZVN0YXJ0aW5nQ29vcmRpbmF0ZXMiLCJub25TdGFydGluZ0Nvb3JkaW5hdGVzIiwiZ2VuZXJhdGVOb25TdGFydGluZ0Nvb3JkaW5hdGVzIiwiY29uY2F0IiwiZ2VuZXJhdGVSYW5kb21Db29yZGluYXRlIiwicG9zc2libGVDb29yZGluYXRlcyIsInVwQ29vcmRpbmF0ZXMiLCJyaWdodENvb3JkaW5hdGVzIiwiZG93bkNvb3JkaW5hdGVzIiwibGVmdENvb3JkaW5hdGVzIiwiTWF0aCIsImZsb29yIiwicmFuZG9tIiwiYXR0YWNrQ29vcmRpbmF0ZXMiLCJwcmV2aW91c2x5QXR0YWNrZWQiLCJzb21lIiwic2hvdCIsImRpcmVjdGlvbiIsImdldE9wcG9zaW5nUGxheWVyIiwic2V0T3Bwb3NpbmdQbGF5ZXIiLCJwbGF5ZXIiLCJpbml0aWFsaXplQ29tcHV0ZXJHYW1lYm9hcmQiLCJsZW5ndGhzT2ZTaGlwcyIsImdlbmVyYXRlQXR0YWNrQ29vcmRpbmF0ZXMiLCJwbGF5ZXJzIiwid2lubmVyIiwiaW5Qcm9ncmVzcyIsIm1pZEF0dGFjayIsImNyZWF0ZUdhbWUiLCJodW1hblBsYXllciIsImdldFdpbm5lciIsInN0YXRlIiwibG9zZXJQbGF5ZXIiLCJ3aW5uZXJQbGF5ZXIiLCJyZXNldEdhbWUiLCJFdmVudExpc3RlbmVyQ29udHJvbGxlciIsImdyb3VwT2ZFbGVtZW50cyJdLCJzb3VyY2VSb290IjoiIn0=